/**
 * Ext Array declaration starts here 
 */

Ext.uiTab = [
    ["CMS"],
    ["PMS"],
    ["Users And Roles"],
    ["Feed Automation"],
    ["Admin"],
    ["Domain"],
    ["Workflow"]
];

Ext.isActive = [ // autogenall
["true"],
    ["false"]
];
Ext.booleanType = [ // common booleanType
["true"],
    ["false"]
];
Ext.cdata = [ // autogenall
["true"],
    ["false"]
];

Ext.defaultSearch = [ // autogenall
["true"],
    ["false"]
];

Ext.masterData = [ // autogenall
["true"],
    ["false"]
];

Ext.uI = [ // autogenall
["true"],
    ["false"]
];

Ext.uIForm = [ // autogenall
["true"],
    ["false"]
];

Ext.editOption = [ // autogenall
["true"],
    ["false"]
];

Ext.deleteOption = [ // autogenall
["true"],
    ["false"]
];

Ext.downloadOption = [ // autogenall
["true"],
    ["false"]
];
Ext.isSuperAdmin = [ // autogenall
["true"],
    ["false"]
];

Ext.isGeneratable = [ // autogenall
["true"],
    ["false"]
];

Ext.visible = [ // autogenall
["true"],
    ["false"]
];

Ext.entityGroup = [
    ["cms"],
    ["pms"],
    ["feed"],
    ["user"],
    ["workflow"],
    ["admin"],
    ["domain"]
];

Ext.itemDependentEntityType = [
    ["Media"]
];

Ext.itemRelatedEntityType = [
    ["Article"],
    ["Form"],
    ["Gallery"],
    ["Media"],
    ["Service"]
];

Ext.newsCategory = [
    ["DDNEWS"],
    ["AIR"],
    ["PIB"]
];

Ext.categoryType = [
    ["TempCategory"]
];

Ext.whosWhoCategory = [
    ["President"],
    ["V. President"],
    ["PM"],
    ["LMP"],
    ["Governor"]
];

Ext.metadataCategory = [
    ["TempCategory"]
];

Ext.galleryCategory = [
    ["TempCategory"]
];

Ext.ageCategory = [
    ["1-14"],
    ["14-21"],
    ["21-30"],
    ["30-40"],
    ["40-60"],
    [">60"]
];
Ext.serviceType = [
    ["Obtain"],
    ["Register"],
    ["ApplyFor"]
];
Ext.status = [
    ["Live"],
    ["Draft"]
];

Ext.priority = [
    ["1"],
    ["2"],
    ["3"],
    ["4"],
    ["5"]
];

Ext.rssAggregated = [ // autogenall
["true"],
    ["false"]
];

Ext.gender = [
    ["Male"],
    ["Female"]
];

Ext.whosWhoCat = [
    ["President"],
    ["V. President"],
    ["PM"],
    ["LMP"],
    ["RMP"],
    ["Governor"],
    ["CM"],
    ["Judges"],
    ["Defence Chief"]
];

Ext.mpCategory = [
    ["LS"],
    ["RS"],
    ["OT"]
];



Ext.userRole = [
    ["CMS"],
    ["PortalUser"],
    ["PortalAdmin"]
];

Ext.stateType = [
    ["State"],
    ["Union Territory"]
];


Ext.deptType = [
    ["Department"],
    ["Organisation"],
    ["Body"]
];

Ext.maritalStatus = [
    ["Married"],
    ["Single"],
    ["Divorcee"],
    ["Widow"]
];

Ext.rateUsefullness = [
    ["0"],
    ["1"],
    ["2"],
    ["3"],
    ["4"],
    ["5"]
];

Ext.rateonAspect = [
    ["0"],
    ["1"],
    ["2"],
    ["3"],
    ["4"],
    ["5"]
];

Ext.type = [
    ["Residence"],
    ["Office"],
    ["Business"]
];

Ext.viewer = [
    ["Windows Media Player"],
    ["Flash Player"]
];

Ext.category = [
    ["Bollywood"],
    ["Hollywood"],
    ["Offbeat"],
    ["Others"]
];

Ext.channel = [
    ["Movies"],
    ["Sports"],
    ["Finance"],
    ["News"]
];

Ext.workflow = [
    ["District"],
    ["EntityType"],
    ["Ministry"],
    ["PublisherDepartment"],
    ["PublisherOrgName"],
    ["State"]
];
/*
 * Ext.workflow = [ ["EntityType"], ["ArticleType"], ["Source"],
 * ["AssociatedIAName"], ["State"], ["Language"], ["AssociatedIAID"] ];
 */

Ext.leafOrNonLeaf = [
    ["Terminal"],
    ["Non Terminal"]
];
Ext.workflowType = [
    ["Manual"]
    /*
     * , ["Automatic"]
     */];
Ext.workflowStageType = [
    ["Start"],
    ["Intermediate"],
    ["End"]
];

Ext.mappedFor = [
    ["CmsUserProfile"],
    ["Role"]
];

/**
 * Ext Array declaration Ends here
 */

/**
 *  Ext MimeType Array declaration
 */

Ext.mimeType = [
    ["application/activemessage"],
    ["application/andrew-inset"],
    ["application/annodex"],
    ["application/applefile"],
    ["application/atom+xml"],
    ["application/atomcat+xml"],
    ["application/atomicmail"],
    ["application/atomserv+xml"],
    ["application/batch-SMTP"],
    ["application/bbolin"],
    ["application/beep+xml"],
    ["application/cals-1840"],
    ["application/cap"],
    ["application/commonground"],
    ["application/cu-seeme"],
    ["application/cybercash"],
    ["application/davmount+xml"],
    ["application/dca-rft"],
    ["application/dec-dx"],
    ["application/docbook+xml"],
    ["application/dsptype"],
    ["application/dvcs"],
    ["application/ecmascript"],
    ["application/edi-consent"],
    ["application/edi-x12"],
    ["application/edifact"],
    ["application/eshop"],
    ["application/font-tdpfr"],
    ["application/futuresplash"],
    ["application/ghostview"],
    ["application/hta"],
    ["application/http"],
    ["application/hyperstudio"],
    ["application/iges"],
    ["application/index"],
    ["application/index.cmd"],
    ["application/index.obj"],
    ["application/index.response"],
    ["application/index.vnd"],
    ["application/iotp"],
    ["application/ipp"],
    ["application/isup"],
    ["application/java-archive"],
    ["application/java-serialized-object"],
    ["application/java-vm"],
    ["application/javascript"],
    ["application/json"],
    ["application/m3g"],
    ["application/mac-binhex40"],
    ["application/mac-compactpro"],
    ["application/macwriteii"],
    ["application/marc"],
    ["application/mathematica"],
    ["application/ms-tnef"],
    ["application/msaccess"],
    ["application/msword"],
    ["application/mxf"],
    ["application/news-message-id"],
    ["application/news-transmission"],
    ["application/ocsp-request"],
    ["application/ocsp-response"],
    ["application/octet-stream"],
    ["application/oda"],
    ["application/ogg"],
    ["application/onenote"],
    ["application/parityfec"],
    ["application/pdf"],
    ["application/pgp-encrypted"],
    ["application/pgp-keys"],
    ["application/pgp-signature"],
    ["application/pics-rules"],
    ["application/pkcs10"],
    ["application/pkcs7-mime"],
    ["application/pkcs7-signature"],
    ["application/pkix-cert"],
    ["application/pkix-crl"],
    ["application/pkixcmp"],
    ["application/postscript"],
    ["application/prs.alvestrand.titrax-sheet"],
    ["application/prs.cww"],
    ["application/prs.nprend"],
    ["application/qsig"],
    ["application/rar"],
    ["application/rdf+xml"],
    ["application/remote-printing"],
    ["application/riscos"],
    ["application/rss+xml"],
    ["application/rtf"],
    ["application/sdp"],
    ["application/set-payment"],
    ["application/set-payment-initiation"],
    ["application/set-registration"],
    ["application/set-registration-initiation"],
    ["application/sgml"],
    ["application/sgml-open-catalog"],
    ["application/sieve"],
    ["application/sla"],
    ["application/slate"],
    ["application/smil"],
    ["application/timestamp-query"],
    ["application/timestamp-reply"],
    ["application/vemmi"],
    ["application/vnd.3M.Post-it-Notes"],
    ["application/vnd.accpac.simply.aso"],
    ["application/vnd.accpac.simply.imp"],
    ["application/vnd.acucobol"],
    ["application/vnd.aether.imp"],
    ["application/vnd.android.package-archive"],
    ["application/vnd.anser-web-certificate-issue-initiation"],
    ["application/vnd.anser-web-funds-transfer-initiation"],
    ["application/vnd.audiograph"],
    ["application/vnd.bmi"],
    ["application/vnd.businessobjects"],
    ["application/vnd.canon-cpdl"],
    ["application/vnd.canon-lips"],
    ["application/vnd.cinderella"],
    ["application/vnd.claymore"],
    ["application/vnd.commerce-battelle"],
    ["application/vnd.commonspace"],
    ["application/vnd.comsocaller"],
    ["application/vnd.contact.cmsg"],
    ["application/vnd.cosmocaller"],
    ["application/vnd.ctc-posml"],
    ["application/vnd.cups-postscript"],
    ["application/vnd.cups-raster"],
    ["application/vnd.cups-raw"],
    ["application/vnd.cybank"],
    ["application/vnd.dna"],
    ["application/vnd.dpgraph"],
    ["application/vnd.dxr"],
    ["application/vnd.ecdis-update"],
    ["application/vnd.ecowin.chart"],
    ["application/vnd.ecowin.filerequest"],
    ["application/vnd.ecowin.fileupdate"],
    ["application/vnd.ecowin.series"],
    ["application/vnd.ecowin.seriesrequest"],
    ["application/vnd.ecowin.seriesupdate"],
    ["application/vnd.enliven"],
    ["application/vnd.epson.esf"],
    ["application/vnd.epson.msf"],
    ["application/vnd.epson.quickanime"],
    ["application/vnd.epson.salt"],
    ["application/vnd.epson.ssf"],
    ["application/vnd.ericsson.quickcall"],
    ["application/vnd.eudora.data"],
    ["application/vnd.fdf"],
    ["application/vnd.ffsns"],
    ["application/vnd.flographit"],
    ["application/vnd.framemaker"],
    ["application/vnd.fsc.weblaunch"],
    ["application/vnd.fujitsu.oasys"],
    ["application/vnd.fujitsu.oasys2"],
    ["application/vnd.fujitsu.oasys3"],
    ["application/vnd.fujitsu.oasysgp"],
    ["application/vnd.fujitsu.oasysprs"],
    ["application/vnd.fujixerox.ddd"],
    ["application/vnd.fujixerox.docuworks"],
    ["application/vnd.fujixerox.docuworks.binder"],
    ["application/vnd.fut-misnet"],
    ["application/vnd.google-earth.kml+xml"],
    ["application/vnd.google-earth.kmz"],
    ["application/vnd.grafeq"],
    ["application/vnd.groove-account"],
    ["application/vnd.groove-identity-message"],
    ["application/vnd.groove-injector"],
    ["application/vnd.groove-tool-message"],
    ["application/vnd.groove-tool-template"],
    ["application/vnd.groove-vcard"],
    ["application/vnd.hhe.lesson-player"],
    ["application/vnd.hp-HPGL"],
    ["application/vnd.hp-PCL"],
    ["application/vnd.hp-PCLXL"],
    ["application/vnd.hp-hpid"],
    ["application/vnd.hp-hps"],
    ["application/vnd.httphone"],
    ["application/vnd.hzn-3d-crossword"],
    ["application/vnd.ibm.MiniPay"],
    ["application/vnd.ibm.afplinedata"],
    ["application/vnd.ibm.modcap"],
    ["application/vnd.informix-visionary"],
    ["application/vnd.intercon.formnet"],
    ["application/vnd.intertrust.digibox"],
    ["application/vnd.intertrust.nncp"],
    ["application/vnd.intu.qbo"],
    ["application/vnd.intu.qfx"],
    ["application/vnd.irepository.package+xml"],
    ["application/vnd.is-xpr"],
    ["application/vnd.japannet-directory-service"],
    ["application/vnd.japannet-jpnstore-wakeup"],
    ["application/vnd.japannet-payment-wakeup"],
    ["application/vnd.japannet-registration"],
    ["application/vnd.japannet-registration-wakeup"],
    ["application/vnd.japannet-setstore-wakeup"],
    ["application/vnd.japannet-verification"],
    ["application/vnd.japannet-verification-wakeup"],
    ["application/vnd.koan"],
    ["application/vnd.lotus-1-2-3"],
    ["application/vnd.lotus-approach"],
    ["application/vnd.lotus-freelance"],
    ["application/vnd.lotus-notes"],
    ["application/vnd.lotus-organizer"],
    ["application/vnd.lotus-screencam"],
    ["application/vnd.lotus-wordpro"],
    ["application/vnd.mcd"],
    ["application/vnd.mediastation.cdkey"],
    ["application/vnd.meridian-slingshot"],
    ["application/vnd.mif"],
    ["application/vnd.minisoft-hp3000-save"],
    ["application/vnd.mitsubishi.misty-guard.trustweb"],
    ["application/vnd.mobius.daf"],
    ["application/vnd.mobius.dis"],
    ["application/vnd.mobius.msl"],
    ["application/vnd.mobius.plc"],
    ["application/vnd.mobius.txf"],
    ["application/vnd.motorola.flexsuite"],
    ["application/vnd.motorola.flexsuite.adsi"],
    ["application/vnd.motorola.flexsuite.fis"],
    ["application/vnd.motorola.flexsuite.gotap"],
    ["application/vnd.motorola.flexsuite.kmr"],
    ["application/vnd.motorola.flexsuite.ttc"],
    ["application/vnd.motorola.flexsuite.wem"],
    ["application/vnd.mozilla.xul+xml"],
    ["application/vnd.ms-artgalry"],
    ["application/vnd.ms-asf"],
    ["application/vnd.ms-excel"],
    ["application/vnd.ms-excel.addin.macroEnabled.12"],
    ["application/vnd.ms-excel.sheet.binary.macroEnabled.12"],
    ["application/vnd.ms-excel.sheet.macroEnabled.12"],
    ["application/vnd.ms-excel.template.macroEnabled.12"],
    ["application/vnd.ms-lrm"],
    ["application/vnd.ms-officetheme"],
    ["application/vnd.ms-pki.seccat"],
    ["application/vnd.ms-powerpoint"],
    ["application/vnd.ms-powerpoint.addin.macroEnabled.12"],
    ["application/vnd.ms-powerpoint.presentation.macroEnabled.12"],
    ["application/vnd.ms-powerpoint.slide.macroEnabled.12"],
    ["application/vnd.ms-powerpoint.slideshow.macroEnabled.12"],
    ["application/vnd.ms-powerpoint.template.macroEnabled.12"],
    ["application/vnd.ms-project"],
    ["application/vnd.ms-tnef"],
    ["application/vnd.ms-word.document.macroEnabled.12"],
    ["application/vnd.ms-word.template.macroEnabled.12"],
    ["application/vnd.ms-works"],
    ["application/vnd.mseq"],
    ["application/vnd.msign"],
    ["application/vnd.music-niff"],
    ["application/vnd.musician"],
    ["application/vnd.netfpx"],
    ["application/vnd.noblenet-directory"],
    ["application/vnd.noblenet-sealer"],
    ["application/vnd.noblenet-web"],
    ["application/vnd.novadigm.EDM"],
    ["application/vnd.novadigm.EDX"],
    ["application/vnd.novadigm.EXT"],
    ["application/vnd.oasis.opendocument.chart"],
    ["application/vnd.oasis.opendocument.database"],
    ["application/vnd.oasis.opendocument.formula"],
    ["application/vnd.oasis.opendocument.graphics"],
    ["application/vnd.oasis.opendocument.graphics-template"],
    ["application/vnd.oasis.opendocument.image"],
    ["application/vnd.oasis.opendocument.presentation"],
    ["application/vnd.oasis.opendocument.presentation-template"],
    ["application/vnd.oasis.opendocument.spreadsheet"],
    ["application/vnd.oasis.opendocument.spreadsheet-template"],
    ["application/vnd.oasis.opendocument.text"],
    ["application/vnd.oasis.opendocument.text-master"],
    ["application/vnd.oasis.opendocument.text-template"],
    ["application/vnd.oasis.opendocument.text-web"],
    ["application/vnd.openxmlformats-officedocument.presentationml.presentation"],
    ["application/vnd.openxmlformats-officedocument.presentationml.slide"],
    ["application/vnd.openxmlformats-officedocument.presentationml.slideshow"],
    ["application/vnd.openxmlformats-officedocument.presentationml.template"],
    ["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],
    ["application/vnd.openxmlformats-officedocument.spreadsheetml.template"],
    ["application/vnd.openxmlformats-officedocument.wordprocessingml.document"],
    ["application/vnd.openxmlformats-officedocument.wordprocessingml.template"],
    ["application/vnd.osa.netdeploy"],
    ["application/vnd.palm"],
    ["application/vnd.pg.format"],
    ["application/vnd.pg.osasli"],
    ["application/vnd.powerbuilder6"],
    ["application/vnd.powerbuilder6-s"],
    ["application/vnd.powerbuilder7"],
    ["application/vnd.powerbuilder7-s"],
    ["application/vnd.powerbuilder75"],
    ["application/vnd.powerbuilder75-s"],
    ["application/vnd.previewsystems.box"],
    ["application/vnd.publishare-delta-tree"],
    ["application/vnd.pvi.ptid1"],
    ["application/vnd.pwg-xhtml-print+xml"],
    ["application/vnd.rapid"],
    ["application/vnd.rim.cod"],
    ["application/vnd.s3sms"],
    ["application/vnd.seemail"],
    ["application/vnd.shana.informed.formdata"],
    ["application/vnd.shana.informed.formtemplate"],
    ["application/vnd.shana.informed.interchange"],
    ["application/vnd.shana.informed.package"],
    ["application/vnd.smaf"],
    ["application/vnd.sss-cod"],
    ["application/vnd.sss-dtf"],
    ["application/vnd.sss-ntf"],
    ["application/vnd.stardivision.calc"],
    ["application/vnd.stardivision.chart"],
    ["application/vnd.stardivision.draw"],
    ["application/vnd.stardivision.impress"],
    ["application/vnd.stardivision.math"],
    ["application/vnd.stardivision.writer"],
    ["application/vnd.stardivision.writer-global"],
    ["application/vnd.street-stream"],
    ["application/vnd.sun.xml.calc"],
    ["application/vnd.sun.xml.calc.template"],
    ["application/vnd.sun.xml.draw"],
    ["application/vnd.sun.xml.draw.template"],
    ["application/vnd.sun.xml.impress"],
    ["application/vnd.sun.xml.impress.template"],
    ["application/vnd.sun.xml.math"],
    ["application/vnd.sun.xml.writer"],
    ["application/vnd.sun.xml.writer.global"],
    ["application/vnd.sun.xml.writer.template"],
    ["application/vnd.svd"],
    ["application/vnd.swiftview-ics"],
    ["application/vnd.symbian.install"],
    ["application/vnd.triscape.mxs"],
    ["application/vnd.trueapp"],
    ["application/vnd.truedoc"],
    ["application/vnd.tve-trigger"],
    ["application/vnd.ufdl"],
    ["application/vnd.uplanet.alert"],
    ["application/vnd.uplanet.alert-wbxml"],
    ["application/vnd.uplanet.bearer-choice"],
    ["application/vnd.uplanet.bearer-choice-wbxml"],
    ["application/vnd.uplanet.cacheop"],
    ["application/vnd.uplanet.cacheop-wbxml"],
    ["application/vnd.uplanet.channel"],
    ["application/vnd.uplanet.channel-wbxml"],
    ["application/vnd.uplanet.list"],
    ["application/vnd.uplanet.list-wbxml"],
    ["application/vnd.uplanet.listcmd"],
    ["application/vnd.uplanet.listcmd-wbxml"],
    ["application/vnd.uplanet.signal"],
    ["application/vnd.vcx"],
    ["application/vnd.vectorworks"],
    ["application/vnd.vidsoft.vidconference"],
    ["application/vnd.visio"],
    ["application/vnd.vividence.scriptfile"],
    ["application/vnd.wap.sic"],
    ["application/vnd.wap.slc"],
    ["application/vnd.wap.wbxml"],
    ["application/vnd.wap.wmlc"],
    ["application/vnd.wap.wmlscriptc"],
    ["application/vnd.webturbo"],
    ["application/vnd.wordperfect"],
    ["application/vnd.wordperfect5.1"],
    ["application/vnd.wrq-hp3000-labelled"],
    ["application/vnd.wt.stf"],
    ["application/vnd.xara"],
    ["application/vnd.xfdl"],
    ["application/vnd.yellowriver-custom-menu"],
    ["application/whoispp-query"],
    ["application/whoispp-response"],
    ["application/wita"],
    ["application/x-123"],
    ["application/x-7z-compressed"],
    ["application/x-abiword"],
    ["application/x-apple-diskimage"],
    ["application/x-bcpio"],
    ["application/x-bittorrent"],
    ["application/x-cab"],
    ["application/x-cbr"],
    ["application/x-cbz"],
    ["application/x-cdf"],
    ["application/x-cdlink"],
    ["application/x-chess-pgn"],
    ["application/x-comsol"],
    ["application/x-core"],
    ["application/x-cpio"],
    ["application/x-csh"],
    ["application/x-debian-package"],
    ["application/x-director"],
    ["application/x-dms"],
    ["application/x-doom"],
    ["application/x-dvi"],
    ["application/x-executable"],
    ["application/x-font"],
    ["application/x-freemind"],
    ["application/x-futuresplash"],
    ["application/x-ganttproject"],
    ["application/x-gnumeric"],
    ["application/x-go-sgf"],
    ["application/x-graphing-calculator"],
    ["application/x-gtar"],
    ["application/x-gtar-compressed"],
    ["application/x-hdf"],
    ["application/x-httpd-eruby"],
    ["application/x-httpd-php"],
    ["application/x-httpd-php-source"],
    ["application/x-httpd-php3"],
    ["application/x-httpd-php3-preprocessed"],
    ["application/x-httpd-php4"],
    ["application/x-httpd-php5"],
    ["application/x-ica"],
    ["application/x-info"],
    ["application/x-internet-signup"],
    ["application/x-iphone"],
    ["application/x-iso9660-image"],
    ["application/x-jam"],
    ["application/x-java-applet"],
    ["application/x-java-bean"],
    ["application/x-java-jnlp-file"],
    ["application/x-jmol"],
    ["application/x-kchart"],
    ["application/x-kdelnk"],
    ["application/x-killustrator"],
    ["application/x-koan"],
    ["application/x-kpresenter"],
    ["application/x-kspread"],
    ["application/x-kword"],
    ["application/x-latex"],
    ["application/x-lha"],
    ["application/x-lyx"],
    ["application/x-lzh"],
    ["application/x-lzx"],
    ["application/x-maker"],
    ["application/x-mif"],
    ["application/x-mpegURL"],
    ["application/x-ms-wmd"],
    ["application/x-ms-wmz"],
    ["application/x-msdos-program"],
    ["application/x-msi"],
    ["application/x-netcdf"],
    ["application/x-ns-proxy-autoconfig"],
    ["application/x-nwc"],
    ["application/x-object"],
    ["application/x-oz-application"],
    ["application/x-pkcs7-certreqresp"],
    ["application/x-pkcs7-crl"],
    ["application/x-python-code"],
    ["application/x-qgis"],
    ["application/x-quicktimeplayer"],
    ["application/x-rdp"],
    ["application/x-redhat-package-manager"],
    ["application/x-ruby"],
    ["application/x-rx"],
    ["application/x-scilab"],
    ["application/x-sh"],
    ["application/x-shar"],
    ["application/x-shellscript"],
    ["application/x-shockwave-flash"],
    ["application/x-silverlight"],
    ["application/x-sql"],
    ["application/x-stuffit"],
    ["application/x-sv4cpio"],
    ["application/x-sv4crc"],
    ["application/x-tar"],
    ["application/x-tcl"],
    ["application/x-tex-gf"],
    ["application/x-tex-pk"],
    ["application/x-texinfo"],
    ["application/x-trash"],
    ["application/x-troff"],
    ["application/x-troff-man"],
    ["application/x-troff-me"],
    ["application/x-troff-ms"],
    ["application/x-ustar"],
    ["application/x-videolan"],
    ["application/x-wais-source"],
    ["application/x-wingz"],
    ["application/x-x509-ca-cert"],
    ["application/x-xcf"],
    ["application/x-xfig"],
    ["application/x-xpinstall"],
    ["application/x400-bp"],
    ["application/xhtml+xml"],
    ["application/xml"],
    ["application/xml-dtd"],
    ["application/xml-external-parsed-entity"],
    ["application/xspf+xml"],
    ["application/zip"],
    ["audio/32kadpcm"],
    ["audio/3gpp"],
    ["audio/amr"],
    ["audio/amr-wb"],
    ["audio/annodex"],
    ["audio/basic"],
    ["audio/csound"],
    ["audio/flac"],
    ["audio/g.722.1"],
    ["audio/l16"],
    ["audio/midi"],
    ["audio/mp4a-latm"],
    ["audio/mpa-robust"],
    ["audio/mpeg"],
    ["audio/mpegurl"],
    ["audio/ogg"],
    ["audio/parityfec"],
    ["audio/prs.sid"],
    ["audio/telephone-event"],
    ["audio/tone"],
    ["audio/vnd.cisco.nse"],
    ["audio/vnd.cns.anp1"],
    ["audio/vnd.cns.inf1"],
    ["audio/vnd.digital-winds"],
    ["audio/vnd.everad.plj"],
    ["audio/vnd.lucent.voice"],
    ["audio/vnd.nortel.vbk"],
    ["audio/vnd.nuera.ecelp4800"],
    ["audio/vnd.nuera.ecelp7470"],
    ["audio/vnd.nuera.ecelp9600"],
    ["audio/vnd.octel.sbc"],
    ["audio/vnd.qcelp"],
    ["audio/vnd.rhetorex.32kadpcm"],
    ["audio/vnd.vmx.cvsd"],
    ["audio/x-aiff"],
    ["audio/x-gsm"],
    ["audio/x-mpegurl"],
    ["audio/x-ms-wax"],
    ["audio/x-ms-wma"],
    ["audio/x-pn-realaudio"],
    ["audio/x-pn-realaudio-plugin"],
    ["audio/x-realaudio"],
    ["audio/x-scpls"],
    ["audio/x-sd2"],
    ["audio/x-wav"],
    ["image/cgm"],
    ["image/g3fax"],
    ["image/gif"],
    ["image/ief"],
    ["image/jpeg"],
    ["image/naplps"],
    ["image/pcx"],
    ["image/png"],
    ["image/prs.btif"],
    ["image/prs.pti"],
    ["image/svg+xml"],
    ["image/tiff"],
    ["image/vnd.cns.inf2"],
    ["image/vnd.djvu"],
    ["image/vnd.dwg"],
    ["image/vnd.dxf"],
    ["image/vnd.fastbidsheet"],
    ["image/vnd.fpx"],
    ["image/vnd.fst"],
    ["image/vnd.fujixerox.edmics-mmr"],
    ["image/vnd.fujixerox.edmics-rlc"],
    ["image/vnd.mix"],
    ["image/vnd.net-fpx"],
    ["image/vnd.svf"],
    ["image/vnd.wap.wbmp"],
    ["image/vnd.xiff"],
    ["image/x-canon-cr2"],
    ["image/x-canon-crw"],
    ["image/x-cmu-raster"],
    ["image/x-coreldraw"],
    ["image/x-coreldrawpattern"],
    ["image/x-coreldrawtemplate"],
    ["image/x-corelphotopaint"],
    ["image/x-epson-erf"],
    ["image/x-icon"],
    ["image/x-jg"],
    ["image/x-jng"],
    ["image/x-ms-bmp"],
    ["image/x-nikon-nef"],
    ["image/x-olympus-orf"],
    ["image/x-photoshop"],
    ["image/x-portable-anymap"],
    ["image/x-portable-bitmap"],
    ["image/x-portable-graymap"],
    ["image/x-portable-pixmap"],
    ["image/x-rgb"],
    ["image/x-xbitmap"],
    ["image/x-xpixmap"],
    ["image/x-xwindowdump"],
    ["text/cache-manifest"],
    ["text/calendar"],
    ["text/css"],
    ["text/csv"],
    ["text/directory"],
    ["text/english"],
    ["text/enriched"],
    ["text/h323"],
    ["text/html"],
    ["text/iuls"],
    ["text/mathml"],
    ["text/parityfec"],
    ["text/plain"],
    ["text/prs.lines.tag"],
    ["text/rfc822-headers"],
    ["text/richtext"],
    ["text/rtf"],
    ["text/scriptlet"],
    ["text/t140"],
    ["text/tab-separated-values"],
    ["text/texmacs"],
    ["text/uri-list"],
    ["text/vnd.DMClientScript"],
    ["text/vnd.IPTC.NITF"],
    ["text/vnd.IPTC.NewsML"],
    ["text/vnd.abc"],
    ["text/vnd.curl"],
    ["text/vnd.flatland.3dml"],
    ["text/vnd.fly"],
    ["text/vnd.fmi.flexstor"],
    ["text/vnd.in3d.3dml"],
    ["text/vnd.in3d.spot"],
    ["text/vnd.latex-z"],
    ["text/vnd.motorola.reflex"],
    ["text/vnd.ms-mediapackage"],
    ["text/vnd.sun.j2me.app-descriptor"],
    ["text/vnd.wap.si"],
    ["text/vnd.wap.sl"],
    ["text/vnd.wap.wml"],
    ["text/vnd.wap.wmlscript"],
    ["text/x-bibtex"],
    ["text/x-boo"],
    ["text/x-c++hdr"],
    ["text/x-c++src"],
    ["text/x-chdr"],
    ["text/x-component"],
    ["text/x-crontab"],
    ["text/x-csh"],
    ["text/x-csrc"],
    ["text/x-diff"],
    ["text/x-dsrc"],
    ["text/x-haskell"],
    ["text/x-java"],
    ["text/x-literate-haskell"],
    ["text/x-makefile"],
    ["text/x-moc"],
    ["text/x-pascal"],
    ["text/x-pcs-gcd"],
    ["text/x-perl"],
    ["text/x-python"],
    ["text/x-scala"],
    ["text/x-server-parsed-html"],
    ["text/x-setext"],
    ["text/x-sfv"],
    ["text/x-sh"],
    ["text/x-tcl"],
    ["text/x-tex"],
    ["text/x-vcalendar"],
    ["text/x-vcard"],
    ["video/3gpp"],
    ["video/MP2T"],
    ["video/annodex"],
    ["video/dl"],
    ["video/dv"],
    ["video/fli"],
    ["video/gl"],
    ["video/mp4"],
    ["video/mp4v-es"],
    ["video/mpeg"],
    ["video/ogg"],
    ["video/parityfec"],
    ["video/pointer"],
    ["video/quicktime"],
    ["video/vnd.fvt"],
    ["video/vnd.motorola.video"],
    ["video/vnd.motorola.videop"],
    ["video/vnd.mpegurl"],
    ["video/vnd.mts"],
    ["video/vnd.nokia.interleaved-multimedia"],
    ["video/vnd.vivo"],
    ["video/webm"],
    ["video/x-flv"],
    ["video/x-la-asf"],
    ["video/x-matroska"],
    ["video/x-mng"],
    ["video/x-ms-asf"],
    ["video/x-ms-wm"],
    ["video/x-ms-wmv"],
    ["video/x-ms-wmx"],
    ["video/x-ms-wvx"],
    ["video/x-msvideo"],
    ["video/x-sgi-movie"]
]

Ext.treeEntity = [ 
["true"],
    ["false"]
];

/**
 * logical operators array declaration for advanced search
 */

var arrayCombineFields = [{ 
    name: 'AND',
    value: 'AND'
}, {
    name: 'OR',
    value: 'OR'
}];

/**
 * conditional operators array declaration for advanced search
 */
var arrayEqualFields = [{
    name: '=',
    value: '='
}, {
    name: '!=',
    value: '!='
}];

/**
 * Global variable declaration
 */

var treePanelParentPath = ""; // used in setTreePath()
var currentEntityItemId = ''; // used in all createWindow functions
var dynamicEntityType = "media"; // default entity type dependent search
var dynamicRelatedType = ""; // default entity type related search
var WorkflowStageArray = []; // Stages selected items array container
var WorkflowStageValue = '';
var worklfowFormAction = '';
//var filterByMenu = '';
var globalEntityName = ''; 
var globalActiveTab = '';
var ItemThumbnailPath = '';
var pmsErrorpanel;
var cmsErrorpanel;
var adminErrorpanel;
var jtext = "";
var aForms = new Array(); // Array of all available opended window forms
var workflowForms = new Array(); // Array of all available opended workflow 
								//	entity forms
var workflowUserMapProperties = '';
var itemsJsonData = {};
var layoutTemplatePath = '';
var npiMetaData = ''; 

/**
 * Global Array declaration ends here
 */

/**
 * This event Fires if an error HTTP status was returned from the server
 */

Ext.Ajax.on('requestexception', function (conn, response, options) {
    if (response.status == 400) {
	    //if(getCookie('auth_token') || getCookie('api_key')){
    	    if(getCookie('api_key')){
		destroyServerSession();
		showSessionExpired();
	    }
    }
    if (response.status == 401) {
        var actionString = response.responseText;
        var errMsg = '';
        if (!Ext.isEmpty(actionString)) {
            if (typeof (actionString) != "undefined") {
                errMsg = getCustomErrorInfo(actionString);
            }
        }
        Ext.DropDownAlert.msg("<div class = 'errorHeaderMsg'>Access Denied</div>", 
        		"<div class = 'errorMsg'>" + errMsg + "</div>");
    }
    if (response.status == 503) {
        Ext.DropDownAlert.msg("<div class = 'errorHeaderMsg'>Server Unreachable</div>", 
        		"<div class = 'errorMsg'>Service temporarily unavailable</div>");
    }
});

function destroyServerSession(){
    /*Ext.Ajax.request({
	      url: authPostUrl + "&auth_token=" + getCookie("auth_token"),
	      async : false,
	      success: function () {
	    	  logoutDestroy();
		  loginRedirection();
	      },
	      failure: function () {
	    	  logoutDestroy();
		  loginRedirection();
	      },
	      method: 'Delete'
	  }); */
}


/**
 * This Method displays a popup window to re-login if the session has expired 
 */

function showSessionExpired() {
      Ext.Ajax.abortAll();
    var sessionWindow = new Ext.Window({
        title: "Session Expired",
        modal: true,
        closable: false,
        width: 300,
        height: 150,
        html: "<H2 align=center>Please click OK to re-login.</H3>",
        //items : [{html:"Please login to continue."}], 
        buttons: [{
            text: 'OK',
            id: 'session-ok',
            handler: function () {
            	destroyServerSession();
                loginRedirection();
                sessionWindow.close();
            }
        }],
        keys: [{
            key: [Ext.EventObject.ENTER],
            handler: function () {
            	destroyServerSession();
            	loginRedirection();
                sessionWindow.close();
            }
        }, {
            key: [Ext.EventObject.ESC],
            handler: function () {
            	destroyServerSession();
                loginRedirection();
                sessionWindow.close();
            }
        }]
    });
    sessionWindow.show();
}

/**
 * This event fires before a network request is made to retrieve a data.
 */
Ext.Ajax.on('beforerequest', function (conn, response, options) {
    if (!isAuthenticated()) {
	//if(getCookie('auth_token') || getCookie('api_key')){
    	if(getCookie('api_key')){
	        destroyServerSession();
		showSessionExpired();
	    }
        return false;
    }
});

/**
 * This event Fires if the request was successfully completed.
 */

Ext.Ajax.on('requestcomplete', function (conn, response, options) {
    if (response.status != 200 && response.responseText != '') {
        Ext.MessageBox.hide();
        try {
            var pmsResponse = JSON.parse(response.responseText);
            if (pmsResponse.success != 'true') {
                // alert(response.responseText);
            }
        } catch (error) {
            Ext.MessageBox.hide();
            if (aForms[0] && aForms[0].findField('FilePath')) {
                aForms[0].findField('FilePath').setValue('');
            }
            if (globalEntityName == "Css" || globalEntityName == "Js" 
            	|| globalEntityName == "Template") {
                pmsErrorpanel.expand(false);
                pmsErrorpanel.update("<div class = 'errorHeaderMsg'>" 
                		+ response.responseText + "</div>");
            } else if (globalEntityName == "Media") {
                pmsErrorpanel.expand(false);
                pmsErrorpanel.update("<div class = 'errorHeaderMsg'>" 
                		+ response.responseText + "</div>");
                cmsErrorpanel.expand(false);
                cmsErrorpanel.update("<div class = 'errorHeaderMsg'>" 
                		+ response.responseText + "</div>");
            } else if (globalEntityName == "Validations" 
            	|| globalEntityName == "AccessControlList") {
                adminErrorpanel.expand(false);
                adminErrorpanel.update("<div class = 'errorHeaderMsg'>" 
                		+ response.responseText + "</div>");
            }
        }
    }
    /*else if(response.responseText == ''){
		Ext.MessageBox.hide();
		var alertMsg = 'Invalid Content OR Server Error';
		if(aForms[0] && aForms[0].findField('FilePath')){
				aForms[0].findField('FilePath').setValue('');
		}
		if(globalEntityName == "Css" || globalEntityName == "Js" 
			|| globalEntityName == "Template"){
			pmsErrorpanel.expand(false); 
			pmsErrorpanel.update("<div class = 'errorHeaderMsg'>" + alertMsg + "</div>");
		}
		else if(globalEntityName == "Media" ){
			pmsErrorpanel.expand(false); 
			pmsErrorpanel.update("<div class = 'errorHeaderMsg'>" + alertMsg + "</div>");
			cmsErrorpanel.expand(false); 
			cmsErrorpanel.update("<div class = 'errorHeaderMsg'>" + alertMsg + "</div>");
		}
		else if(globalEntityName == "Validations" || globalEntityName == "AccessControlList"){
			adminErrorpanel.expand(false); 
			adminErrorpanel.update("<div class = 'errorHeaderMsg'>" + alertMsg + "</div>");
		}
	}*/
}, this);

/**
 * Model Definition for Dependent and Related Item
 */

Ext.define("ItemSearch", {
    extend: 'Ext.data.Model',
    proxy: {
        type: 'jsonp',
        url: dataservicesPath + '/search?q=&format=extjson&status=published&entitytype=' + dynamicEntityType,
        reader: {
            type: 'json',
            root: 'Collections.' + dynamicEntityType,
            totalProperty: 'Collections.Count'
        }
    },

    fields: [{
        name: 'ItemId',
        mapping: 'Id'
    }, {
        name: 'ItemEntityType',
        mapping: 'EntityType'
    }, {
        name: 'ItemTitle',
        mapping: 'Title'
    }, {
        name: 'ItemDescription',
        mapping: 'Description'
    }, {
        name: 'ItemFilePath',
        mapping: 'FilePath'
    }, {
        name: 'ItemThumbnailPath',
        mapping: 'ThumbnailPath'
    }]
});

/**
 * Template declaration for dependent and related item
 */

var imageTpl = new Ext.XTemplate('<tpl for=".">', '<div class="thumb-wrap" id="{name}">', '<tpl if="this.isTrue(ItemEntityType) && ItemThumbnailPath!==&quot;&quot;">', '<div class="thumb"><img src=' + mediaPath + '{ItemThumbnailPath} width=100 height=80 title="{ItemTitle}"></div>', '</tpl>', '<tpl if="this.isTrue(ItemEntityType) == false || ItemThumbnailPath==&quot;&quot;">', '<div class="thumb"><img src=' + imagePath + '/status-icons/{ItemEntityType}.jpg width=100 height=80 title="{ItemTitle}"></div>', '</tpl>', '<span class="x-editable"></span></div>', '</tpl>', '<div class="x-clear"></div>', {
    isTrue: function (name) {
        return name == 'Media';
    }
});

/**
 * Method to create a context menu for related/dependent item 
 * @param record {Object}
 * @param view {Ext.grid.panel}
 * @returns
 */
function itemContextMenu(record, view) {

    var ctextMenu = Ext.create('Ext.menu.Menu', {
        items: [{
            text: 'Set Title',
            checked: false,
            group: 'title',
            handler: function () {
                itemContextMenuHandler(record, "title");
            }
        }, {
            text: 'Set Description',
            checked: false,
            group: 'description',
            handler: function () {
                itemContextMenuHandler(record, "description");
            }
        }, {
            text: 'Get Id',
            checked: false,
            group: 'id',
            handler: function () {
                itemContextMenuHandler(record, "id");
            }
        }, {
            text: 'Clear',
            checked: false,
            group: 'clear',
            handler: function () {
                view.getStore().remove(record);
            }
        }, {
            text: 'Clear All',
            checked: false,
            group: 'clearall',
            handler: function () {
                view.getStore().removeAll();
            }
        }],
        scope: this
    });
    return ctextMenu;
}

/**
 * Method to give delete provision for related/dependent item 
 * @param record {Object}
 * @param view {Ext.grid.panel}
 * @returns
 */

function contextWorkflowStageDelete(record, view) {
    var ctextMenu = Ext.create('Ext.menu.Menu', {
        items: [{
            text: 'Delete',
            // checked:false,
            handler: function () {
                view.getStore().remove(record);
            }
        }],
        scope: this
    });
    return ctextMenu;
}

/**
 * Method to display thumb icon for related/dependent item 
 * @param val {String}
 * @returns {String}
 */

function thumbIcon(val) {
    return '<img src="' + mediaPath + val + '" width=80 height=60>';
}

/**
 * Method to display context menu and performs add/edit action in related/dependent item 
 * @param record {Object}
 * @param view {Ext.grid.panel}
 * @returns
 */

function itemContextMenuHandler(record, currentItem) {
    var winTitle = "";
    var xtypeField = "";
    var itemContent = "";

    if (currentItem == "title") {
        winTitle = "Set Title";
        xtypeField = "textarea";
        itemContent = record.data.ItemTitle;
    } else if (currentItem == "description") {
        winTitle = "Set Description";
        xtypeField = "htmleditor";
        itemContent = record.data.ItemDescription;
    } else if (currentItem == "id") {
        winTitle = "Item Id";
        xtypeField = "textarea";
        itemContent = record.data.ItemId;
    }

    function setItemPickContent(currentItem, val) {
        if (currentItem == "title") {
            record.set("ItemTitle", val);
        } else if (currentItem == "description") {
            record.set("ItemDescription", val);
        }
        record.commit();
    }

    var formPanel = Ext.create('Ext.form.Panel', {
        frame: true,
        region: 'center',
        // bodyStyle:'padding: 5px 5px 5px 5px',
        layout: 'fit',
        fieldDefaults: {
            msgTarget: 'side'
        },
        resizable: false,
        scope: this,
        items: [{
            xtype: xtypeField,
            name: 'itemPickContent',
            id: 'itemPickContent',
            anchor: '100%',
            allowBlank: false,
            listeners: {
                render: function () {
                    this.setValue(itemContent);
                }
            }
        }]
    });

    if (!contextwin) {
        var contextwin = Ext.create('Ext.window.Window', {
            width: 550,
            height: 240,
            layout: 'fit',
            plain: true,
            autoScroll: true,
            resizable: false,
            // closeAction: 'hide',
            items: formPanel,
            buttons: [{
                text: 'Ok',
                scope: formPanel,
                formBind: true,
                handler: function () {
                    var itemPickContent = Ext.getCmp('itemPickContent');
                    setItemPickContent(currentItem, itemPickContent.getValue());
                    contextwin.close();
                }
            }, {
                text: 'Cancel',
                handler: function () {
                    formPanel.getForm().reset();
                    contextwin.close();
                }
            }]
        });
    }

    contextwin.setTitle(winTitle);
    contextwin.show();
}

/**
 * Dependent Itempanelform declaration starts here 
 */

var DependentItemPanelForm = [{
    name: "ItemDependentEntityType",
    id: "ItemDependentEntityType",
    editable: false,
    xtype: 'combo',
    fieldLabel: "EntityType",
    store: Ext.create('Ext.data.ArrayStore', {
        fields: ["itemDependentEntityType"],
        autoLoad: true,
        data: Ext.itemDependentEntityType // from data.js
    }),
    queryMode: "local",
    displayField: "itemDependentEntityType",
    valueField: "itemDependentEntityType"
}, {
    // region:'center',
    store: Ext.create('Ext.data.Store', {
        pageSize: 10,
        model: 'ItemSearch'
    }),
    xtype: 'combo',
    scope: this,
    displayField: 'ItemTitle',
    fieldLabel: 'Enter keywords',
    labelWidth: 100,
    minChars: 2,
    width: 600,
    // scope:dependentSearchField,
    typeAhead: false,
    multiSelect: true,
    hideLabel: false,
    hideTrigger: false,
    selectOnFocus: true,
    listConfig: {
        loadingText: 'Searching...',
        emptyText: 'No matching records found.',
        // Custom rendering template for each item
        getInnerTpl: function () {
            return '<div class="search-item">' + '<table border=0>' + '<tr><td rowspan=2>' + '<tpl if="ItemEntityType==&quot;Media&quot; && ItemThumbnailPath!==&quot;&quot;">' + '<img src=' + mediaPath + '{ItemThumbnailPath} width=100 height=80 />' + '</tpl>' + '<tpl if="ItemThumbnailPath==&quot;&quot;">' + '<img src=' + imagePath + '/status-icons/{ItemEntityType}.jpg width=100 height=80 />' + '</tpl>' + '</td><td>{ItemMediaName}</td></tr>' + '<tr><td>{ItemTitle}</td></tr></table>' + '</div>';
        }
    },
    pageSize: 10,
    listeners: {
        select: function (combo, selection) {
            var dependentView = Ext.getCmp('dependent-images-view');
            for (var i = 0; i < selection.length; i++) {
                var id = selection[i].data.ItemId;
                var exists = dependentView.store.find('ItemId', id);
                if (exists == -1) {
                    dependentView.store.add(selection[i]);
                }
            }
        },
        /*
         * focus : function(){ this.setValue(''); },
         */
        beforequery: function (eventObj) {
            var dependentEntityCombo = Ext.getCmp('ItemDependentEntityType');
            this.store.proxy.url = dataservicesPath + '/search?q=&format=extjson&status=published&entitytype=' + dependentEntityCombo.getValue().toLowerCase();
            this.store.proxy.setReader({
                type: 'json',
                root: 'Collections.' + dependentEntityCombo.getValue(),
                totalProperty: 'Collections.Count'
            });
        }
    }
}, {
    xtype: 'dataview',
    id: 'dependent-images-view',
    fieldLabel: 'Available Dependent Items',
    border: '10 5 3 10',
    store: Ext.create('Ext.data.Store', {
        model: 'ItemSearch',
        autoScroll: true,
        storeId: 'itemDependentViewStore',
        pageSize: itemsPerPage,
        autoLoad: false,
        proxy: {
            type: 'jsonp',
            url: dataservicesPath + '/search?q=&format=extjson&status=published&entitytype=article',
            reader: {
                type: 'json',
                root: 'Collections.DependentItems'
            }
        }
    }),
    tpl: imageTpl,
    height: 400,
    border: true,
    trackOver: true,
    overItemCls: 'x-item-over',
    cls: 'x-image-view',
    itemSelector: 'div.thumb-wrap',
    emptyText: 'No Items Available',
    plugins: new dnd.SortableDataView(),
    listeners: {
        itemcontextmenu: function (View, record, item, index, e, options) {
            e.stopEvent();
            var dependentView = Ext.getCmp('dependent-images-view');
            var cMenu = itemContextMenu(record, dependentView);
            cMenu.showAt(e.getXY());
            return false;
        }
    }
}];

/**
 * Dependent Itempanelform declaration Ends here 
 */

/**
 * Related Itempanelform declaration Starts here 
 */

var RelatedItemPanelForm = [{
    name: "ItemRelatedEntityType",
    id: "ItemRelatedEntityType",
    editable: false,
    xtype: 'combo',
    fieldLabel: "EntityType",
    store: Ext.create('Ext.data.ArrayStore', {
        fields: ["itemRelatedEntityType"],
        autoLoad: true,
        data: Ext.itemRelatedEntityType // from data.js
    }),
    queryMode: "local",
    valueField: "itemRelatedEntityType",
    displayField: "itemRelatedEntityType"
}, {
    store: Ext.create('Ext.data.Store', {
        pageSize: 10,
        model: 'ItemSearch'
    }),
    // scope: relatedPanel,
    displayField: 'ItemTitle',
    labelWidth: 100,
    xtype: 'combo',
    minChars: 2,
    fieldLabel: 'Enter keywords',
    typeAhead: false,
    multiSelect: true,
    hideLabel: false,
    hideTrigger: false,
    scope: this,
    width: 600,
    listConfig: {
        loadingText: 'Searching...',
        emptyText: 'No matching records found.',
        // Custom rendering template for each item
        getInnerTpl: function () {
            return '<div class="search-item">' + '<table border=0>' + '<tr><td rowspan=2>' + '<tpl if="ItemEntityType==&quot;Media&quot;  && ItemThumbnailPath!==&quot;&quot;">' + '<img src=' + mediaPath + '{ItemThumbnailPath} width=100 height=80 />' + '</tpl>' + '<tpl if="ItemEntityType!==&quot;Media&quot; || ItemThumbnailPath==&quot;&quot;">' + '<img src=' + imagePath + '/status-icons/{ItemEntityType}.jpg width=100 height=80 />' + '</tpl>' + '</td><td>{ItemMediaName}</td></tr>' + '<tr><td>{ItemTitle}</td></tr></table>' + '</div>';
        }
    },
    pageSize: 10,
    listeners: {
        select: function (combo, selection) {
            var relatedView = Ext.getCmp('related-images-view');
            for (var i = 0; i < selection.length; i++) {
                var id = selection[i].data.ItemId;
                var exists = relatedView.store.find('ItemId', id);
                if (exists == -1) {
                    relatedView.store.add(selection[i]);
                }
            }
        },
        /*
         * focus: function(){ this.setValue(''); },
         */
        beforequery: function (eventObj) {
            var relatedEntityCombo = Ext.getCmp('ItemRelatedEntityType');
            this.store.proxy.url = dataservicesPath + '/search?q=&format=extjson&status=published&entitytype=' + relatedEntityCombo.getValue().toLowerCase();
            this.store.proxy.setReader({
                type: 'json',
                root: 'Collections.' + relatedEntityCombo.getValue(),
                totalProperty: 'Collections.Count'
            });
        },
        onTriggerClick: function (e) {
            this.updateBox(e);
            this.expand();
        }
    }
}, {
    xtype: 'dataview',
    id: 'related-images-view',
    border: '10 5 3 10',
    store: Ext.create('Ext.data.Store', {
        model: 'ItemSearch',
        storeId: 'itemRelatedViewStore',
        autoScroll: true,
        pageSize: itemsPerPage,
        autoLoad: false,
        proxy: {
            type: 'jsonp',
            url: dataservicesPath + '/search?q=&format=extjson&status=published&entitytype=article',
            reader: {
                type: 'json',
                root: 'Collections.RelatedItems'
            }
        }
    }),
    tpl: imageTpl,
    // multiSelect: true,
    border: true,
    height: 400,
    trackOver: true,
    cls: 'x-image-view',
    overItemCls: 'x-item-over',
    itemSelector: 'div.thumb-wrap',
    emptyText: 'No Items Available',
    plugins: new dnd.SortableDataView(),
    listeners: {
        itemcontextmenu: function (View, record, item, index, e, options) {
            var relatedView = Ext.getCmp('related-images-view');
            e.stopEvent();
            var cMenu = itemContextMenu(record, relatedView);
            cMenu.showAt(e.getXY());
            return false;
        }
    }
}];

/**
 * Related Itempanelform declaration Ends here 
 */

/**
 * Loader Configuration file includes for ncmsui 
 */

Ext.Loader.setConfig({
    enabled: true
});
Ext.Loader.setPath('Ext.ux', '/ncmsui/extjs/ux/');
Ext.require(['Ext.grid.*', 'Ext.data.*', 'Ext.util.*', 'Ext.Action', 'Ext.tab.*', 'Ext.button.*', 'Ext.form.*', 'Ext.layout.container.Card', 'Ext.layout.container.Border', 'Ext.ux.PreviewPlugin']);

/**
* Method to create and return a store reference with predefined configuration 
* to load generated json data with filter
* @param root {String} 
* @param queryParams {String}
* @param sortField {String}
* @returns Json store
*/

function createStore(root, queryParam, sortField) {
    var storeUrl = '';
    if(Ext.Array.contains(domainSpecifMasterData,root)){
      storeUrl = domainSpecificMasterDataUrl;
    }
    else{
      storeUrl = apacheNcmsData;
    }
    var cs = Ext.create('Ext.data.Store', {
        autoLoad: false,
        pageSize: 100,
        sortOnFilter: true,
        model: 'NcmsUIModel',
        remoteFilter: false,
        proxy: {
            type: 'ajax',
            noCache: true,
            url: storeUrl + "/" + root + ".json",
            reader: {
                type: 'json',
                root: 'Collections.' + root,
                totalProperty: 'Collections.Count'
            }
        },
        sorters: [{
            property: sortField,
            direction: 'ASC'
        }],
        listeners : {
        	load : function(){
        	    if (!Ext.isEmpty(queryParam)) {
        	        var queryArray = queryParam.split('&');
        	        for (var i = 0; i < queryArray.length; i++) {
        	            var keyValuePairs = queryArray[i].split('=');
        	            //alert(keyValuePairs[0] + "" + keyValuePairs[1]);
        	            this.filter(keyValuePairs[0], keyValuePairs[1]);
        	        }
        	    }
        	}
        	
        }
    });
    return cs;
}

/**
* Method to create and return a store reference with predefined configuration 
* to load generated json data
* @param root {String} 
* @param queryParams {String}
* @param sortField {String}
* @returns Json store
*/

function createQueryStore(root, queryParam, sortField) {
    if (!Ext.isEmpty(queryParam)) {
        queryParam = '&' + queryParam;
    } else {
        queryParam = '';
    }
    var cs = Ext.create('Ext.data.Store', {
        autoLoad: false,
        pageSize: 100,
        model: 'NcmsUIModel',
        proxy: {
            type: 'ajax',
            noCache: false,
            url: encodeURI(getWorkflowEntityQuery(root) + queryParam),
            // url : apacheNcmsData + "/" + root + ".json",
            reader: {
                type: 'json',
                root: 'Collections.' + root,
                totalProperty: 'Collections.Count'
            },
            simpleSortMode: true
        }
        // sorters:[{property:sortField, direction:'ASC'}]
    });
    /*
     * if(!Ext.isEmpty(queryParam)){ var queryArray = queryParam.split('&');
     * for(var i = 0; i < queryArray.length; i++){ var keyValuePairs =
     * queryArray[i].split('='); cs.filter(keyValuePairs[0],keyValuePairs[1]); } }
     */
    return cs;
}

 /**
 * Method to create and return a store reference with predefined configuration 
 * and url query params are dynamically passed 
 * @param root {String} 
 * @param queryParams {String}
 * @param sortField {String}
 * @returns Json store
 */

function createPreloadedStore(root, queryParams, sortField) {
    if (!Ext.isEmpty(queryParams)) {
        if (queryParams.toLowerCase() == 'contentcreator') {
            if (!isSuperAdmin()) {
                queryParams = "&contentcreator=" + cmsUserName;
            } else {
                queryParams = '';
            }
        } else {
            queryParams = '&' + queryParams;
        }
    } else {
        queryParams = '';
    }

    var cps = Ext.create('Ext.data.Store', {
        autoLoad: false,
        pageSize: 100,
        model: 'NcmsUIModel',
        proxy: {
            type: 'jsonp',
            noCache: true,
            url: encodeURI(getWorkflowEntityQuery(root) + queryParams),
            reader: {
                type: 'json',
                root: 'Collections.' + root,
                totalProperty: 'Collections.Count'
            },
            simpleSortMode: true
        },
        listener: {
            loadexception: function (qe) {
                delete qe.combo.lastQuery;
                this.proxy.noCache = true;
            }
        }
    });
    return cps;
}

var cellEditing = Ext.create('Ext.grid.plugin.CellEditing', {
    clicksToEdit: 1
});

/**
 * Method to display Add/Edit form for all cms entities 
 * @param grid {Ext.grid.panel} 
 * @param rowIndex {Integer}
 * @param formAction {String}
 * @param activeMainPanelGrid {Ext.grid.panel}
 * @param preload {Boolean}
 */


function cmsCreateWindow(grid, rowIndex, formAction, activeMainPanelGrid, preload) {
    globalEntityName = cmsCurrentEntity;
    var winHeight = getWindowHeight();
    cmsErrorpanel = Ext.create("Ext.panel.Panel", {
        title: 'Error Info',
        region: 'south',
        layout: 'fit',
        height: 100,
        collapsed: true,
        collapsible: true,
        autoScroll: true
    });
    var formItem = Ext.create("Ext.tab.Panel", {
        activeTab: 0,
        region: 'center',
        autoScroll: true,
        labelStyle: 'white-space: nowrap;',
        width: 750,
        height: 450,
        defaults: {
            bodyStyle: 'padding:10px'
        },
        items: [Ext.JSON.decode(cmsCurrentEntity + "Form")],
        scope: Ext.JSON.decode(cmsCurrentEntity + "Form")
    });

    var wintitle = formAction == "edit" ? 'Edit' : 'Add New';
    if (formAction != 'new') {
        var currentEntityItem = grid.getStore().getAt(rowIndex);
        currentEntityItemId = currentEntityItem.data.Id;
    }
    if (!cmsWindow) {
        var cmsWindow = new Ext.Window({
            // closeAction : 'hide',
            autoScroll: true,
            title: wintitle,
            modal: true,
            //ZIndexManager: new Ext.ZIndexManager
            layout: 'border',
            height: winHeight,
            width: 755,
            items: [formItem, cmsErrorpanel],
            // [ formItem,cmsErrorpanel ],
            buttons: [{
                text: 'Save',
                id: 'cms-save',
                iconCls: 'icon-disk',
                scope: Ext.JSON.decode(cmsCurrentEntity + "Form"),
                formBind: true,
                handler: function () {
                    // loadFormsArray(cmsCurrentEntity);
                    saveEntity(activeMainPanelGrid, cmsWindow, cmsCurrentEntity, formAction, cmsErrorpanel, currentEntityItem);
                },
                listeners: {
                    render: function () {
                        if (formAction == "edit") {
                            this.setText('Update');
                        }
                    }
                }
            }, {
                text: 'Cancel',
                id: 'cms-cancel',
                iconCls: 'icon-wincancel',
                handler: function () {
                    cmsWindow.close();
                }
            }]
        });
        cmsWindow.on('close', function () {
            hideHtmlEditor();
            aForms = new Array();
            var dependentView = Ext.getCmp('dependent-images-view');
            var relatedView = Ext.getCmp('related-images-view');
            if (!Ext.isEmpty(dependentView)) {
                dependentView.store.removeAll();
            }
            if (!Ext.isEmpty(relatedView)) {
                relatedView.store.removeAll();
            }
            treePanelParentPath = '';
        });

    }
    cmsWindow.setTitle(wintitle);
    loadFormsArray(cmsCurrentEntity);
    if (preload) {
        if (grid != 'getfields') {
            comboPreLoader(grid, rowIndex, formAction, preload);
        }
        return false;
    }
    if (formAction != 'new') {
        comboPreLoader(grid, rowIndex, formAction, preload);
    }
    cmsWindow.show();
}

/**
 * Method to display Add/Edit form for all pms entities 
 * @param grid {Ext.grid.panel} 
 * @param rowIndex {Integer}
 * @param formAction {String}
 * @param activeMainPanelGrid {Ext.grid.panel}
 * @param preload {Boolean}
 */

function pmsCreateWindow(grid, rowIndex, formAction, activeMainPanelGrid, preload) {
    globalEntityName = pmsCurrentEntity;
    var winHeight = getWindowHeight();
    if (pmsCurrentEntity == "PageAssociator") {
        pageFormPanel.getForm().reset();
    }
    pmsErrorpanel = Ext.create("Ext.panel.Panel", {
        title: 'Error Info',
        region: 'south',
        height: 100,
        collapsed: true,
        collapsible: true,
        autoScroll: true
    });
    var formItem = Ext.create("Ext.tab.Panel", {
        activeTab: 0,
        region: 'center',
        autoScroll: true,
        width: 700,
        height: 450,
        defaults: {
            bodyStyle: 'padding:10px'
        },
        items: [Ext.JSON.decode(pmsCurrentEntity + "Form")],
        scope: Ext.JSON.decode(pmsCurrentEntity + "Form")
    });

    if (formAction != 'new') {
        var currentEntityItem = grid.getStore().getAt(rowIndex);
        currentEntityItemId = currentEntityItem.data.Id;
    }

    var wintitle = formAction == "edit" ? 'Edit' : 'Add New';
    var pmsWindow = new Ext.Window({
        // closeAction : 'hide',
        autoScroll: true,
        title: wintitle,
        modal: true,
        layout: 'border',
        height: winHeight,
        width: 715,
        items: [formItem, pmsErrorpanel],
        buttons: [{
            text: 'Save',
            id: 'pms-save-btn',
            iconCls: 'icon-disk',
            scope: Ext.JSON.decode(pmsCurrentEntity + "Form"),
            formBind: true,
            handler: function () {
                // loadFormsArray(pmsCurrentEntity);
                try {
                    saveEntity(activeMainPanelGrid, pmsWindow, pmsCurrentEntity, formAction, pmsErrorpanel, currentEntityItem);
                } catch (error) {
                    Ext.MessageBox.hide();
                }
            },
            listeners: {
                render: function () {
                    if (formAction == "edit") {
                        this.setText('Update');
                    }
                }
            }
        }, {
            text: 'Cancel',
            iconCls: 'icon-wincancel',
            handler: function () {
                pmsWindow.close();
            }

        }]
    });

    if (pmsCurrentEntity === "PageAssociator") {
        pmsWindow.closeAction = 'hide';
        pageAssoEntityTree.getView().refresh();
        pageAssoIaTree.getView().refresh();
        Ext.getCmp('pms-save-btn').setVisible(false);
    } else {
        Ext.getCmp('pms-save-btn').setVisible(true);
    }

    pmsWindow.on('close', function () {
        hideHtmlEditor();
        aForms = new Array();
        treePanelParentPath = '';
    });
    pmsWindow.setTitle(wintitle);
    loadFormsArray(pmsCurrentEntity);
    if (preload) {
        if (preload) {
            if (grid != 'getfields') {
                comboPreLoader(grid, rowIndex, formAction, preload);
            }
            return false;
        }
    }
    if (formAction != 'new' && pmsCurrentEntity != 'PageAssociator') {
        comboPreLoader(grid, rowIndex, formAction, preload);
    }
    pmsWindow.show();
}

/**
 * Method to display Add/Edit form for all user entities 
 * @param grid {Ext.grid.panel}  
 * @param rowIndex {Integer}
 * @param formAction {String}
 * @param activeMainPanelGrid {Ext.grid.panel}
 * @param preload {Boolean}
 */

function userCreateWindow(grid, rowIndex, formAction, activeMainPanelGrid, preload) {
    var userErrorpanel = Ext.create("Ext.panel.Panel", {
        title: 'Error Info',
        region: 'south',
        height: 100,
        collapsed: true,
        collapsible: true,
        autoScroll: true
    });
    var winHeight = getWindowHeight();
    var formItem = Ext.create("Ext.tab.Panel", {
        activeTab: 0,
        region: 'center',
        autoScroll: true,
        width: 700,
        height: 450,
        defaults: {
            bodyStyle: 'padding:10px'
        },
        items: [Ext.JSON.decode(userCurrentEntity + "Form")],
        scope: Ext.JSON.decode(userCurrentEntity + "Form")
    });
    var wintitle = formAction == "edit" ? 'Edit' : 'Add New';
    if (formAction != 'new') {
        var currentEntityItem = grid.getStore().getAt(rowIndex);
        currentEntityItemId = currentEntityItem.data.Id;
    }
    if (!userWindow) {
        var userWindow = new Ext.Window({
            // closeAction : 'hide',
            autoScroll: true,
            title: wintitle,
            modal: true,
            layout: 'border',
            height: winHeight,
            width: 715,
            items: [formItem, userErrorpanel],
            buttons: [{
                text: 'Save',
                iconCls: 'icon-disk',
                scope: Ext.JSON.decode(userCurrentEntity + "Form"),
                formBind: true,
                handler: function () {
                   saveEntity(activeMainPanelGrid, userWindow, userCurrentEntity, formAction, userErrorpanel, currentEntityItem);
                },
                listeners: {
                    render: function () {
                        if (formAction == "edit") {
                            if (userCurrentEntity == "CmsUserProfile") {
                                if (isSuperAdmin() && (currentEntityItem.data.UserName != getCookie("authusername"))) {
                                    Ext.getCmp("CmsUserProfileOldPassword").setVisible(false);
                                    Ext.getCmp("CmsUserProfileForm8").setTitle("Reset Password");
                                }
                                Ext.getCmp("CmsUserProfilePassword").setVisible(false);
                                Ext.getCmp("CmsUserProfileForm8").setDisabled(false);
                            }
                            this.setText('Update');
                        } else if (userCurrentEntity == "CmsUserProfile" && isSuperAdmin()) {
                            Ext.getCmp("CmsUserProfileForm8").setTitle("Reset Password");
                        }
                    }
                }
            }, {
                text: 'Cancel',
                iconCls: 'icon-wincancel',
                handler: function () {
                    userWindow.close();
                }

            }]
        });
    }
    userWindow.on('close', function () {
        hideHtmlEditor();
        treePanelParentPath = '';
        aForms = new Array();
    });
    userWindow.setTitle(wintitle);
    loadFormsArray(userCurrentEntity);
    if (preload) {
        if (grid != 'getfields') {
            comboPreLoader(grid, rowIndex, formAction, preload);
        }
        return false;
    }
    if (formAction != 'new') {
        comboPreLoader(grid, rowIndex, formAction, preload);
    }
    userWindow.show();
}

/**
 * Method to display Add/Edit form for all feed entities 
 * @param grid {Ext.grid.panel} 
 * @param rowIndex {Integer}
 * @param formAction {String}
 * @param activeMainPanelGrid {Ext.grid.panel}
 * @param preload {Boolean}
 */

function feedCreateWindow(grid, rowIndex, formAction, activeMainPanelGrid, preload) {
    var feedErrorpanel = Ext.create("Ext.panel.Panel", {
        title: 'Error Info',
        region: 'south',
        height: 100,
        collapsed: true,
        collapsible: true,
        autoScroll: true
    });
    var winHeight = getWindowHeight();
    var formItem = Ext.create("Ext.tab.Panel", {
        activeTab: 0,
        region: 'center',
        autoScroll: true,
        width: 700,
        height: 450,
        defaults: {
            bodyStyle: 'padding:10px'
        },
        items: [Ext.JSON.decode(feedCurrentEntity + "Form")],
        scope: Ext.JSON.decode(feedCurrentEntity + "Form")
    });

    var wintitle = formAction == "edit" ? 'Edit' : 'Add New';
    if (formAction != 'new') {
        var currentEntityItem = grid.getStore().getAt(rowIndex);
        currentEntityItemId = currentEntityItem.data.Id;
    }
    if (!feedWindow) {
        var feedWindow = new Ext.Window({
            // closeAction : 'hide',
            autoScroll: true,
            title: wintitle,
            modal: true,
            layout: 'border',
            height: winHeight,
            width: 715,
            items: [formItem, feedErrorpanel],
            buttons: [{
                text: 'Save',
                iconCls: 'icon-disk',
                scope: Ext.JSON.decode(feedCurrentEntity + "Form"),
                formBind: true,
                handler: function () {
                    saveEntity(activeMainPanelGrid, feedWindow, feedCurrentEntity, formAction, feedErrorpanel, currentEntityItem);
                },
                listeners: {
                    render: function () {
                        if (formAction == "edit") {
                            this.setText('Update');
                        }
                    }
                }
            }, {
                text: 'Cancel',
                iconCls: 'icon-wincancel',
                handler: function () {
                    feedWindow.close();
                }

            }]
        });
    }
    feedWindow.on('close', function () {
        treePanelParentPath = '';
        hideHtmlEditor();
        aForms = new Array();
    });
    feedWindow.setTitle(wintitle);
    loadFormsArray(feedCurrentEntity);
    if (preload) {
        if (grid != 'getfields') {
            comboPreLoader(grid, rowIndex, formAction, preload);
        }
        return false;
    }
    if (formAction != 'new') {
        comboPreLoader(grid, rowIndex, formAction, preload);
    }
    feedWindow.show();
}

/**
 * Method to display Add/Edit form for all admin entities 
 * @param grid {Ext.grid.panel} 
 * @param rowIndex {Integer}
 * @param formAction {String}
 * @param activeMainPanelGrid {Ext.grid.panel}
 * @param preload {Boolean}
 */

function adminCreateWindow(grid, rowIndex, formAction, activeMainPanelGrid, preload) {
    globalEntityName = adminCurrentEntity;
    adminErrorpanel = Ext.create("Ext.panel.Panel", {
        title: 'Error Info',
        region: 'south',
        height: 100,
        collapsed: true,
        collapsible: true,
        autoScroll: true
    });
    var winHeight = getWindowHeight();
    var formItem = Ext.create("Ext.tab.Panel", {
        activeTab: 0,
        region: 'center',
        autoScroll: true,
        width: 700,
        height: 450,
        defaults: {
            bodyStyle: 'padding:10px'
        },
        items: [Ext.JSON.decode(adminCurrentEntity + "Form")],
        scope: Ext.JSON.decode(adminCurrentEntity + "Form")
    });
    var wintitle = formAction == "edit" ? 'Edit' : 'Add New';
    if (formAction != 'new') {
        var currentEntityItem = grid.getStore().getAt(rowIndex);
        currentEntityItemId = currentEntityItem.data.Id;
    }
    if (!adminWindow) {
        var adminWindow = new Ext.Window({
            // closeAction : 'hide',
            autoScroll: true,
            title: wintitle,
            modal: true,
            layout: 'border',
            height: winHeight,
            width: 715,
            items: [formItem, adminErrorpanel],
            buttons: [{
                text: 'Save',
                iconCls: 'icon-disk',
                scope: Ext.JSON.decode(adminCurrentEntity + "Form"),
                formBind: true,
                handler: function () {
                    saveEntity(activeMainPanelGrid, adminWindow, adminCurrentEntity, formAction, adminErrorpanel, currentEntityItem);
                },
                listeners: {
                    render: function () {
                        if (formAction == "edit") {
                            this.setText('Update');
                        }
                    }
                }
            }, {
                text: 'Cancel',
                iconCls: 'icon-wincancel',
                handler: function () {
                    adminWindow.close();
                }

            }]
        });
    }
    adminWindow.on('close', function () {
        treePanelParentPath = '';
        hideHtmlEditor();
        aForms = new Array();
    });
    adminWindow.setTitle(wintitle);
    loadFormsArray(adminCurrentEntity);
    if (preload) {
        if (grid != 'getfields') {
            comboPreLoader(grid, rowIndex, formAction, preload);
        }
        return false;
    }
    if (formAction != 'new') {
        comboPreLoader(grid, rowIndex, formAction, preload);
    }
    adminWindow.show();
}

/**
 * Method to display Add/Edit form for all domain entities 
 * @param grid {Ext.grid.panel} 
 * @param rowIndex {Integer}
 * @param formAction {String}
 * @param activeMainPanelGrid {Ext.grid.panel}
 * @param preload {Boolean}
 */

function domainCreateWindow(grid, rowIndex, formAction, activeMainPanelGrid, preload) {
    var domainErrorpanel = Ext.create("Ext.panel.Panel", {
        title: 'Error Info',
        region: 'south',
        height: 100,
        collapsed: true,
        collapsible: true,
        autoScroll: true
    });
    var winHeight = getWindowHeight();
    var formItem = Ext.create("Ext.tab.Panel", {
        activeTab: 0,
        region: 'center',
        autoScroll: true,
        width: 700,
        height: 450,
        defaults: {
            bodyStyle: 'padding:10px'
        },
        items: [Ext.JSON.decode(domainCurrentEntity + "Form")],
        scope: Ext.JSON.decode(domainCurrentEntity + "Form")
    });

    var wintitle = formAction == "edit" ? 'Edit' : 'Add New';
    if (formAction != 'new') {
        var currentEntityItem = grid.getStore().getAt(rowIndex);
        currentEntityItemId = currentEntityItem.data.Id;
    }
    if (!domainWindow) {
        var domainWindow = new Ext.Window({
            // closeAction : 'hide',
            autoScroll: true,
            title: wintitle,
            modal: true,
            layout: 'border',
            height: winHeight,
            width: 715,
            items: [formItem, domainErrorpanel],
            buttons: [{
                text: 'Save',
                iconCls: 'icon-disk',
                scope: Ext.JSON.decode(domainCurrentEntity + "Form"),
                formBind: true,
                handler: function () {
                    saveEntity(activeMainPanelGrid, domainWindow, domainCurrentEntity, formAction, domainErrorpanel, currentEntityItem);
                },
                listeners: {
                    render: function () {
                        if (formAction == "edit") {
                            this.setText('Update');
                        }
                    }
                }
            }, {
                text: 'Cancel',
                iconCls: 'icon-wincancel',
                handler: function () {
                    domainWindow.close();
                }

            }]
        });
    }
    domainWindow.on('close', function () {
        treePanelParentPath = '';
        hideHtmlEditor();
        aForms = new Array();
    });
    domainWindow.setTitle(wintitle);
    loadFormsArray(domainCurrentEntity);
    if (preload) {
        if (grid != 'getfields') {
            comboPreLoader(grid, rowIndex, formAction, preload);
        }
        return false;
    }
    if (formAction != 'new') {
        comboPreLoader(grid, rowIndex, formAction, preload);
    }
    domainWindow.show()
}

/**
 * Method to display Add/Edit form for all workflow entities 
 * @param grid {Ext.grid.panel} 
 * @param rowIndex {Integer}
 * @param formAction {String}
 * @param activeMainPanelGrid {Ext.grid.panel}
 * @param preload {Boolean}
 */

function workflowCreateWindow(grid, rowIndex, formAction, activeMainPanel, preload) {
    var workflowErrorpanel = Ext.create("Ext.panel.Panel", {
        title: 'Error Info',
        region: 'south',
        height: 100,
        collapsed: true,
        collapsible: true,
        autoScroll: true
    });
    var winHeight = getWindowHeight();
    var formItem = Ext.create("Ext.tab.Panel", {
        activeTab: 0,
        region: 'center',
        autoScroll: true,
        width: 770,
        height: 450,
        forceFit: true,
        defaults: {
            bodyStyle: 'padding:10px'
        },
        items: [Ext.JSON.decode(workflowCurrentEntity + "Form")],
        scope: Ext.JSON.decode(workflowCurrentEntity + "Form") // global js
    });
    var wintitle = formAction == "edit" ? 'Edit' : 'Add New';
    var worklfowFormAction = formAction;
    var validatingForms = new Array();
    workflowForms = new Array();
    Ext.getCmp('WorkflowComboStageName').store.load();
    if (workflowCurrentEntity == "Workflow") {
        WorkflowStageGrid.store.removeAll();
        if (formAction != 'new') {
            var record = grid.getStore().getAt(rowIndex);
            // WorkflowProperties = record.data.Properties;
            if (record.data.WorkflowStages != '') {
                var WorkflowStages = Ext.JSON.decode(record.data.WorkflowStages);
                var wfStage = '';
                if (Ext.isArray(WorkflowStages.WorkflowStage)) {
                    // var WorkflowRecord =
                    // WorkflowFlattenData(WorkflowStages.WorkflowStage);
                    wfStage = WorkflowStages.WorkflowStage;
                } else {
                    // var WorkflowRecord = WorkflowFlattenData(new
                    // Array(WorkflowStages.WorkflowStage));
                    wfStage = new Array(WorkflowStages.WorkflowStage);
                }
                var stageGridData = flattenStagesJson(wfStage, 'stageGrid');
                var userMapGridData = flattenStagesJson(wfStage, 'userMapGrid');
                WorkflowStageGrid.store.loadData(stageGridData);
                WorkflowUserMapGrid.store.loadData(userMapGridData);
                // WorkflowUserMapLoadData(userMapGridData);
            }
            // var workflowModelMapEditProperties =
            // Ext.JSON.decode(record.data.Properties);
            // loadPropertyForm(workflowModelMapEditProperties.Property,'edit');
        } else {
            WorkflowPanel1.getForm().reset();
            Ext.getCmp('WorkflowCreatedDate').setValue(new Date());
            Ext.getCmp('WorkflowCreatedBy').setValue(cmsUserName);
            Ext.getCmp('WorkflowLastModifiedDate').setValue(new Date());
            Ext.getCmp('WorkflowLastModifiedBy').setValue(cmsUserName);
            // WorkflowPanel2.removeAll(); // optional
        }
    } else if (Ext.getCmp(workflowCurrentEntity + '-window-container')) {
        Ext.getCmp(workflowCurrentEntity + '-window-container').destroy();
    }
    var workflowWindow = Ext.getCmp(workflowCurrentEntity + '-window-container');
    if (!workflowWindow) {
        workflowWindow = new Ext.Window({
            closeAction: 'hide',
            autoScroll: true,
            id: workflowCurrentEntity + '-window-container',
            title: wintitle,
            modal: true,
            layout: 'border',
            height: winHeight,
            width: 785,
            items: [formItem, workflowErrorpanel],
            buttons: [{
                text: 'Save',
		id:"workflow-save-id",
                iconCls: 'icon-disk',
                scope: Ext.JSON.decode(workflowCurrentEntity + "Form"),
                formBind: true,
                handler: function () {
                    loadFormsArray(workflowCurrentEntity);
                    if (workflowCurrentEntity == "Workflow") {
                        // var wflowKey = Ext.getCmp('WorkflowKey');
                        /*
                         * if(!wflowKey.isDisabled() && wflowKey.getValue() ==
                         * ''){
                         * !validateStore(WorkflowStageGrid.store,workflowCurrentEntity) ||
                         * Ext.DropDownAlert.msg("<div class =
                         * 'errorHeaderMsg'>Validation Error!</div>", "<div
                         * class = 'errorMsg'>Required field missing OR Invalid
                         * data</div>"); }
                         */
                        if (!workflowGridColumnValidation()) return false;

                        if (!WorkflowUserMapGrid.store.getCount() >= 1 || Ext.isEmpty(Ext.getCmp('WorkflowWorkflowName').getValue())) {
                            Ext.getCmp('WorkflowWorkflowName').markInvalid();
                            Ext.DropDownAlert.msg("<div class = 'errorHeaderMsg'>Validation Error!</div>", "<div class = 'errorMsg'>Required field missing OR Invalid data</div>");
                            return false;
                        }
                        if (WorkflowUserMapGrid.store.getCount() >= 1) {
                            var records, rec;
                            for (var k = 0; k < WorkflowUserMapGrid.store.getCount(); k++) {
                                records = WorkflowUserMapGrid.store;
                                rec = records.getAt(k);
                                if ((Ext.isEmpty(rec.get('NextStage')) || Ext.isEmpty(rec.get('NextContentStatus')) || Ext.isEmpty(rec.get('PossibleActionUser'))) && (rec.get('StageType') != 'End')) {
                                    Ext.DropDownAlert.msg("<div class = 'errorHeaderMsg'>Validation Error!</div>", "<div class = 'errorMsg'>Stages Must be defined</div>");
                                    return false;
                                }
                            }
                        }
                    }
                    Ext.MessageBox.wait('Saving Data In Progress. Please Wait ...');
                    Ext.Ajax.request({
                        method: "POST",
                        url: dataservicesPath + '/' + workflowCurrentEntity.toLowerCase(),
                        defaultHeaders: {
                            'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8'
                        },
                        success: function (response, opts) {
                            var actionObj = Ext.JSON.decode(response.responseText);
                            if (actionObj.success == "false") {
                                Ext.MessageBox.hide();
                                workflowErrorpanel.expand(false);
                                if (actionObj.msg.ValidationError) {
                                    workflowErrorpanel.update("<div class = 'errorHeaderMsg'>" + actionObj.msg.ValidationError + "</div>");
                                } else {
                                    if (aForms[0] && aForms[0].findField('FilePath')) {
                                        aForms[0].findField('FilePath').setValue('');
                                    }
                                    if (actionObj.msg) {
                                        workflowErrorpanel.update("<div class = 'errorHeaderMsg'>" + getCustomErrorInfo(Ext.JSON.encode(actionObj.msg)) + "</div>");
                                    } else {
                                        workflowErrorpanel.update("<div class = 'errorHeaderMsg'>" + getCustomErrorInfo(response.responseText) + "</div>");
                                    }
                                }
                                return false;
                            } else {
                                if (formAction == "new") {
                                    Ext.MessageBox.hide();
                                    Ext.DropDownAlert.msg("<div class = 'successHeaderMsg'>Success!</div>", "<div class = 'successMsg'>Saved Successfully.</div>");
                                    activeMainPanel.getStore().load();
                                } else {
                                    Ext.MessageBox.hide();
                                    Ext.DropDownAlert.msg("<div class = 'successHeaderMsg'>Success!</div>", "<div class = 'successMsg'>Updated Successfully.</div>");
                                    grid.getStore().load();
                                }
                                aForms = new Array();
                                workflowWindow.close();
                            }
                        },
                        failure: function (form, action) {
                            Ext.MessageBox.hide();
                            var actionString = action.response.responseText;
                            var actionObj = Ext.JSON.decode(actionString);
                            if (!Ext.isEmpty(actionString)) {
                                workflowErrorpanel.expand(false);
                                if (typeof (actionObj.msg) != "undefined") {
                                    workflowErrorpanel.update("<div class = 'errorHeaderMsg'>" + getCustomErrorInfo(Ext.JSON.encode(actionObj.msg)) + "</div>");
                                } else {
                                    workflowErrorpanel.update("<div class = 'errorHeaderMsg'>" + action.response.responseText + "</div>");
                                }
                            }
                        },
                        params: getFinalFormParams(workflowCurrentEntity, formAction)
                        // waitMsg: 'Saving Data In Progress. Please Wait ...'
                    });
                },
                listeners: {
                    beforerender: function (btn,eOps) {
                        if (formAction == "edit") {
                            btn.setText('Update');
                        }
                    }
                }
            }, {
                text: 'Cancel',
                iconCls: 'icon-wincancel',
                handler: function () {
                    workflowWindow.close();
                }

            }]
        });
    }
    workflowWindow.doLayout();
    if (workflowCurrentEntity == "Workflow") {
        workflowWindow.closeAction = 'hide';
    } else {
        workflowWindow.closeAction = 'close';
    }
    if(workflowCurrentEntity == "Workflow" && formAction == "edit"){
      Ext.getCmp("workflow-save-id").setText("Update");
      Ext.getCmp("WorkflowWorkflowId").setVisible(true);
    }
    else{
      Ext.getCmp("workflow-save-id").setText("Save");
      Ext.getCmp("WorkflowWorkflowId").setVisible(false);
    }
    workflowWindow.setTitle(wintitle);
    workflowWindow.on('close', function () {
        hideHtmlEditor();
        aForms = new Array();
        WorkflowUserMapGrid.store.removeAll();
        WorkflowStageGrid.store.removeAll();
        stageMapHash.clear();
        finalStageHash.clear();
        userMapHash.clear();
        // WorkflowPanel2.removeAll();
        workflowForms = new Array();
        WorkflowPanel1.getForm().reset();
        // Ext.getCmp('WorkflowKey').setValue('');
        Ext.getCmp('WorkflowComboStageName').setValue('');
        WorkflowStageArray = [];

    });
    loadFormsArray(workflowCurrentEntity);
    if (preload) {
        if (grid != 'getfields') {
            comboPreLoader(grid, rowIndex, formAction, preload);
        }
        return false;
    }
    if (formAction != 'new') {
        comboPreLoader(grid, rowIndex, formAction, preload);
    }
    workflowWindow.show();
}

// Starting Workflow definition 
var userMapHash = new Ext.util.HashMap();    // hashmap for user usermapgrid 
var stageMapHash = new Ext.util.HashMap();   // hashmap for user stagegrid
var finalStageHash = new Ext.util.HashMap(); // hashmap for user stagegrid

/**
* Method returns json data compatible for showing on stage and usermap grid.
* @param wfStage {Array}
* @param gridType {String}
* @return Returns Json 
*/

function flattenStagesJson(wfStage, gridType) {
    var storeDump = [];
    var k = 0,
        l = 0;
    WorkflowStageValue = '';
    var WorkflowStageNamearr = [];
    var storeModel = '';
    userMapHash = new Ext.util.HashMap();
    for (var i = 0; i < wfStage.length; i++) {
        var action = wfStage[i].PossibleActions.PossibleAction;
        if (!Ext.isArray(action)) {
            action = new Array(action);
        }
        if (gridType == 'stageGrid') {
            var stageGridPossibleActions = '';
            for (var j = 0; j < action.length; j++) {
                if (!Ext.isEmpty(stageGridPossibleActions)) {
                    stageGridPossibleActions += ",";
                }
                stageGridPossibleActions += action[j].PossibleActionName;
            }
            storeModel = {
                StageName: wfStage[i].StageName,
                StageType: wfStage[i].StageType,
                PossibleActionName: stageGridPossibleActions,
                NextStage: '',
                NextContentStatus: '',
                PossibleActionUser: ''
            }
            var hashKey = wfStage[i].StageName;
            finalStageHash.add(hashKey, storeModel);
            storeDump[k] = storeModel;
            k++;
        } else {
            for (var j = 0; j < action.length; j++) {
                storeModel = {
                    StageName: wfStage[i].StageName,
                    StageType: wfStage[i].StageType,
                    PossibleActionName: action[j].PossibleActionName,
                    NextStage: action[j].NextStage,
                    NextContentStatus: action[j].NextContentStatus,
                    PossibleActionUser: action[j].PossibleActionUsers.PossibleActionUser
                }
                var hashKey = wfStage[i].StageName + action[j].PossibleActionName;
                userMapHash.add(hashKey, storeModel);
                storeDump[l] = storeModel;
                l++;
                if (!Ext.Array.contains(WorkflowStageNamearr, wfStage[i].StageName)) {
                    if (!Ext.isEmpty(WorkflowStageValue)) WorkflowStageValue += ","
                    WorkflowStageNamearr[j] = wfStage[i].StageName;
                    WorkflowStageValue += wfStage[i].StageName + '';
                }
            }
        }
    }
    Ext.getCmp('WorkflowComboStageName').setValue(WorkflowStageValue.split(","));
    return storeDump;
}

/**
* Method validates with hashmap and push data to usermap grid
* @param  storeData {Array}
* @return Returns json 
*/

function WorkflowUserMapLoadData(storeData) {
    var finalStore = new Array();
    for (var i = 0; i < storeData.length; i++) {
        var hashKey = storeData[i].StageName + storeData[i].PossibleActionName;
        if (userMapHash.containsKey(hashKey)) {
            finalStore[i] = userMapHash.get(hashKey);
        } else {
            finalStore[i] = storeData[i];
        }
    }
    WorkflowUserMapGrid.store.loadData(finalStore);
}

/**
* This method returns true only if array has Duplicate
* @param WorkflowStageNamearr {String}
* @return Returns true if array has duplicate value 
*/
function arrayHasDuplicates(WorkflowStageNamearr) {
    var i, j, n;
    n = WorkflowStageNamearr.length;
    for (i = 0; i < n; i++) {
        for (j = i + 1; j < n; j++) {
            if (WorkflowStageNamearr[i] == WorkflowStageNamearr[j]) {
                if (WorkflowStageNamearr[j] == 'Start' || WorkflowStageNamearr[j] == 'End') return true;
            }
        }
    }
    return false;
}

/**
* Method updates html editor field visibility to false in every form  
* @param  none
* @return none
*/

function hideHtmlEditor() {
    for (var i = 0; i < aForms.length; i++) {
        if (!Ext.isEmpty(aForms[i])) {
            var collections = aForms[i].getFields();
            var count = collections.getCount();
            for (var j = 0; j < count; j++) {
                var field = collections.getAt(j);
                if (field.getXType() == 'htmleditor') {
                    field.setVisible(false);
                }
            }
        }
    }
}

var lastItemClicked = new Array();

function sendWorkflowActionRequest(item, postData, wfEntityName, grid) {
    var rec = grid.getSelectionModel().getSelection()[0];
    if (postData['Id'] == lastItemClicked[0] && postData["CurrentAction"] != lastItemClicked[2]) {
        Ext.DropDownAlert.msg("<div class = 'errorHeaderMsg'>Please wait</div>", "<div class = 'errorMsg'> Previous request is being processed.</div>");
        return false;
    }
    postData["CurrentAction"] = item.text;
    /*if(!checkNpiMetaDataFilled(rec)){
	  Ext.DropDownAlert.msg("<div class = 'errorMsg'>Validation Error</div>", "<div class = 'errorMsg'>NPI Metadata not filled</div>");
	  return false;
	}*/
    var wfCommentsText = "";
    wfCommentsText += postData["WorkflowComments"];
    var topPanel = '';
    var okButtunStr = 'OK';
    var windowTitle = "Workflow Comments";
    if (item.text == "Ratify") {
        okButtunStr = "Ratify";
        windowTitle = "Workflow Ratification[" + postData["WorkflowName"] + "]";
        var infoStr = "<p><b>Current Stage</b> : " + postData["Stage"] + " </br> " + "<b>Current Status </b>: " + postData["Status"] + "</p>";

        var ratifyTreeStore = Ext.create('Ext.data.TreeStore', {
            autoLoad: false,
            proxy: {
                type: 'memory',
                reader: {
                    type: 'json',
                    root: 'Stages'
                }
            },
            root: {
                text: 'Choose Stage',
                expanded: true
            }
        });

        var ratifyStageTreePanel = Ext.create('Ext.tree.Panel', {
            title: "New Stage",
            region: "west",
            hideHeaders: true,
            scope: this,
            layout: 'fit',
            width: 250,
            useArrows: true,
            height: 228,
            rootVisible: false,
            store: Ext.create('Ext.data.TreeStore', {
                autoLoad: false,
                proxy: {
                    type: 'memory',
                    reader: {
                        type: 'json',
                        root: 'Stages'
                    }
                },
                root: {
                    text: 'New Stage',
                    expanded: true
                }
            }),
            listeners: {
                render: function (panel, options) {
                    this.store.sort('text', 'ASC');
                }
            }
        });

        var ratifyStatusTreePanel = Ext.create('Ext.tree.Panel', {
            title: "New Status",
            region: "center",
            hideHeaders: true,
            scope: this,
            layout: 'fit',
            width: 250,
            useArrows: true,
            height: 228,
            rootVisible: false,
            store: Ext.create('Ext.data.TreeStore', {
                autoLoad: false,
                proxy: {
                    type: 'memory',
                    reader: {
                        type: 'json',
                        root: 'Status'
                    }
                },
                root: {
                    text: 'New Status',
                    expanded: true
                }
            }),
            listeners: {
                render: function (panel, options) {
                    this.store.sort('text', 'ASC');
                }
            }
        });
        var currentRatifyStage = postData["Stage"];
        var currentRatifyStatus = postData["Status"];
        var currentRatifyWorkflowId = postData["WorkflowId"];
        //if(!Ext.isEmpty(postData["WorkflowId"])){
        Ext.Ajax.request({
            method: 'GET',
            url: dataservicesPath + '/status/search?q=&format=extjson',
            method: "GET",
            scope: this,
            success: function (response) {
                var collectionsObj = Ext.JSON.decode(response.responseText);
                if (collectionsObj.Collections.Count > 0) {
                    var wfStatus = collectionsObj.Collections.Status;
                    var node = ratifyStatusTreePanel.store.getRootNode();
                    node.removeAll();
                    for (var i = 0; i < wfStatus.length; i++) {
                        node.appendChild({
                            "text": wfStatus[i].StatusName,
                            "idName": wfStatus[i].StatusName,
                            "leaf": true
                        });
                    }
                    node.expandChildren();
                    ratifyStatusTreePanel.store.setRootNode(node);
                }
            },
            failure: function (form, action) {
                Ext.MessageBox.hide();
            },
            waitMsg: 'Loading Metadata. Please Wait ...'
        });
        //}

        ratifyStatusTreePanel.on('itemclick', function (view, record, htmlelement, index, e) {
            if ("New Status" != record.data.text) {
                postData["Status"] = record.data.text;
            }
        });

        ratifyStageTreePanel.on('itemclick', function (view, record, htmlelement, index, e) {
            if ("New Stage" != record.data.treeitem) {
                postData["Stage"] = record.data.text;
            }
        });




        if (!Ext.isEmpty(postData["WorkflowId"])) {
            var workflowParams = '&id=' + postData["WorkflowId"];
            Ext.Ajax.request({
                method: 'GET',
                url: dataservicesPath + '/workflow/search?q=&format=extjson' + workflowParams,
                method: "GET",
                scope: this,
                success: function (response) {
                    var collectionsObj = Ext.JSON.decode(response.responseText);
                    if (collectionsObj.Collections.Count == 1) {
                        var wfStages = Ext.JSON.decode(collectionsObj.Collections.Workflow.WorkflowStages);
                        var node = ratifyStageTreePanel.store.getRootNode();
                        node.removeAll();
                        for (var i = 0; i < wfStages.WorkflowStage.length; i++) {
                            node.appendChild({
                                "text": wfStages.WorkflowStage[i].StageName,
                                "idName": wfStages.WorkflowStage[i].StageName,
                                "leaf": true
                            });
                        }
                        node.expandChildren();
                        ratifyStageTreePanel.store.setRootNode(node);
                    }
                },
                failure: function (form, action) {
                    Ext.MessageBox.hide();
                },
                waitMsg: 'Loading Metadata. Please Wait ...'
            });
        }


        var ratifyWorkflows = {
            name: "WorkflowName",
            id: "WorkflowName",
            editable: false,
            fieldLabel: "Choose Workflow",
            xtype: "combobox",
            editable: false,
            multiSelect: false,
            store: createQueryStore('Workflow', ''),
            width: 300,
            pageSize: 100,
            typeAhead: true,
            triggerAction: 'all',
            queryMode: "remote",
            displayField: "WorkflowName",
            valueField: "WorkflowName",
            emptyText: "",
            listeners: {
                beforerender: function (combo) {
                    this.store.load();
                },
                render: function (combo) {
                    this.store.sort('WorkflowName', 'ASC');
                    this.setValue(postData["WorkflowName"]);
                },
                select: function (combo, records, eOpts) {
                    ratifyTreeStore.removeAll();
                    if (!Ext.isEmpty(records[0].data.Id)) {
                        postData["WorkflowName"] = records[0].data.WorkflowName;
                        postData["WorkflowId"] = records[0].data.Id;
                        if (!Ext.isEmpty(postData["WorkflowId"])) {
                            var workflowParams = '&id=' + postData["WorkflowId"];
                            Ext.Ajax.request({
                                method: 'GET',
                                url: dataservicesPath + '/workflow/search?q=&format=extjson' + workflowParams,
                                method: "GET",
                                scope: this,
                                success: function (response) {
                                    var collectionsObj = Ext.JSON.decode(response.responseText);
                                    if (collectionsObj.Collections.Count == 1) {
                                        var wfStages = Ext.JSON.decode(collectionsObj.Collections.Workflow.WorkflowStages);
                                        var node = ratifyStageTreePanel.store.getRootNode();
                                        node.removeAll();
                                        for (var i = 0; i < wfStages.WorkflowStage.length; i++) {
                                            node.appendChild({
                                                "text": wfStages.WorkflowStage[i].StageName,
                                                "idName": wfStages.WorkflowStage[i].StageName,
                                                "leaf": true
                                            });
                                        }
                                        node.expandChildren();
                                        ratifyStageTreePanel.store.setRootNode(node);
                                    }
                                },
                                failure: function (form, action) {
                                    Ext.MessageBox.hide();
                                },
                                waitMsg: 'Loading Metadata. Please Wait ...'
                            });
                        }
                    }
                }
            }
        };
        topPanel = Ext.create('Ext.form.Panel', {
            layout: 'border',
            border: false,
            autoScroll: true,
            anchor: '100%',
            bodyStyle: {
                "background-color": "#F5F5F5"
            },
            height: 225,
            items: [{
                region: "north",
                html: infoStr,
                items: [ratifyWorkflows]
            },
            ratifyStageTreePanel, ratifyStatusTreePanel]
        });

    } else {
        topPanel = Ext.create('Ext.panel.Panel', {
            border: false,
            html: wfCommentsText,
            autoScroll: true,
            bodyStyle: {
                "background-color": "#F5F5F5"
            },
            height: 225
        });
    }

    var commentsWindow = Ext.create('Ext.window.Window', {
        title: windowTitle,
        height: 400,
        modal: true,
        width: 500,
        items: [topPanel,
        {
            xtype: 'label',
            fieldLabel: '&nbsp;'
        }, {
            xtype: 'textarea',
            id: 'wf-comment-text',
            fieldLabel: 'Enter your comments',
            height: 110,
            width: 484
        }],
        buttons: [{
            text: okButtunStr,
            handler: function () {
                if (postData["Stage"] != "Draft" && postData["Draft"] != "Draft" && !checkNpiMetaDataFilled(rec)) {
                    Ext.DropDownAlert.msg("<div class = 'errorMsg'>Validation Error" + "</div>", "<div class = 'errorMsg'>" + "NPI Metadata not filled</div>");
                    return false;
                }
                /*alert(currentRatifyWorkflowId +" " +postData["WorkflowId"]);
				alert(currentRatifyStage + " " +  postData["Stage"]);
				alert(currentRatifyStatus + " " + postData["Status"]);*/
                if (currentRatifyWorkflowId == postData["WorkflowId"] && currentRatifyStage == postData["Stage"] && currentRatifyStatus == postData["Status"]) {
                    Ext.DropDownAlert.msg("<div class = 'errorHeaderMsg'>" + "Validation Error" + "</div>", "<div class = 'errorMsg'>" + "Change atleast 1 parameter for transition" + "</div>");
                    return false;
                }
                var text = Ext.getCmp('wf-comment-text').getValue();
                if (Ext.isEmpty(text)) {
                    /*Ext.DropDownAlert.msg("<div class = 'errorHeaderMsg'>"
		    					+ "Validation Error"
		    					+ "</div>","<div class = 'errorMsg'>" 
		    					+ "Please enter comments"
		    					+ "</div>");
				  return false; */
                    text = '';
                }
                postData["WorkflowComments"] += '<b>' + cmsUserName + ' [' + postData["CurrentAction"] + ']</b> : ' + text + "</br>";
                //}
                Ext.MessageBox.wait('Saving Data In Progress. Please Wait ...');
                Ext.Ajax.request({
                    method: 'POST',
                    url: dataservicesPath + '/' + wfEntityName.toLowerCase(),
                    scope: commentsWindow,
                    defaultHeaders: {
                        'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8'
                    },
                    success: function (response, opts) {
                        Ext.MessageBox.hide();
                        var resp = Ext.JSON.decode(response.responseText);
                        if (resp.success == "true") {
                            lastItemClicked[0] = postData['Id'];
                            lastItemClicked[1] = postData['EntityType'];
                            lastItemClicked[2] = postData['CurrentAction'];
                            Ext.DropDownAlert.msg("<div class = 'successHeaderMsg'>" + NICAlerts.stageTransitionSuccessHeading + "</div>", "<div class = 'successMsg'>" + NICAlerts.stageTransitionSuccessMessage + "</div>");

                            grid.store.load();
                        } else {
                            if (!Ext.isEmpty(resp.msg.ValidationError)) {
                                Ext.DropDownAlert.msg("<div class = 'errorHeaderMsg'>" + NICAlerts.validationErrorHeading + "</div>", "<div class = 'errorMsg'>" + resp.msg.ValidationError + "</div>");
                            }
                            return false;
                        }
                        commentsWindow.close();
                    },
                    failure: function (result, request) {
                        Ext.MessageBox.hide();
                        var actionString = result.responseText;
                        if (actionString != '') {
                            var actionObj = Ext.JSON.decode(actionString);
                            if (!Ext.isEmpty(actionObj.msg)) {
                                Ext.DropDownAlert.msg("<div class = 'errorHeaderMsg'>" + NICAlerts.stageTransitionFailureHeading + "</div>", "<div class = 'errorMsg'>" + getCustomErrorInfo(Ext.JSON.encode(actionObj.msg)) + "</div>");
                            }
                        } else {
                            Ext.DropDownAlert.msg("<div class = 'errorHeaderMsg'>Request Failed</div>", "<div class = 'errorHeaderMsg'>Request Timedout Or No Response From Server </div>");
                        }
                        commentsWindow.close();
                    },
                    params: postData
                });
            }
        }, {
            text: 'Cancel',
            handler: function () {
                commentsWindow.close();
            }
        }

        ]
    }).show();

    return false;

    /*
     * Ext.Msg.prompt('Workflow Comments', wfCommentsText, function(btn, text){
     * if (btn == 'ok'){ postData["WorkflowComments"] += cmsUserName + ' [' +
     * postData["CurrentAction"] + '] :' + text + "</br>"; // process text
     * value and close... Ext.MessageBox.wait('Saving Data In Progress. Please
     * Wait ...'); Ext.Ajax.request({ method : 'POST', url:
     * dataservicesPath+'/'+wfEntityName.toLowerCase(), defaultHeaders : {
     * 'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8'},
     * success : function(response, opts) { Ext.MessageBox.hide(); var resp =
     * Ext.JSON.decode(response.responseText); if(resp.success){
     * lastItemClicked[0] = postData['Id']; lastItemClicked[1] =
     * postData['EntityType']; lastItemClicked[2] = postData['CurrentAction'];
     * Ext.DropDownAlert.msg("<div class = 'successHeaderMsg'>Success</div>", "<div
     * class = 'successMsg'>Saved Successfully.</div>"); grid.store.load(); } },
     * failure: function( result, request ) { Ext.MessageBox.hide(); var
     * actionString = result.responseText; if(actionString != ''){ var actionObj =
     * Ext.JSON.decode(actionString); if(!Ext.isEmpty(actionObj.msg)){
     * Ext.DropDownAlert.msg("<div class = 'errorHeaderMsg'>Request Failed</div>","<div
     * class = 'errorMsg'>" + getCustomErrorInfo(Ext.JSON.encode(actionObj.msg)) + "</div>"); } }
     * else{ Ext.DropDownAlert.msg("<div class = 'errorHeaderMsg'>Request Failed</div>", "<div
     * class = 'errorHeaderMsg'>Request Timedout Or No Response From Server
     * </div>"); } }, params : postData }); } },this,true);
     */
}

/**
 * Method to display Workflow stage details
 * @param record {Json}
 */

function getWorkflowDetails(record) {
    var wfId = record.data.WorkflowId; // 'llkpE6ajbeidc';
    var wfName = record.data.WorkflowName; // 'Test Workflow';
    var currentUser = record.data.CurrentUser;
    if (!Ext.isEmpty(wfId)) {
        var workflowParams = '&id=' + wfId;
        if (!isSuperAdmin()) {
            workflowParams += '&PossibleActionUser=' + cmsUserName;
        }
        Ext.Ajax.request({
            method: 'GET',
            url: dataservicesPath + '/workflow/search?q=&format=extjson' + workflowParams,
            method: "GET",
            scope: this,
            success: function (response) {
                var collectionsObj = Ext.JSON.decode(response.responseText);
                var nextActions = '';
                var nextStages = '';
                var stageType = '';
                var pathStages = '';
                if (collectionsObj.Collections.Count == 1) {
                    var wfStages = Ext.JSON.decode(collectionsObj.Collections.Workflow.WorkflowStages);
                    for (var i = 0; i < wfStages.WorkflowStage.length; i++) {
                        var nextStages = '';
                        if (record.data.Stage == wfStages.WorkflowStage[i].StageName) {
                            stageType = wfStages.WorkflowStage[i].StageType;
                            if (wfStages.WorkflowStage[i].PossibleActions.PossibleAction) {
                                if (!Ext.isArray(wfStages.WorkflowStage[i].PossibleActions.PossibleAction)) {
                                    wfStages.WorkflowStage[i].PossibleActions.PossibleAction = new Array(wfStages.WorkflowStage[i].PossibleActions.PossibleAction);
                                }
                                for (var j = 0; j < wfStages.WorkflowStage[i].PossibleActions.PossibleAction.length; j++) {
                                    nextActions += " - " + wfStages.WorkflowStage[i].PossibleActions.PossibleAction[j].PossibleActionName;
                                    if (!Ext.isEmpty(wfStages.WorkflowStage[i].PossibleActions.PossibleAction[j].PossibleActionName)) {
                                        nextStages += wfStages.WorkflowStage[i].PossibleActions.PossibleAction[j].PossibleActionName + " ";
                                    }
                                }
                            }
                            pathStages += ' -> <font color=green><b>' + wfStages.WorkflowStage[i].StageName + '</b></font>' + " (" + nextStages + " ) ";
                        } else {
                            if (wfStages.WorkflowStage[i].PossibleActions.PossibleAction) {
                                if (!Ext.isArray(wfStages.WorkflowStage[i].PossibleActions.PossibleAction)) {
                                    wfStages.WorkflowStage[i].PossibleActions.PossibleAction = new Array(wfStages.WorkflowStage[i].PossibleActions.PossibleAction);
                                }
                                for (var j = 0; j < wfStages.WorkflowStage[i].PossibleActions.PossibleAction.length; j++) {
                                    nextStages += wfStages.WorkflowStage[i].PossibleActions.PossibleAction[j].PossibleActionName + " ";
                                }
                            }
                            pathStages += ' -> ' + wfStages.WorkflowStage[i].StageName + " (" + nextStages + " ) ";
                        }
                    }

                    var myData = [
                        ['<b>WORKFLOW NAME </b>', '<p>' + wfName + '</p>'],
                        ['<b>CURRENT STAGE</b>', '<p>' + record.data.Stage + '</p>'],
                        ['<b>PATH STAGES</b>', '<p>' + pathStages + '</p>'],
                        ['<b>POSITION </b>', '<p>' + stageType + '</p>'],
                        ['<b>NEXT POSSIBLE ACTIONS</b>', '<p>' + nextActions + '</p>'],
                        ['<b>LAST ACTED USER</b>', '<p>' + currentUser + '</p>']
                    ];

                    var store = Ext.create('Ext.data.ArrayStore', {
                        fields: [{
                            name: 'key'
                        }, {
                            name: 'value'
                        }],
                        data: myData
                    });

                    // create the Grid
                    var grid = Ext.create('Ext.grid.Panel', {
                        store: store,
                        forceFit: true,
                        hideHeaders: true,
                        columnLines: true,
                        columns: [{
                            text: 'Property',
                            sortable: false,
                            dataIndex: 'key'
                        }],
                        viewConfig: {
                            plugins: [{
                                pluginId: 'preview',
                                ptype: 'preview',
                                bodyField: 'value',
                                expanded: true
                            }]
                        }
                    });

                    var workflowDetailsWindow = new Ext.Window({
                        autoScroll: true,
                        title: "Workflow Details",
                        modal: true,
                        // layout: 'border',
                        height: 378,
                        width: 550,
                        items: [grid],
                        // [ formItem,cmsErrorpanel ],
                        buttons: [{
                            text: 'Close',
                            handler: function () {
                                workflowDetailsWindow.close();
                            }
                        }]
                    });
                    workflowDetailsWindow.show();


                } else {
                    Ext.DropDownAlert.msg("<div class = 'errorHeaderMsg'>No Data found</div>", "<div class = 'errorMsg'>Workflow not exists OR Access denied</div>");
                }
            },
            failure: function (form, action) {
                Ext.MessageBox.hide();
            },
            waitMsg: 'Loading Metadata. Please Wait ...'
        });
    } else {
        Ext.DropDownAlert.msg("<div class = 'errorHeaderMsg'>No Data found</div>", "<div class = 'errorMsg'>Workflow not associated</div>");
    }

}

/**
 * Method to display workflow comments window
 * @param {json} record
 */

function getWorkflowComments(record) {
    var wfId = record.data.WorkflowId; // 'llkpE6ajbeidc';
    var wfName = record.data.WorkflowName; // 'Test Workflow';
    if (!Ext.isEmpty(wfId)) {
        var workflowDetailsWindow = new Ext.Window({
            autoScroll: true,
            title: "Workflow Comments",
            modal: true,
            // layout: 'border',
            height: 342,
            width: 500,
            items: [{
                xtype: 'panel',
                html: record.data.WorkflowComments,
                height: 278,
                width: 488
            }],
            // [ formItem,cmsErrorpanel ],
            buttons: [{
                text: 'Close',
                handler: function () {
                    workflowDetailsWindow.close();
                }
            }]
        });
        workflowDetailsWindow.show();
    }

}

/**
 * Method to call different windows 
 * @param grid {Ext.grid.panel} 
 * @param rowIndex {Integer}
 * @param edit {String}
 * @param action {Ext.grid.panel}
 * @param preload {Boolean}
 */

function createWindow(grid, rowIndex, edit, action, preload) {
    var activemainPanelGrid = Ext.getCmp(globalActiveTab + '-main-grid');
    if (globalActiveTab == 'cms') {
        cmsCreateWindow(grid, rowIndex, edit, activemainPanelGrid, preload);
    } else if (globalActiveTab == 'pms') {
        pmsCreateWindow(grid, rowIndex, edit, activemainPanelGrid, preload);
    } else if (globalActiveTab == 'admin') {
        adminCreateWindow(grid, rowIndex, edit, activemainPanelGrid, preload);
    } else if (globalActiveTab == 'domain') {
        domainCreateWindow(grid, rowIndex, edit, activemainPanelGrid, preload);
    } else if (globalActiveTab == 'workflow') {
        workflowCreateWindow(grid, rowIndex, edit, activemainPanelGrid, preload);
    } else if (globalActiveTab == 'feed') {
        feedCreateWindow(grid, rowIndex, edit, activemainPanelGrid, preload);
    } else if (globalActiveTab == 'user') {
        userCreateWindow(grid, rowIndex, edit, activemainPanelGrid, preload);
    }
}

// http://124.7.228.161/ncmsui/extjs/js/global-extjs-filterclick-fns.js?_dc=3002

/**
 * Method to display menu
 * @param tab {json}
 * returns json
 */

function showFilterByMenu(tab) {
    var menuHandler = tab + "MenuClickHandler";
    if (typeof filterByMenu == 'function') {
        return filterByMenu(menuHandler);
    } else {
        return filterByMenuCommon(menuHandler);
    }
}

/**
 * Method to display feed menu 
 * @param item {object}  
 */

function feedMenuClickHandler(item) {
    aclQuery = getAclQuery(item, feedCurrentEntity);
    var grid = Ext.getCmp("feed-main-grid");
    grid.store.proxy.url = dataservicesPath + '/search?q=&format=extjson' + aclQuery + '&entitytype=' + feedCurrentEntity;
    grid.store.proxy.setReader({
        type: 'json',
        root: 'Collections.' + feedCurrentEntity,
        totalProperty: 'Collections.Count'
    });
    grid.store.load();
}

/**
 * Method to display cms menu 
 * @param item {object} 
 */

function cmsMenuClickHandler(item) {
    aclQuery = getAclQuery(item, cmsCurrentEntity);
    var grid = Ext.getCmp("cms-main-grid");
    grid.store.proxy.url = dataservicesPath + '/search?q=&format=extjson' + aclQuery + '&entitytype=' + cmsCurrentEntity;
    grid.store.proxy.setReader({
        type: 'json',
        root: 'Collections.' + cmsCurrentEntity,
        totalProperty: 'Collections.Count'
    });
    grid.store.load();
}

/**
 * Method to display user menu 
 * @param item {object}  
 */

function userMenuClickHandler(item) {
    aclQuery = getAclQuery(item, userCurrentEntity);
    var grid = Ext.getCmp("user-main-grid");
    grid.store.proxy.url = dataservicesPath + '/search?q=&format=extjson' + aclQuery + '&entitytype=' + userCurrentEntity;
    grid.store.proxy.setReader({
        type: 'json',
        root: 'Collections.' + userCurrentEntity,
        totalProperty: 'Collections.Count'
    });
    grid.store.load();
}

/**
 * Method to display admin menu 
 * @param item {object} 
 */

function adminMenuClickHandler(item) {
    aclQuery = getAclQuery(item, adminCurrentEntity);
    var grid = Ext.getCmp("admin-main-grid");
    grid.store.proxy.url = dataservicesPath + '/search?q=&format=extjson' + aclQuery + '&entitytype=' + adminCurrentEntity;
    grid.store.proxy.setReader({
        type: 'json',
        root: 'Collections.' + adminCurrentEntity,
        totalProperty: 'Collections.Count'
    });
    grid.store.load();
}

/**
 * Method to display domain menu 
 * @param item {object} 
 */

function domainMenuClickHandler(item) {
    aclQuery = getAclQuery(item, domainCurrentEntity);
    var grid = Ext.getCmp("domain-main-grid");
    grid.store.proxy.url = dataservicesPath + '/search?q=&format=extjson' + aclQuery + '&entitytype=' + domainCurrentEntity;
    grid.store.proxy.setReader({
        type: 'json',
        root: 'Collections.' + domainCurrentEntity,
        totalProperty: 'Collections.Count'
    });
    grid.store.load();
}

/**
 * Method to display pms menu 
 * @param item {object} 
 */

function pmsMenuClickHandler(item) {
    aclQuery = getAclQuery(item, pmsCurrentEntity);
    var grid = Ext.getCmp("pms-main-grid");
    grid.store.proxy.url = dataservicesPath + '/search?q=&format=extjson' + aclQuery + '&entitytype=' + pmsCurrentEntity;
    grid.store.proxy.setReader({
        type: 'json',
        root: 'Collections.' + pmsCurrentEntity,
        totalProperty: 'Collections.Count'
    });
    grid.store.load();
}

/**
 * Method to check whether npimetadata is filled and returns true if filled 
 * @param record
 * @returns {Boolean}
 */

function checkNpiMetaDataFilled(record) {
    if (record.data.EntityType != "InformationArchitecture" && Ext.Array.contains(metaDataInfoList, record.data.EntityType)) {
        if (Ext.isEmpty(record.get('TitleMain'))) {
            return false;
        }
    }
    return true;
}

function prepareStageTransitionData(entityFields) {
    var postData = {};
    for (var property in entityFields) {
        postData[property] = newRec.data[property];
        if (property == 'RelatedItems') {
            var items = {};
            items.RelatedItems = "";
            if (!Ext.isEmpty(newRec.data[property])) {
                items.RelatedItems = Ext.JSON.decode(newRec.data[property]);
            }
            postData[property] = Ext.JSON.encode(items);
        }
        if (property == 'DependentItems') {
            var items = {};
            items.DependentItems = "";
            if (!Ext.isEmpty(newRec.data[property])) {
                items.DependentItems = Ext.JSON.decode(newRec.data[property]);
            }
            postData[property] = Ext.JSON.encode(items);
        }
        if (property == 'AllowedActions') {
            var items = {};
            items.AllowedActions = "";
            if (!Ext.isEmpty(newRec.data[property])) {
                items.AllowedActions = Ext.JSON.decode(newRec.data[property]);
            }
            postData[property] = Ext.JSON.encode(items);
        }
    }
    postData["LastModifiedDate"] = formatDate(new Date(), "Y-m-d H:i:s");
    postData["LastModifiedBy"] = cmsUserName;
    return postData;
}


function cmsWorkflowmenuhandler(item) {
    var grid = Ext.getCmp("cms-main-grid");
    var rec = grid.getSelectionModel().getSelection()[0];
    newRec = objClone(rec);
    cmsCreateWindow("getfields", "", "new", this, true);
    /*if(!checkNpiMetaDataFilled(rec)){  // if this condition needed then apply it for remaining menu handlers
		  Ext.DropDownAlert.msg("<div class = 'errorMsg'>Validation Error</div>", "<div class = 'errorMsg'>NPI Metadata not filled</div>");
		  return false;
	}*/
    var entityFields = getFinalFormParams(cmsCurrentEntity, 'edit', true, rec);
    var postData = prepareStageTransitionData(entityFields);
    sendWorkflowActionRequest(item, postData, cmsCurrentEntity, grid);
    return false;
}

function feedWorkflowmenuhandler(item) {
    var grid = Ext.getCmp("feed-main-grid");
    var rec = grid.getSelectionModel().getSelection()[0];
    newRec = objClone(rec);
    var postData = {};
    feedCreateWindow("getfields", "", "new", this, true);
    var entityFields = getFinalFormParams(feedCurrentEntity, 'edit', true, rec);
    var postData = prepareStageTransitionData(entityFields);
    sendWorkflowActionRequest(item, postData, feedCurrentEntity, grid);
}

function userWorkflowmenuhandler(item) {
    var grid = Ext.getCmp("user-main-grid");
    var rec = grid.getSelectionModel().getSelection()[0];
    newRec = objClone(rec);
    var postData = {};
    userCreateWindow("getfields", "", "new", this, true);
    var entityFields = getFinalFormParams(userCurrentEntity, 'edit', true, rec);
    var postData = prepareStageTransitionData(entityFields);
    sendWorkflowActionRequest(item, postData, userCurrentEntity, grid);
}

function domainWorkflowmenuhandler(item) {
    var grid = Ext.getCmp("domain-main-grid");
    var rec = grid.getSelectionModel().getSelection()[0];
    newRec = objClone(rec);
    var postData = {};
    domainCreateWindow("getfields", "", "new", this, true);
    var entityFields = getFinalFormParams(domainCurrentEntity, 'edit', true, rec);
    var postData = prepareStageTransitionData(entityFields);
    sendWorkflowActionRequest(item, postData, domainCurrentEntity, grid);
}

function pmsWorkflowmenuhandler(item) {
    var grid = Ext.getCmp("pms-main-grid");
    var rec = grid.getSelectionModel().getSelection()[0];
    newRec = objClone(rec);
    var postData = {};
    pmsCreateWindow("getfields", "", "new", this, true);
    var entityFields = getFinalFormParams(pmsCurrentEntity, 'edit', true, rec);
    var postData = prepareStageTransitionData(entityFields);
    sendWorkflowActionRequest(item, postData, pmsCurrentEntity, grid);
}

function allowDeleteColumn(entity) {
    if (!Ext.Array.contains(masterEntities, entity) || isSuperAdmin()) {
        return true;
    }
    return false;
}

function allowStageColorColumn(entity) {
    if (Ext.Array.contains(workflowEntities, entity)) {
        return true;
    }
    return false;
}

function getAclQuery(item, cEntity) {
    var activeItem = item.group;
    var aclQuery = "";
    var nowDate = formatDate(new Date(), 'Y-m-d') + "T" + formatDate(new Date(), 'H:i:s') + "Z";
    if (activeItem == "createdby") {
        aclQuery += "&createdby=" + cmsUserName;
    } else if (activeItem == "assignedtouser") {
        aclQuery = "&" + activeItem + "=" + cmsUserName + aclStatus;
    } else if (activeItem == "stage") {
        aclQuery = "&stage=" + item.text;
        if (!isSuperAdmin()) {
            aclQuery += "&createdby=" + cmsUserName;
        }
    } else if (activeItem == "status") {
        aclQuery = "&" + activeItem + "=" + "published";
    } else if (activeItem == "today") {
        aclQuery = "&CreatedDate=" + "[" + formatDate(new Date(), 'Y-m-d') + "T00:00:00Z TO " + nowDate + "]";
        if (!isSuperAdmin()) {
            aclQuery += "&createdby=" + cmsUserName;
        }
    } else if (activeItem == "lastweek") {
        aclQuery = "&CreatedDate=" + "[NOW-7DAY TO " + nowDate + "]";
        if (!isSuperAdmin()) {
            aclQuery += "&createdby=" + cmsUserName;
        }
    } else if (activeItem == "lastmonth") {
        aclQuery = "&CreatedDate=" + "[NOW-1MONTH TO " + nowDate + "]";
        if (!isSuperAdmin()) {
            aclQuery += "&createdby=" + cmsUserName;
        }
    } else if (cEntity == "InformationArchitecture" && activeItem == "associatediapath") {
        aclQuery = "&parentianame=" + item.text;
        if (!isSuperAdmin()) {
            aclQuery += "&createdby=" + cmsUserName;
        }
    } else {
        aclQuery = "&" + activeItem + "=" + item.id;
        if (!isSuperAdmin()) {
            aclQuery += "&createdby=" + cmsUserName;
        }
    }
    return aclQuery;
}

/**
 *  Method to preview a image
 * @param imgPath {String} 
 * @returns {Object}
 */

function showImagePreview(imgPath){
      var winHeight = getWindowHeight();
      if (!imagePreview) {
        var imagePreview = new Ext.Window({
            // closeAction : 'hide',
            autoScroll: true,
            title: 'Image Preview',
            modal: true,
            height: winHeight,
            width: 755,
            items: new Ext.ux.Image ({ id: 'ImgPreview', url: imgPath }),
            buttons: [{
                text: 'Cancel',
                iconCls: 'icon-wincancel',
                handler: function () {
                    imagePreview.close();
                }
            }]
        });
	imagePreview.show();
    }   
}

/**
 *  Method to preview a video
 * @param videoPath {String} 
 * @returns {Object}
 */

function showVideoPreview(videoPath){
      var winHeight  = getWindowHeight();
      var videoPanel = Ext.create('Ext.panel.Panel', {
	  region: 'center',
	  autoScroll: true,
	  labelStyle: 'white-space: nowrap;',
	  width: 750,
	  height: 450,
	 /* html: "<object id='clipboard' codebase='http://download.macromedia.com/pub/shockwave/cabs/ flash/swflash.cab#version=9,0,0,0' width='16' height='16' align='middle'><param name='allowScriptAccess' value='always' /><param name='allowFullScreen' value='false' /><param name='movie' value='http://static.sify.com/cms/article/mfrrkffcgia.flv' /><param name='quality' value='high' /><param name='bgcolor' value='#ffffff' /><param name='wmode' value='transparent' /><param name='flashvars' value='callback=f1' /><embed src='http://static.sify.com/cms/article/mfrrkffcgia.flv' flashvars='callback=f1' quality='high' swliveconnect='true' bgcolor='#ffffff' width='16' height='16' wmode='transparent' name='clipboard' align='middle' allowscriptaccess='always' allowfullscreen='false' type='application/x-shockwave-flash' pluginspage='http://www.adobe.com/go/getflashplayer' /></object>", */
	  defaults: {
	      bodyStyle: 'padding:10px'
	  },
	  items: {  xtype: 'flash',
                url: 'http://static.sify.com/cms/article/mfrrkffcgia.flv' }
      });
      if(!videoPreview) {
	  var videoPreview = new Ext.Window({
	      autoScroll: true,
	      title: 'Video Preview',
	      modal: true,
	      layout: 'border',
	      height: winHeight,
	      width: 755,
	      items: [videoPanel],
	      buttons: [{
		  text: 'Cancel',
		  iconCls: 'icon-wincancel',
		  handler: function () {
		      videoPreview.close();
		  }
	      }]
	  });
	  videoPreview.show();
      }   
}

/**
 * Method to display all possible Workflow actions in a context menu
 * @param currentTab {String} 
 * @param view {Ext.grid.panel}
 * @param record {Json}
 * @param node {}
 * @param index Integer}
 * @param e {Object}
 * @returns {Boolean}
 */

function contextMenu(currentTab, view, record, node, index, e) {
    var possibleStates = [];
    var actionsDisabled = true;
    var commentsDisabled = true;
    var detailsDisabled = true;
    var ctextMenu;
    var states = new Array();
    var docStatus = '';
    var s = 0;
    e.stopEvent();
    if (!Ext.isEmpty(record) && !Ext.isEmpty(record.data.Status)) {
        docStatus = record.data.Status;
    }
    try {
        view.getSelectionModel().select(record);
        if (Ext.isEmpty(record.data.WorkflowName)) {
            return false;
        }
        if (record.data.AllowedActions) {
            var allowedActions = Ext.JSON.decode(record.data.AllowedActions);
            if (!Ext.isArray(allowedActions.AllowedAction)) {
                allowedActions.AllowedAction = new Array(allowedActions.AllowedAction);
            }
            for (var i = 0; i < allowedActions.AllowedAction.length; i++) {
                if (!Ext.isEmpty(allowedActions.AllowedAction[i].AllowedActionName)) {
                    var allowedusers = allowedActions.AllowedAction[i].AssignedToUsers.AssignedToUser;
                    // if(Ext.isArray(allowedusers)){
                    allowedusers = allowedusers.toString().toLowerCase();
                    // }
                    // if(((allowedusers.toLowerCase().indexOf(cmsUserName.toLowerCase())
                    // != -1))){
                    allowedusers = allowedusers.split(",");
                    /*if((allowedusers.toLowerCase().indexOf(cmsUserName.toLowerCase()) != -1
						 || isSuperAdmin()) && allowedActions.AllowedAction[i].AllowedActionName){
					possibleStates[s] = Ext.decode('{text:"'+allowedActions.AllowedAction[i].AllowedActionName 
							+'",checked: false,group: "theme",handler: '+currentTab+'Workflowmenuhandler}');
					actionsDisabled = false;
					s++;
				}*/
                    if ((Ext.Array.contains(allowedusers, cmsUserName.toLowerCase()) || isSuperAdmin()) && allowedActions.AllowedAction[i].AllowedActionName) {
                        possibleStates[s] = Ext.decode('{text:"' + allowedActions.AllowedAction[i].AllowedActionName + '",checked: false,group: "theme",handler: ' + currentTab + 'Workflowmenuhandler}');
                        actionsDisabled = false;
                        s++;
                    }
                }
            }
        }
        if (isSuperAdmin()) {
            possibleStates[s] = Ext.decode('{text:"Ratify",checked: false,group: "theme",handler: ' + currentTab + 'Workflowmenuhandler}');
            actionsDisabled = false;
        }
        if (record.data.WorkflowName) {
            detailsDisabled = false;
        }
        if (isSuperAdmin() || docStatus != "Published") {
            commentsDisabled = false;
        }
    } catch (exception) {
        //alert(exception);
    }
    if(record.data.EntityType=='Media'){ 
	  ctextMenu = Ext.create('Ext.menu.Menu', {
	      items:[ 		  
		{
		    text: "Preview",
		    handler: function () {
		     //   var imgPath = location.protocol+'//'+location.host+mediaPath+record.data.FilePath;
		     //   showVideoPreview(imgPath);
		    },
		    disabled: false
		},{
		    text: "Copy Properties",
		    disabled: false
		},{
		    text: "Paste Properties",
		    disabled: false
		},{
		    text: "Crop",
		    disabled: false
		},{
		    text: "Resize",
		    disabled: false
		},{
		    text: "Change Thumbnail",
		    disabled: false
		},{
		    text: "Add Thumbnails",
		    disabled: false
		},
		{
		      text: "Workflow",
		      menu: {
			items: [{
			    text: "Actions",
			    menu: {
				items: [possibleStates]
			    },
			    disabled: actionsDisabled

			  }, {
			    text: "Workflow Details",
			    handler: function () {
				getWorkflowDetails(record);
			    },
			    disabled: detailsDisabled
			  }, {
			    text: "Workflow Comments",
			    handler: function () {
				getWorkflowComments(record);
			    },
			    disabled: commentsDisabled

		      }]
		  }
		}
	    ],
	    scope: this
	  });
    }
    else{      
	  ctextMenu = Ext.create('Ext.menu.Menu', {
		    items: [{
		      text: "Workflow",
		      menu: {
			items: [{
			    text: "Actions",
			    menu: {
				items: [possibleStates]
			    },
			    disabled: actionsDisabled

			  }, {
			    text: "Workflow Details",
			    handler: function () {
				getWorkflowDetails(record);
			    },
			    disabled: detailsDisabled
			  }, {
			    text: "Workflow Comments",
			    handler: function () {
				getWorkflowComments(record);
			    },
			    disabled: commentsDisabled
		      }]
		  }
	      }],
	      scope: this
	});
	// return ctextMenu;
    }
    ctextMenu.showAt(e.getXY());
}

/**
 * 
 * @param record
 */

function itemsGridPreLoader(record) {
    var entityName = record.data.EntityType;
    var form3 = Ext.getCmp(entityName + 'Form3');
    var form4 = Ext.getCmp(entityName + 'Form4');
    var dependentView = Ext.getCmp('dependent-images-view');
    var relatedView = Ext.getCmp('related-images-view');
    if (typeof (form3) != "undefined") {
        dependentView.getStore().removeAll();
        if (record.data.DependentItems) {
            var depItemRecords = Ext.JSON.decode(record.data.DependentItems);
            if (depItemRecords.DependentItem) {
                if (Ext.isArray(depItemRecords.DependentItem)) {
                    dependentView.store.loadData(depItemRecords.DependentItem);
                } else {
                    dependentView.store.loadData(new Array(depItemRecords.DependentItem));
                }
            }
        }
    }

    if (typeof (form4) != "undefined") {
        relatedView.getStore().removeAll();
        if (record.data.RelatedItems) {
            var relatedItemRecords = Ext.JSON.decode(record.data.RelatedItems);
            if (relatedItemRecords.RelatedItem) {
                if (Ext.isArray(relatedItemRecords.RelatedItem)) {
                    relatedView.store.loadData(relatedItemRecords.RelatedItem);
                } else {
                    relatedView.store.loadData(new Array(relatedItemRecords.RelatedItem));
                }
            }
        }
    }
}

function comboPreLoader(grid, rowIndex, action, preload) {
    var dependentView = Ext.getCmp('dependent-images-view');
    var relatedView   = Ext.getCmp('related-images-view');
    var j = 1;
    var record;
    if (preload) {
        aForms = new Array();
        dependentView.store.removeAll();
        relatedView.store.removeAll();
        return false;
    }
    record = grid.getStore().getAt(rowIndex);
    itemsGridPreLoader(record);

    // while(j < aForms.length){
    while (j < 8) {
        if (j != 3 && j != 4) {
            var formPanel = Ext.getCmp(record.data.EntityType + 'Form' + j);
            if (!Ext.isEmpty(formPanel)) {
                var form = formPanel.getForm();
                if (!Ext.isEmpty(form)) {
                    // console.log("form length :" + aForms.length);
                    var formCombo = form;
                    if ((rowIndex) || (rowIndex == "0") && !preload) {
                        var record = grid.getStore().getAt(rowIndex);
                    }
                    var collections = formCombo.getFields();
                    var count = collections.getCount();
                    for (var i = 0; i < count; i++) {
                        var field = collections.getAt(i);
                        if (field.getXType() == 'htmleditor' && !preload) {
                            field.setValue(record.data[field.getName()]);
                        }
                        if (field.getXType() == 'filefield') {
                            field.setRawValue(record.data[field.getName()]);
                        } else if (field.getXType() == 'combobox') {
                            if (field.multiSelect) {
                                /*
                                 * field.store.on('load',function(){
                                 * field.setValue(record.data[field.getName()].split(','));
                                 * },this);
                                 */
                                if (preload) {
                                    // field.store.load();
                                } else {
                                    // console.log(field.getName() + ":" +
                                    // field.getXType() + ":" +
                                    // record.data[field.getName()] + ": SET VALUE");
                                    var fieldValue = record.data[field.getName()].split(',');
                                    if (!Ext.isEmpty(fieldValue)) { 
                                        field.setValue(fieldValue);
                                    }
                                }
                            } else {
                                if (!preload) {
                                    if (field.getName() == 'WorkflowName' && !isSuperAdmin() && record.data.Stage != "Draft") {
                                        field.setValue(record.data[field.getName()]);
                                        field.readOnly = true;
                                    }
                                    else if(field.getName() == 'JurisdictionStateName' && action == 'edit' && Ext.getCmp('JurisdictionJurisdictionName').getValue().toLowerCase() == 'state') {  
	                               field.setValue(record.data[field.getName()]); 
				       field.setVisible(true);
	                            }
	                            else if(field.getName() == 'JurisdictionDistrictName' && Ext.getCmp('JurisdictionJurisdictionName').getValue().toLowerCase() == 'state') {
				       if(record.data[field.getName()]){
				         field.setVisible(true);
				         field.setValue(record.data[field.getName()]); 
				       } 	 
				    }
                                    else if (field.getName() == 'IsActive' && !isSuperAdmin()) {
                                        field.setValue(record.data[field.getName()]);
                                        field.readOnly = true;
                                    }
                                    else if (field.getName() == 'UserRole' && !isSuperAdmin()) {
                                        field.setValue(record.data[field.getName()]);
                                        field.readOnly = true;
                                    }
                                    else {
                                        field.setValue(record.data[field.getName()]);
                                    }
                                }
                            }
                        } else {
                            if (action != "new" && !preload) {
                                if (field.getName() == 'UserName') {
                                    field.readOnly = true;
                                }
                                if (field.getName() == 'Id') {
                                    field.hidden = false;
                                }
                                field.setValue(record.data[field.getName()]);
                            }
                        }
                    }
                }
            }
        }
        j++;
    }
    /*
     * if(aForms[1]){ var npiEditData = npiFormHandler(action,record.data.Id); }
     */
}

function loadFormsArray(entityName) {
    var form1 = Ext.getCmp(entityName + 'Form1');
    var form2 = Ext.getCmp(entityName + 'Form2');
    var form5 = Ext.getCmp(entityName + 'Form5');
    var form6 = Ext.getCmp(entityName + 'Form6');
    var form7 = Ext.getCmp(entityName + 'Form7');
    var form8 = Ext.getCmp(entityName + 'Form8');

    if (!Ext.isEmpty(form1)) {
        aForms[0] = form1.getForm();
    }
    if (!Ext.isEmpty(form2)) {
        aForms[1] = form2.getForm();
    }

    if (!Ext.isEmpty(form5)) {
        aForms[2] = form5.getForm();
    }
    if (!Ext.isEmpty(form6)) {
        aForms[3] = form6.getForm();
    }
    if (!Ext.isEmpty(form7)) {
        aForms[4] = form7.getForm();
    }
    if (!Ext.isEmpty(form8)) {
        aForms[5] = form8.getForm();
    }
}

function validateForm(saveEntityName) {
    if(saveEntityName === "NpiMetadata"){
      return validateNpiForm(aForms[0]);
    }
    else{
      for (var i = 0; i < aForms.length; i++) {
        if (!Ext.isEmpty(aForms[i])) {
            if (!aForms[i].isValid()) {
                if (i == 1) {
                    return validateNpiForm(aForms[1]);
                }
                return false;
            }
        }
      }
    }
    
    return true;
}

function getFinalFormParams(currentEntity, action, fieldsOnly, record) {
    var form1data = {};
    var form1 = Ext.getCmp(currentEntity + 'Form1');
    var form2 = Ext.getCmp(currentEntity + 'Form2');
    var form3 = Ext.getCmp(currentEntity + 'Form3');
    var form4 = Ext.getCmp(currentEntity + 'Form4');
    var form5 = Ext.getCmp(currentEntity + 'Form5');
    var form6 = Ext.getCmp(currentEntity + 'Form6');
    var form7 = Ext.getCmp(currentEntity + 'Form7');
    var form8 = Ext.getCmp(currentEntity + 'Form8');
    if (fieldsOnly) {
        if (currentEntity == "PageAssociator") {
            form1data = {
                Site: '',
                Id: '',
                EntityType: 'PageAssociator',
                PageEntityName: '',
                PageName: '',
                IaName: '',
                Status: '',
                CreatedDate: '',
                CreatedBy: '',
                LastModifiedDate: '',
                LastModifiedBy: '',
                Version: '',
                AllowedActions: '',
                CurrentUser: '',
                CurrentAction: '',
                WorkflowId: '',
                WorkflowName: '',
                WorkflowComments: '',
                Stage: ''
            }

        } else {
            if (!Ext.isEmpty(form1)) {
                var fields = form1.getForm().getFields();
                for (var i = 0; i < fields.length; i++) {
                    form1data[fields.getAt(i).name] = '';
                }
            }

            if (!Ext.isEmpty(form2)) {
                var fields = form2.getForm().getFields();
                for (var i = 0; i < fields.length; i++) {
                    form1data[fields.getAt(i).name] = '';
                }
            }
            if (!Ext.isEmpty(form3)) {
                form1data["DependentItems"] = '';
            }
            if (!Ext.isEmpty(form4)) {
                form1data["RelatedItems"] = '';
            }
            if (!Ext.isEmpty(form5)) {
                var form = form5.getForm();
                var fields = form.getFields();
                for (var i = 0; i < fields.length; i++) {
                    form1data[fields.getAt(i).name] = '';
                }
            }

            if (!Ext.isEmpty(form6)) {
                var form = form6.getForm();
                var fields = form.getFields();
                for (var i = 0; i < fields.length; i++) {
                    form1data[fields.getAt(i).name] = '';
                }
            }
            if (!Ext.isEmpty(form7)) {
                var form = form7.getForm();
                var fields = form.getFields();
                for (var i = 0; i < fields.length; i++) {
                    form1data[fields.getAt(i).name] = '';
                }
            }
            if (!Ext.isEmpty(form8)) {
                var form = form8.getForm();
                var fields = form.getFields();
                for (var i = 0; i < fields.length; i++) {
                    form1data[fields.getAt(i).name] = '';
                }
            }
        }
        if (record.data.AllowedActions) {
            form1data["AllowedActions"] = '';
        }
        form1data.EntityType = currentEntity;
        form1data.CreatedBy = cmsUserName;
        return form1data;
    }
    if(aForms[0].findField('Password') && aForms[0].findField('Password').getValue()!=''){
      aForms[0].findField('Password').vtype = "alphanumMid";
      aForms[0].findField('Password').setValue(md5(aForms[0].findField('Password').getValue()));
    }  
    form1data = aForms[0].getValues();
    if (typeof (form3) != "undefined") {
        var depStore = Ext.data.StoreManager.lookup('itemDependentViewStore');
        form1data["DependentItems"] = getJsonOfStore('DependentItems', 'DependentItem', depStore);
    }
    if (typeof (form4) != "undefined") {
        var relatedStore = Ext.data.StoreManager.lookup('itemRelatedViewStore');
        form1data["RelatedItems"] = getJsonOfStore('RelatedItems', 'RelatedItem', relatedStore);
    }

    if (currentEntity == "Workflow") {
        var workflowStore = Ext.data.StoreManager.lookup('workflow-usermap-grid');
        var jsonString = getJsonOfStore('WorkflowStages', 'WorkflowStage', workflowStore);
        var jsonData = Ext.JSON.decode(jsonString);
        jsonData.WorkflowStages.WorkflowStage = compressArray(jsonData.WorkflowStages.WorkflowStage);
        form1data["WorkflowStages"] = Ext.JSON.encode(jsonData);
    }
    // To Remove in future
    if (!Ext.isEmpty(form2)) {
        var form = form2.getForm();
        var fields = form.getFields();
        for (var i = 0; i < fields.length; i++) {
            if (fields.getAt(i).xtype == 'datetimefield') {
                var datevalue = fields.getAt(i).getValue();
                if (!Ext.isEmpty(datevalue)) {
                    form1data[fields.getAt(i).name] = formatDate(new Date(fields.getAt(i).getValue()), "Y-m-d H:i:s");
                }
            } else {
                if (Ext.isEmpty(fields.getAt(i).getValue())) {
                    form1data[fields.getAt(i).name] = '';
                } else {
                    form1data[fields.getAt(i).name] = fields.getAt(i).getValue();
                }
            }
        }
    }
   
    //if(form1data["JurisdictionName"] && form1data["JurisdictionName"].toLowerCase() == "central"){
    if(Ext.getCmp("JurisdictionJurisdictionName")) {
      var juriName = Ext.getCmp("JurisdictionJurisdictionName").getValue();
      if(!Ext.isEmpty(juriName)){
	     if(juriName.toLowerCase() == "allindia"){
		Ext.getCmp("JurisdictionJurisdictionName").forceSelection = false;
		Ext.getCmp("JurisdictionJurisdictionName").setRawValue(juriName);
		form1data["JurisdictionName"] = juriName;
		form1data["JurisdictionStateId"] = '';
		form1data["JurisdictionDistrictId"] = '';
		Ext.getCmp("JurisdictionJurisdictionStateId").setValue('');
		Ext.getCmp("JurisdictionJurisdictionDistrictId").setValue('');
	    }
	    else if(juriName.toLowerCase() == "state"){
	         Ext.getCmp("JurisdictionJurisdictionName").forceSelection = false;
		 Ext.getCmp("JurisdictionJurisdictionName").setRawValue(juriName);
		 form1data["JurisdictionName"] = juriName;
		// Ext.getCmp("JurisdictionJurisdictionStateName").setVisible(true);
		// Ext.getCmp("JurisdictionJurisdictionDistrictName").setVisible(true);
	    }
	   /*
	    else if(juriName.toLowerCase() == "both"){
	        Ext.getCmp("JurisdictionJurisdictionName").forceSelection = false;
	        Ext.getCmp("JurisdictionJurisdictionName").setRawValue(juriName);
		form1data["JurisdictionStateId"] = '';
		form1data["JurisdictionDistrictId"] = '';
		  Ext.getCmp("JurisdictionJurisdictionStateId").setValue('');
		  Ext.getCmp("JurisdictionJurisdictionDistrictId").setValue('');
		  form1data["JurisdictionName"] = juriName;
	    } */
      }
    }

    if (!Ext.isEmpty(form5)) {
        var form = form5.getForm();
        var fields = form.getFields();
        for (var i = 0; i < fields.length; i++) {
            if (fields.getAt(i).xtype == 'datetimefield') {
                var datevalue = fields.getAt(i).getValue();
                if (!Ext.isEmpty(datevalue)) {
                    form1data[fields.getAt(i).name] = formatDate(new Date(fields.getAt(i).getValue()), "Y-m-d H:i:s");
                }
            } else {
                if (Ext.isEmpty(fields.getAt(i).getValue())) {
                    form1data[fields.getAt(i).name] = '';
                } else {
                    form1data[fields.getAt(i).name] = fields.getAt(i).getValue();
                }
            }
        }
    }
    if (!Ext.isEmpty(form6)) {
        var form = form6.getForm();
        var fields = form.getFields();
        for (var i = 0; i < fields.length; i++) {
            if (fields.getAt(i).xtype == 'datetimefield') {
                var datevalue = fields.getAt(i).getValue();
                if (!Ext.isEmpty(datevalue)) {
                    form1data[fields.getAt(i).name] = formatDate(new Date(fields.getAt(i).getValue()), "Y-m-d H:i:s");
                }
            } else {
                if (Ext.isEmpty(fields.getAt(i).getValue())) {
                    form1data[fields.getAt(i).name] = '';
                } else {
                    form1data[fields.getAt(i).name] = fields.getAt(i).getValue();
                }
            }
        }
    }
    if (!Ext.isEmpty(form7)) {
        var form = form7.getForm();
        var fields = form.getFields();
        for (var i = 0; i < fields.length; i++) {
            if (fields.getAt(i).xtype == 'datetimefield') {
                var datevalue = fields.getAt(i).getValue();
                if (!Ext.isEmpty(datevalue)) {
                    form1data[fields.getAt(i).name] = formatDate(new Date(fields.getAt(i).getValue()), "Y-m-d H:i:s");
                }
            } else {
                if (Ext.isEmpty(fields.getAt(i).getValue())) {
                    form1data[fields.getAt(i).name] = '';
                } else {
                    form1data[fields.getAt(i).name] = fields.getAt(i).getValue();
                }
            }
        }
    }

    if (!Ext.isEmpty(form8)) {
        var form = form8.getForm();
        var fields = form.getFields();
        for (var i = 0; i < fields.length; i++) {
            if (fields.getAt(i).xtype == 'datetimefield') {
                var datevalue = fields.getAt(i).getValue();
                if (!Ext.isEmpty(datevalue)) {
                    form1data[fields.getAt(i).name] = formatDate(new Date(fields.getAt(i).getValue()), "Y-m-d H:i:s");
                }
            } else {
                if (Ext.isEmpty(fields.getAt(i).getValue())) {
                    form1data[fields.getAt(i).name] = '';
                } else {
                    form1data[fields.getAt(i).name] = fields.getAt(i).getValue();
                }
            }
        } 
	if(action == 'edit'){ 
           form1data['Password'] = Ext.getCmp("CmsUserProfileChangePassword").getValue();
           if(Ext.getCmp("CmsUserProfileOldPassword").getValue()!='')
             form1data['OldPassword'] = md5(Ext.getCmp("CmsUserProfileOldPassword").getValue());
        } 
    }
    if(action == 'new' && Ext.getCmp("CmsUserProfilePassword")){ 
	form1data['Password'] = Ext.getCmp("CmsUserProfilePassword").getValue();
    }
    if (form1data.WorkflowName) {
        if (!Ext.isEmpty(record)) {
            form1data["AllowedActions"] = Ext.JSON.encode({
                "AllowedActions": Ext.JSON.decode(record.data.AllowedActions)
            });
        }
    }
   
    if (form1data['Password'] && !Ext.isEmpty(form1data['Password'])) {    
        form1data['Password'] = md5(form1data['Password']);
    }
    form1data.LastModifiedDate = formatDate(new Date(), "Y-m-d H:i:s");
    form1data.EntityType = currentEntity;
    form1data.LastModifiedBy = cmsUserName;
    return form1data;
}

function getContent() {
    return jtext;
}

function getLayoutPath() {
    return layoutTemplatePath;
}

function compressArray(original) {
    var compressed = [];
    var k = 0;
    var status = false;
    for (var j = 0; j < original.length; j++) {
        status = false;
        for (var i = 0; i < compressed.length; i++) {
            if (original[j].StageName == compressed[i].StageName) {
                status = true;
                var count = compressed[i].PossibleActions.PossibleAction.length;
                var possibleUsers = {};
                possibleUsers.PossibleActionUser = [];
                possibleUsers.PossibleActionUser = original[j].PossibleActionUser;
                compressed[i].PossibleActions.PossibleAction[count] = {
                    PossibleActionName: original[j].PossibleActionName,
                    NextStage: original[j].NextStage,
                    NextContentStatus: original[j].NextContentStatus,
                    PossibleActionUsers: possibleUsers
                }
            }
        }
        if (!status) {
            compressed[k] = original[j];
            compressed[k].PossibleActions = {};
            compressed[k].PossibleActions.PossibleAction = [];
            var possibleUsers = {};
            possibleUsers.PossibleActionUser = [];
            possibleUsers.PossibleActionUser = original[j].PossibleActionUser;
            compressed[k].PossibleActions.PossibleAction[0] = {
                PossibleActionName: original[j].PossibleActionName,
                NextStage: original[j].NextStage,
                NextContentStatus: original[j].NextContentStatus,
                PossibleActionUsers: possibleUsers
            };
            delete compressed[k].PossibleActionName;
            delete compressed[k].NextContentStatus;
            delete compressed[k].PossibleActionUser;
            delete compressed[k].NextStage;
            k++;
        }
    }
    return compressed;
}

function getStagingSiteUrl() {
    return stagingSiteUrl;
}

function getHtml() {
    jtext = Ext.getCmp("pmstemplatecontent").getValue();
    jtext = getPagePreview();
    var re = /<script\b[^>]*>([\s\S]*?)<\/script>/gm;
    if (jtext.match(re)) {
        Ext.Msg.confirm('Script', 'Script Tag Found in Body Content. Do you want to proceed? ', function (btn) {
            if (btn == 'Yes' || btn == 'yes') {
                jtext = jtext.replace(/\<script/g, "_START_SCRIPT_").replace(/<\/script>/g, "_END_SCRIPT_");
                getWindow();
            }
        }, this);
    } else {
        getWindow();
    }
}

function getWindow() {
    var NewWin = window.open("", "NewWin", "toolbar=no,status=no,scrollbars=yes,resizable=yes");
    // NewWin.document.write('<link href="/ncmsui/extjs/css/layout.css"
    // rel="stylesheet" type="text/css"></link>');
    // NewWin.document.write('<script type="text/javascript"
    // src="/ncmsui/extjs/js/layoutmaster.js"><\/script>');
    NewWin.document.write('<div style="width:100%;float:left;" id="outerdiv">');
    NewWin.document.write('<div style="width:20%;float:left;">');
    NewWin.document.write('<div style="width:100%;float:left;margin-top:10px;margin-bottom:20px;"><div style="width:100%;float:left;font-weight:bold;font-size:14px;">Widget Listing</div></div>');
    NewWin.document.write('<div id ="gethtmlbut" style="width:100%;float:left">');
    NewWin.document.write('</div>');
    NewWin.document.write("<div style='width:100%;float:left;margin-top:10px;margin-bottom:10px;' id='ghtmlbut'><input type='button' name='ghtml' id='ghtml' value='GetHtml' onClick='javascript: return gethtml();' align='center'></input></div>");
    NewWin.document.write('</div>');
    NewWin.document.write('<div style="width:78%;float:left;margin-left:10px;">');
    NewWin.document.write('<div style="width:100%;float:left;" id="contentouter">');
    // NewWin.document.write('<iframe id="layoutiframe" width="100%"
    // height="100%" scrolling="yes"></iframe>');
    NewWin.document.write('</div>');
    NewWin.document.write('</div>');
    NewWin.document.write('</div>');
    NewWin.document.write('<script type="text/javascript">function getScript(jsPath){var headID=document.getElementsByTagName("head")[0]; var jsNode = document.createElement("script"); jsNode.type="text/javascript"; jsNode.src=jsPath; headID.appendChild(jsNode);}getScript("/ncmsui/extjs/js/jquery.min.js");function loadScript(){if(typeof jQuery == "undefined"){window.setTimeout(function(){loadScript();}, 10); return;}else{getScript("/ncmsui/extjs/js/layout.js");}}loadScript();<\/script>');
    return NewWin;
}

function getPage() {
    var content = getPagePreview();
    var NewWin = window.open("", "NewWin", "toolbar=no,status=no,scrollbars=yes");
    NewWin.document.write(content);
}

function getPagePreview() {
    var ptext = Ext.getCmp("pmstemplatecontent").getValue();
    var newtxt = ptext.replace(/^\s+|\s+$/g, '').replace(/\&lt;/g, "<").replace(/\&gt;/g, ">");
    newtxt = newtxt.replace(/_START_SCRIPT_/g, "<script").replace(/_END_SCRIPT_/g, "<\/script>");
    dom = $(newtxt);

    dom.filter('script').each(function (i, item) {
        var scriptsrc = $(item).attr("src");
        if (typeof (scriptsrc) != "undefined" && scriptsrc != "") {
            if (scriptsrc.indexOf('http') == -1) {
                newtxt = newtxt.replace('src="' + scriptsrc + '"', 'src="' + stagingSiteUrl + scriptsrc + '"');
                newtxt = newtxt.replace("src='" + scriptsrc + "'", "src='" + stagingSiteUrl + scriptsrc + "'");
            }
        }
    });

    dom.filter('link').each(function (i, item) {
        var linkhref = $(item).attr("href");
        if (typeof (linkhref) != "undefined" && linkhref != "") {
            if (linkhref.indexOf('http') == -1) {
                newtxt = newtxt.replace('href="' + linkhref + '"', 'href="' + stagingSiteUrl + linkhref + '"');
                newtxt = newtxt.replace("href='" + linkhref + "'", "href='" + stagingSiteUrl + linkhref + "'");
            }
        }
    });

    dom.find('img').each(function (i, item) {
        var imgsrc = $(item).attr("src");
        //	  $(item).attr("src", imgsrc+i);
        if (typeof (imgsrc) != "undefined" && imgsrc != "") {
            if (imgsrc.indexOf('http') == -1) {
                newtxt = newtxt.replace('src="' + imgsrc + '"', 'src="' + stagingSiteUrl + imgsrc + '"');
                newtxt = newtxt.replace("src='" + imgsrc + "'", "src='" + stagingSiteUrl + imgsrc + "'");
            }
        }
    });

    dom.find('a').each(function (i, item) {
        var ahref = $(item).attr("href");
        if (typeof (ahref) != "undefined" && ahref != "") {
            if (ahref.indexOf('http') == -1 && ahref.indexOf("#") == -1 && ahref.indexOf("javascript") == -1 && ahref.indexOf("Javascript")) {
                newtxt = newtxt.replace('href="' + ahref + '"', 'href="' + stagingSiteUrl + ahref + '"');
                newtxt = newtxt.replace("href='" + ahref + "'", "href='" + stagingSiteUrl + ahref + "'");
            }
        }
    });
    return newtxt;
}

function formatDate(date, format) {
    return Ext.Date.format(date, format);
}

function npiFormHandler(action, contentId) {
    if (contentId != '') {
        Ext.Ajax.request({
            method: 'GET',
            url: dataservicesPath + '/npimetadata/search?q=&format=extjson&contentid=' + contentId,
            method: "GET",
            // timeout: 30,
            success: function (response) {
                var collectionsObj = Ext.JSON.decode(response.responseText);
                if (collectionsObj.Collections.Count == 1) {
                    formDataLoader(aForms[1], collectionsObj.Collections.NpiMetadata);
                } else {
                    return false;
                }
            },
            failure: function (form, action) {
                Ext.MessageBox.hide();
            },
            waitMsg: 'Loading Metadata. Please Wait ...'
        });
    }
}

function formDataLoader(form, valuesObj) {
    var collections = form.getFields();
    var count = collections.getCount();
    for (var i = 0; i < count; i++) {
        var field = collections.getAt(i);
        if (field.getXType() == 'htmleditor') {
            field.setValue(valuesObj[field.getName()]);
        } else if (field.getXType() == 'combobox') {
            if (field.multiSelect) {
                if (field.store.getCount > 0) {
                    field.setValue(valuesObj[field.getName()].split(','));
                } else {
                    field.setValue(valuesObj[field.getName()]);
                }
            } else {
                field.setValue(valuesObj[field.getName()]);
            }
        } else {
            field.setValue(valuesObj[field.getName()]);
        }
    }
}

/**
 * Method to validate a form and return false if it is filled 
 * @param form {Object}
 * @returns {Boolean}
 */

function isFilledForm(form) {
    if (!Ext.isEmpty(form)) {
        var collections = form.getFields();
        var count = collections.getCount();
        for (var i = 0; i < count; i++) {
            var field = collections.getAt(i);
            if (!field.hidden) {
                if (!Ext.isEmpty(field.getValue()) && field.getValue() != "") {
                    return false;
                }
            }
        }
        return true;
    }
    return false;
}

/**
 * Method to perform required field validation
 * @param form {Object}
 * @returns {Boolean}
 */

function isMandatoryFilledForm(form) {
    if (!Ext.isEmpty(form)) {
        var collections = form.getFields();
        var count = collections.getCount();
        for (var i = 0; i < count; i++) {
            var field = collections.getAt(i);
            if (!field.hidden && !field.allowBlank) {
                if (!Ext.isEmpty(field.getValue()) && field.getValue() != "") {
                    return false;
                }
            }
        }
        return true;
    }
    return false;
}

function hasEntry(form) {
    if (!Ext.isEmpty(form)) {
        var collections = form.getFields();
        var count = collections.getCount();
        for (var i = 0; i < count; i++) {
            var field = collections.getAt(i);
            if (!field.hidden) {
                if (!Ext.isEmpty(field.getValue()) && field.getValue() != "") {
                    return true;
                }
            }
        }
        return false;
    }
}

/**
 * Method to perform extjs validation in npimetadata
 * @param none
 * @returns {Boolean}
 */

function validateNpiForm(form) {
    if (!Ext.isEmpty(form)) {
    	Ext.getCmp("JurisdictionJurisdictionName").isValid();
        var isFilled = hasEntry(form);
        if (isFilled) {
            if (!form.isValid()) {
                return false;
            }
        }
        if(!form.isValid() && Ext.getCmp("JurisdictionJurisdictionName").isValid()) {
        	return false;
        }
    }
    return true;
}

function setTreePath(formPanel) {
    var form = aForms[0]; // Global variable
    var entityType = form.findField('EntityType').getValue();
    var parentPath = '';
    var itemName = '';
    var itemPath = '';
    var pathField = '';
    if (entityType === 'InformationArchitecture') {
        var pIaNameField = form.findField('InformationArchitectureParentIAName');
        var iANameField = form.findField('InformationArchitectureIaName');
        itemName = iANameField.getValue();
        pathField = form.findField('InformationArchitectureIaPath');
        /*
         * var record =
         * pIaNameField.store.findRecord("IaName",pIaNameField.getValue());
         * if(!Ext.isEmpty(record)){ parentPath = record.data.IaPath; }
         */
        if (treePanelParentPath != "") {
            parentPath = treePanelParentPath;
        }

    }
    if (entityType === 'GoiDirCat') {
        var pIaNameField = form.findField('GoiDirCatParentGoiDirCatName');
        var iANameField = form.findField('GoiDirCatGoiDirCatName');
        itemName = iANameField.getValue();
        pathField = form.findField('GoiDirCatGoiDirCatPath');
        /*
         * var record =
         * pIaNameField.store.findRecord("GoiDirCatName",pIaNameField.getValue());
         * if(!Ext.isEmpty(record)){ parentPath = record.data.GoiDirCatPath; }
         */
        if (treePanelParentPath != "") {
            parentPath = treePanelParentPath;
        }
    }
    if (!Ext.isEmpty(parentPath)) {
        itemPath += parentPath;
    }
    if (!Ext.isEmpty(itemName)) {
        itemPath += "/" + itemName;
    }
    pathField.setValue(itemPath);
}

var domainEntitiesObject;

/**
 * Method to load 
 * @param treestore
 * @param egroup
 */

function loadDomainEntities(treestore, egroup) {
    if (!Ext.isEmpty(egroup)) {
        if (Ext.isEmpty(domainEntitiesObject)) {
            Ext.Ajax.request({
                async: false,
                // timeout:20,
                // url : dataservicesPath +
                // '/search?q=&entitytype=workflow&format=json&workflowname='
                // + wfName,
                //url: apacheNcmsData + '/DomainEntity.json',
                url: domainSpecificMasterDataUrl + '/DomainEntity.json',
                success: function (resp, req) {
                    collectionsObj = Ext.JSON.decode(resp.responseText);
                    domainEntitiesObject = collectionsObj.Collections.DomainEntity;
                    getAllowedEntitesTreeStore(treestore, egroup);
                },
                failure: function () {
                    Ext.DropDownAlert.msg("<div class = 'errorHeaderMsg'>Loading domain entities failed</div>", "<div class = 'errorMsg'>Unable to load allowed entities list</div>");
                }
            });

        } else {
            getAllowedEntitesTreeStore(treestore, egroup);
        }
    }
}


function loadDomainEntities1(treestore, egroup) {
    if (!Ext.isEmpty(egroup)) {
        if (Ext.isEmpty(domainEntitiesObject)) {
	  
	  var dsQuery = dataservicesPath +'/search?q=&format=extjson&entitytype=DomainEntity';
	  var domainEntities = getCookie("domainentities").split(",");
	  for (var i = 0; i < domainEntities.length; i++) {
	    dsQuery += "&EntityName=" + domainEntities[i]; 
	  }
	  dsQuery += "&cond=OR"
            Ext.Ajax.request({
                async: false,
                // timeout:20,
		url:dsQuery,
               // url : dataservicesPath +'/search?q=&format=extjson&entitytype=DomainEntity&EntityName=Crawleddata&EntityName=Article&cond=or'
                // + wfName,
                //url: apacheNcmsData + '/DomainEntity.json',
                success: function (resp, req) {
                    collectionsObj = Ext.JSON.decode(resp.responseText);
                    domainEntitiesObject = collectionsObj.Collections.DomainEntity;
                    getAllowedEntitesTreeStore(treestore, egroup);
                },
                failure: function () {
                    Ext.DropDownAlert.msg("<div class = 'errorHeaderMsg'>Loading domain entities failed</div>", "<div class = 'errorMsg'>Unable to load allowed entities list</div>");
                }
            });

        } else {
            getAllowedEntitesTreeStore(treestore, egroup);
        }
    }
}

function getAllowedEntitesTreeStore(treestore, egroup) {
    var domainEntities = getCookie("domainentities").split(",");
    var node = treestore.getRootNode();
    if (!Ext.isEmpty(domainEntitiesObject)) {
        for (var i = 0; i < domainEntitiesObject.length; i++) {
            if (Ext.Array.contains(domainEntities, domainEntitiesObject[i].EntityName) && egroup == domainEntitiesObject[i].EntityGroup) {
                node.appendChild({
                    "text": domainEntitiesObject[i].EntityName,
                    "idName": domainEntitiesObject[i].EntityName,
                    "leaf": true
                });
            }
        }
    } else {
        Ext.DropDownAlert.msg("<div class = 'errorHeaderMsg'>Loading domain entities failed</div>", "<div class = 'errorMsg'>Data not available</div>");
    }
    treestore.setRootNode(node);
}

/**
 * Method to perform delete action 
 * @param grid {Ext.grid.panel}
 * @param rowIndex {Integer}
 * @param colIndex {Integer}
 */

function globalDelete(grid, rowIndex, colIndex) {
    var rec = grid.getStore().getAt(rowIndex);
    var wfAssociated = false;
    Ext.Msg.confirm('Delete', 'Are you sure you want to delete?', function (btn) {
        if (btn == 'Yes' || btn == 'yes') {

            var statusSubQry = '?';
            if (!Ext.isEmpty(rec.data.Status)) {
                statusSubQry += "&Status=" + rec.data.Status;
            }
            if (!Ext.isEmpty(rec.data.CreatedBy)) {
                statusSubQry += "&CreatedBy=" + rec.data.CreatedBy;
            }
	    var dataservicesUrl;
	    if(rec.data.EntityType == "Workflow"){
		dataservicesUrl = dataservicesPath + '/search?q=&format=extjson&workflowid=' + rec.data.Id
	    }
	    else if(rec.data.EntityType == "InformationArchitecture"){
		dataservicesUrl = dataservicesPath + '/search?q=&format=extjson&AssociatedIAPath=' + rec.data.IaPath;
	    }
            if (rec.data.EntityType == "Workflow" || rec.data.EntityType == "InformationArchitecture") {
                Ext.Ajax.request({
                    method: 'GET',
                    url: dataservicesUrl,
                    success: function (response, opts) {
                        var resp = Ext.JSON.decode(response.responseText);
                        if (resp.Collections.Count > 0) {
                            Ext.DropDownAlert.msg("<div class = 'errorHeaderMsg'>Deletion Failed</div>", "<div class = 'errorMsg'>" + "Association found for the Item" + "</div>");
                            return false;
                        }
                        if (resp.Collections.Count == 0) {
                            if (allowDeleteAction(rec)) {
                                grid.getEl().mask();
                                Ext.Ajax.request({
                                    url: dataservicesPath + '/' + rec.data.EntityType + '/' + rec.data.Id + statusSubQry,
                                    success: function () {
                                        grid.getEl().unmask();
                                        Ext.DropDownAlert.msg("<div class = 'successHeaderMsg'>Deletion Success</div>", "<div class = 'successMsg'>Deleted Successfully</div>");
                                        grid.store.load();
                                    },
                                    failure: function () {
                                        grid.getEl().unmask();
                                        Ext.DropDownAlert.msg("<div class = 'errorHeaderMsg'>Request Failed</div>", "<div class = 'errorMsg'>Deletion Failed</div>");
                                    },
                                    method: 'Delete'
                                });
                            } else {
                                Ext.DropDownAlert.msg("<div class = 'errorHeaderMsg'>Access Denied</div>", "<div class = 'errorMsg'>You are not autherized to delete this resource</div>");
                            }
                            grid.getEl().unmask();
                        }
                    },
                    failure: function (response, opts) {}
                });
            } else {
                if (allowDeleteAction(rec)) {
                    grid.getEl().mask();
                    Ext.Ajax.request({
                        url: dataservicesPath + '/' + rec.data.EntityType + '/' + rec.data.Id + statusSubQry,
                        success: function () {
                            grid.getEl().unmask();
                            Ext.DropDownAlert.msg("<div class = 'successHeaderMsg'>Deletion Success</div>", "<div class = 'successMsg'>Deleted Successfully</div>");
                            grid.store.load();
                        },
                        failure: function () {
                            grid.getEl().unmask();
                            Ext.DropDownAlert.msg("<div class = 'errorHeaderMsg'>Request Failed</div>", "<div class = 'errorMsg'>Deletion Failed</div>");
                        },
                        method: 'Delete'
                    });
                } else {
                    Ext.DropDownAlert.msg("<div class = 'errorHeaderMsg'>Access Denied</div>", "<div class = 'errorMsg'>You are not autherized to delete this resource</div>");
                }
                grid.getEl().unmask();
            }
        }
    }, this);

}

/**
 * This Method allow deletion only if the user a provision to delete     
 * @param record
 * @returns {Boolean}
 */

function allowDeleteAction(record) {
    var dataCreatedBy = record.data.CreatedBy.toLowerCase();
    var dataStatus = record.data.Status.toLowerCase();
    // var dataAssigned = record.data.User.toLowerCase();
    if (isSuperAdmin()) {
        return true;
    }
    if ((publisherRoleName.toLowerCase() == userRole.toLowerCase() && dataStatus == "published") || (userRole.toLowerCase() == publisherRoleName.toLowerCase())) { // &&																							// cmsUserName.toLowerCase())){
        return true;
    }
    if (dataCreatedBy == cmsUserName.toLowerCase()) {
        return true;
    }
    return false;
}

/**
 * Method to return proper acl query
 * @param entity {String}
 * @returns {String}
 */

function getWorkflowEntityQuery(entity) {
    var subQuery = "";
    if (Ext.Array.contains(workflowEntities, entity)) {
        subQuery = dataservicesPath + '/search?q=&entitytype=' + entity + '&status=published&format=extjson';
    } else {
    	if(accessMasterDataDomain && Ext.Array.contains(masterDataDomainEntities, entity)) {
    		subQuery = masterDataDSUrl+ '/' + entity + '/search?q=&format=extjson';
    	}
    	else {
    		subQuery = dataservicesPath + '/search?q=&entitytype=' + entity + '&format=extjson';
    	}
    }
    return subQuery;
}

function getSubQuery(entity) {
    var aclSubQuery1;
    if ((Ext.Array.contains(masterEntities, entity) && Ext.Array.contains(Ext.WorkflowEntities, entity)) || isSuperAdmin()) {
        aclSubQuery1 = "&entitytype=" + entity;
    } else if (entity == 'CmsUserProfile') {
        aclSubQuery1 = "&entitytype=" + entity + "&username=" + cmsUserName;
    } else {
        aclSubQuery1 = "&entitytype=" + entity + "&createdby=" + cmsUserName;
    }
    return aclSubQuery1;
}

function getFilterBySubQuery(entity) {
    var aclSubQuery1;
    if (Ext.Array.contains(masterEntities, entity) || isSuperAdmin()) {
        aclSubQuery1 = "";
    } else {
        aclSubQuery1 = "&createdby=" + cmsUserName;
    }
    return aclSubQuery1;
}

/**
 * Method to save npimetadata and display backend and ui validation response 
 * @param saveEntityName {String}
 * @param form {Object}
 * @param action {String}
 * @param errorpanel {Ext.panel.panel}
 * @param rightPanelGrid {Ext.grid.panel}
 * @param formWindow {Object}
 */

function npiMetaDataSave(saveEntityName, form, action, errorpanel, rightPanelGrid, formWindow) {
    var actionObj = Ext.JSON.decode(action.response.responseText);
    aForms[0].findField('Id').setValue(action.result.msg.Id);
    //aForms[1].findField('ContentId').setValue(action.result.msg.Id);
    aForms[1].findField('ContentEntityType').setValue(saveEntityName);
    aForms[1].findField('EntityType').setValue("NpiMetadata");
    if (!Ext.isEmpty(action.result.msg.SeoUrl)) {
        aForms[1].findField('Identifier').setValue(action.result.msg.SeoUrl);
    }
    var npiTitleMain = aForms[1].findField('TitleMain').getValue();
    //var npiContentId  = aForms[1].findField('ContentId').getValue();
    var npiIdentifier = aForms[1].findField('Identifier').getValue();
    aForms[1].submit({
        method: 'POST',
        url: dataservicesPath + '/npimetadata',
        method: "POST",
        success: function (form, action) {
            var actionObj = Ext.JSON.decode(action.response.responseText);
            if (actionObj.success == "false") {
                Ext.MessageBox.hide();
                errorpanel.expand(false);
                if (!Ext.isEmpty(actionObj.msg.ValidationError)) {
                    var erroMsg = "<font color=green>Tab1 Form Saved.</font><br>";
                    erroMsg += "<font color=blue>Tab2 Form Has Errors.</font><br>";
                    erroMsg += actionObj.msg.ValidationError;
                    errorpanel.update("<div class = 'errorHeaderMsg'>" + erroMsg + "</div>");
                } else {
                    if (aForms[0] && aForms[0].findField('FilePath')) {
                        aForms[0].findField('FilePath').setValue('');
                    }
                    if (actionObj.msg) {
                        var erroMsg = "<font color=green>Tab1 Form Saved.</font><br>";
                        erroMsg += "<font color=blue>Tab2 Form Has Errors.</font><br>";
                        erroMsg += getCustomErrorInfo(Ext.JSON.encode(actionObj.msg));
                        errorpanel.update("<div class = 'errorHeaderMsg'>" + erroMsg + "</div>");
                    } else {
                        errorpanel.update("<div class = 'errorHeaderMsg'>" + getCustomErrorInfo(action.response.responseText) + "</div>");
                    }
                }
                return false;
            } else if (actionObj.success == "true") {
                Ext.DropDownAlert.msg("<div class = 'successHeaderMsg'>Success!</div>", "<div class = 'successMsg'>Saved Successfully.</div>");
                formWindow.close();
                rightPanelGrid.store.load();
            }
        },
        failure: function (form, action) {
            Ext.MessageBox.hide();
            cmsErrorpanel.expand(false);
            if (action.response.responseText != '') {
                var actionString = action.response.responseText;
                var actionObj = Ext.JSON.decode(actionString);
                if (typeof (actionObj.msg) != "undefined") {
                    cmsErrorpanel.update("<div class = 'errorHeaderMsg'>" + actionObj.msg + "</div>");
                } else {
                    cmsErrorpanel.update("<div class = 'errorHeaderMsg'>" + getCustomErrorInfo(action.response.responseText) + "</div>");
                }
            } else {
                cmsErrorpanel.update("<div class = 'errorHeaderMsg'>Request Timedout Or No Response From Server </div>");
            }

        },
        waitMsg: 'Saving Npi MetaData In Progress. Please Wait ...'
    });
}

/**
 * Method to find and reset a password field in a form  
 */

function resetPassword() {
    var form = aForms[0];
    if (Ext.getCmp("CmsUserProfilePassword") && !Ext.isEmpty(Ext.getCmp("CmsUserProfilePassword").getValue())) {
        Ext.getCmp("CmsUserProfilePassword").setValue('');
    }
}

/**
 * Method to perform reset/change password action in a form and also performs validation    
 * @returns {Boolean}
 */
 
function checkUserProfile() {
    var form = aForms[5];
    var password;
    var oldPassword; 
    var reTypePassword; 
    reTypePassword = Ext.getCmp("CmsUserProfileRetypePassword").getValue();
    password       = Ext.getCmp("CmsUserProfileChangePassword").getValue();
    oldPassword    = Ext.getCmp("CmsUserProfileOldPassword").getValue(); 
    if(!Ext.isEmpty(password) && !Ext.getCmp("CmsUserProfileChangePassword").isValid()){
       Ext.DropDownAlert.msg("<div class = 'errorHeaderMsg'>Validation Error!</div>", "<div class = 'errorMsg'>Password policy doesn't satisfy</div>");
       return false
    }
    if (!Ext.isEmpty(password) || !Ext.isEmpty(reTypePassword) || !Ext.isEmpty(oldPassword)) {
	  if (!Ext.isEmpty(password) && !Ext.isEmpty(reTypePassword)) {
              if (password != reTypePassword) {
		Ext.DropDownAlert.msg("<div class = 'errorHeaderMsg'>Validation Error!</div>", "<div class = 'errorMsg'>Password and retype password should match</div>");
		return false;
	      }
	      if (Ext.getCmp("CmsUserProfileOldPassword").isVisible()){   
		  if(Ext.isEmpty(oldPassword) && !Ext.getCmp("CmsUserProfileOldPassword").isValid()){  
		      Ext.DropDownAlert.msg("<div class = 'errorHeaderMsg'>Validation Error!</div>", "<div class = 'errorMsg'>Should fill all the fields</div>");
		      return false;
		  }
		  else if(password == oldPassword){
		      Ext.DropDownAlert.msg("<div class = 'errorHeaderMsg'>Validation Error!</div>", "<div class = 'errorMsg'>Old password and password should not be same</div>");
		      return false;
		  }
	      }
	      return true;
	  } else {  
	      Ext.DropDownAlert.msg("<div class = 'errorHeaderMsg'>Validation Error!</div>", "<div class = 'errorMsg'>Should fill all the fields</div>");
	      return false;
	  }
    }
    return true;
}

/**
 * Method to perform save action for most entities and also display backend and ui validation response 
 * @param saveEntityName {String}
 * @param record {Object}
 * @param action {String}
 * @param errorpanel {Ext.panel.panel}
 * @param rightPanelGrid {Ext.grid.panel}
 * @param formWindow {Object}
 */

function saveEntity(rightPanelGrid, formWindow, saveEntityName, formAction, errorpanel, record) {
    npiMetaData = '';
    if(saveEntityName == 'CmsUserProfile'){
	if (formAction=='edit'){
	    if (!checkUserProfile())
	      return false;
        }
        aForms[0].isValid();
	if(formAction == 'new' && !Ext.getCmp("CmsUserProfilePassword").isValid()){
	  Ext.DropDownAlert.msg("<div class = 'errorHeaderMsg'>Validation Error!</div>", "<div class = 'errorMsg'>Required field missing OR Invalid data</div>");
	  return false;
	}
    }
    /*if (!validateForm() || !validateNpiForm()) {
        Ext.DropDownAlert.msg("<div class = 'errorHeaderMsg'>Validation Error!</div>", "<div class = 'errorMsg'>Required field missing OR Invalid data</div>");
        return false;
    }*/
    if (!validateForm(saveEntityName)) {
        Ext.DropDownAlert.msg("<div class = 'errorHeaderMsg'>Validation Error!</div>", "<div class = 'errorMsg'>Required field missing OR Invalid data</div>");
        return false;
    }
    var filePath;
    if(aForms[0].findField('FilePath')){
        filePath = aForms[0].findField('FilePath').getValue();
    }
    aForms[0].submit({
        url: dataservicesPath + '/' + saveEntityName.toLowerCase()+"?format=extjson",
        method: "POST",
        // timeout: 30,
        params: getFinalFormParams(saveEntityName, formAction, false, record),
        success: function (form, action) {
            var actionObj = Ext.JSON.decode(action.response.responseText);
            allFormsSaved = false;
            if (actionObj.success == "false") {
                resetPassword();
                Ext.MessageBox.hide();
                errorpanel.expand(false);
                if (!Ext.isEmpty(actionObj.msg.ValidationError)) {
				  if(formAction=='edit' && aForms[0].findField('FilePath')){
				     aForms[0].findField('FilePath').setRawValue(filePath);
				  }
                  errorpanel.update("<div class = 'errorHeaderMsg'>" + actionObj.msg.ValidationError + "</div>");
                } else {
                    if (aForms[0] && aForms[0].findField('FilePath')) {
                        aForms[0].findField('FilePath').setValue('');
                    }
                    if (actionObj.msg) {
                        errorpanel.update("<div class = 'errorHeaderMsg'>" + getCustomErrorInfo(Ext.JSON.encode(actionObj.msg)) + "</div>");
                    } else {
                        errorpanel.update("<div class = 'errorHeaderMsg'>" + getCustomErrorInfo(action.response.responseText) + "</div>");
                    }
                }
                return false;
            }
            /*
             * if(!Ext.isEmpty(aForms[1]) && isFilledForm(aForms[1])){
             * npiMetaDataSave(saveEntityName,form,
             * action,errorpanel,rightPanelGrid,formWindow); } else
             */
            if (actionObj.success == "true") {
                if (formAction == "edit") Ext.DropDownAlert.msg("<div class = 'successHeaderMsg'>Success!</div>", "<div class = 'successMsg'>Updated Successfully.</div>");
                else Ext.DropDownAlert.msg("<div class = 'successHeaderMsg'>Success!</div>", "<div class = 'successMsg'>Saved Successfully.</div>");
                formWindow.close();
                rightPanelGrid.store.load();
            }
        },
        failure: function (form, action) {
            resetPassword();
            var actionString = action.response.responseText;
            Ext.MessageBox.hide();
            if (!Ext.isEmpty(actionString)) {
                errorpanel.expand(false);
                var actionObj = Ext.JSON.decode(actionString);
                if (!Ext.isEmpty(actionObj.msg)) {
                    errorpanel.update("<div class = 'errorHeaderMsg'>" + getCustomErrorInfo(Ext.JSON.encode(actionObj.msg)) + "</div>");
                } else {
                    errorpanel.update("<div class = 'errorHeaderMsg'>" + action.response.responseText + "</div>");
                }
            }
        },
        scope: Ext.JSON.decode(saveEntityName + "Form"),
        waitMsg: 'Saving Data In Progress. Please Wait ...'
    });
}

function showTreePanelWindow(element, entity, IdFieldName, type) {
    var selectedItemName = '';
    var selectedItemPath = '';
    Ext.define('TreeModel', {
        extend: 'Ext.data.Model',
        fields: [{
            name: 'treeitem',
            type: 'string'
        }, {
            name: 'text',
            type: 'string'
        }]
    });

    var treeUrl = "";
    if(entity == "InformationArchitecture"){
        treeUrl = domainSpecificMasterDataUrl;
    }
    else{
        treeUrl = apacheNcmsData;
    }

    var treeStore = Ext.create('Ext.data.TreeStore', {
        model: 'TreeModel',
        autoLoad: false,
        proxy: {
            type: 'ajax',
            //url: apacheNcmsData + '/' + entity + 'Tree.json'
            url: treeUrl + '/' + entity + 'Tree.json'
        },
        folderSort: true
    });



    var treePanel = Ext.create('Ext.tree.Panel', {
        expanded: true,
        padding: 1,
        width: 498,
        height: 320,
        useArrows: true,
        rootVisible: false,
        store: treeStore,
        autoScroll: true,
        hideHeaders: true,
        // singleExpand: false,
        containerScroll: true,
        border: false,
        animate: true,
        frame: false,
        stripeRows: false,
        forceFit: true,
        selType: 'cellmodel',
        columns: [{
            xtype: 'treecolumn',
            text: 'Item',
            sortable: false,
            dataIndex: 'treeitem'
        }]
    });

    treePanel.on('itemclick', function (view, record, htmlelement, index, e) {
        if (entity != record.data.treeitem) {
            selectedItemName = (entity == "InformationArchitecture" && type == "parentchild") ? record.data.treeitem : record.data.id;
            selectedItemPath = (entity == "InformationArchitecture" || entity == "GoiDirCat") ? record.data.id : '';
            if (type == "parentchild") {
                selectedParentId = record.data.text;
            }
        }
    }, this);


    var mainPanel = Ext.create('Ext.panel.Panel', {
        // region:'east',
        // autoScroll:true,
        // scroll:true,
        width: 500,
        height: 325,
        border: false,
        items: [treePanel]
    });


    var treeWindow = new Ext.Window({
        // closeAction : 'hide',
        // autoScroll : true,
        modal: true,
        // layout: 'border',
        width: 510,
        height: 410,
        items: [mainPanel],
        // [ formItem,cmsErrorpanel ],
        //items : [{title:"HI",html:"Dont waste time"}],
        buttons: [{
            text: 'Clear',
            id: 'tree-clear',
            handler: function () {
                element.setValue('');
                if ((entity == "InformationArchitecture" && type != "associatedia") || entity == "GoiDirCat") {
                    treePanelParentPath = '';
                    setTreePath();
                }
                if (type == "parentchild") {
                    var pId = Ext.getCmp(entity + IdFieldName);
                    pId.setValue("");
                }
                treeWindow.close();
            }
        }, {
            text: 'Ok',
            id: 'tree-ok',
            handler: function () {
                element.setValue(selectedItemName);
                if ((entity == "InformationArchitecture" && type != "associatedia") || entity == "GoiDirCat") {
                    treePanelParentPath = selectedItemPath;
                    setTreePath();
                }
                if (type == "parentchild") {
                    var pId = Ext.getCmp(entity + IdFieldName);
                    pId.setValue(selectedParentId);
                }
                treeWindow.close();
            }
        }, {
            text: 'Cancel',
            id: 'tree-cancel',
            handler: function () {
                if (type == "parentchild") {
                    var pId = Ext.getCmp(entity + IdFieldName);
                    pId.setValue("");
                }
                treeWindow.close();
            }
        }]
    });

    treeStore.on('load', function () {
        treePanel.selectPath(element.getValue());
    }, this);

    treeWindow.show();
}

/**
 * Method to show/perform advanced search option for all entities and also display backend/ui response  
 * @param currentPanel {Ext.grid.panel}
 * @param rightPanel {Ext.grid.panel}
 * @param cEntity {String}
 */

function globalAdvancedSeacrh(currentPanel, rightPanel, cEntity) {

    clearSearchBox(rightPanel.searchText);
    currentPanel.xmlFields = Ext.create('Ext.data.ArrayStore', {
        fields: [cEntity + "Fields"],
        data: Ext.JSON.decode("Ext." + cEntity + "Fields")
    });

    currentPanel.comfields = Ext.create('Ext.data.Store', {
        fields: ['value', 'name'],
        data: arrayCombineFields
    });
    currentPanel.combineFields = Ext.create('Ext.form.ComboBox', {
        name: 'advancedSearchCombineField',
        xtype: "combobox",
        store: currentPanel.comfields,
        displayField: 'name',
        editable: false,
        valueField: 'value',
        width: 60,
        queryMode: 'local'
    });
    currentPanel.combineFields.on('render', function (combo1) {
        currentPanel.combineFields.setValue('AND');
        currentPanel.combineFields.queryMode = 'local';
    }, currentPanel, {
        single: true
    });
    currentPanel.combineFields.hide();
    currentPanel.equalfieldsStore = Ext.create('Ext.data.Store', {
        fields: ['value', 'name'],
        data: arrayEqualFields
    });
    currentPanel.equalFields = Ext.create('Ext.form.ComboBox', {
        name: 'advancedSearchEqualField',
        store: currentPanel.equalfieldsStore,
        displayField: 'name',
        queryMode: "local",
        editable: false,
        valueField: 'name',
        width: 75,
        multiple: false
    });
    currentPanel.equalFields.on('render', function (combo1) {
        currentPanel.equalFields.setValue('=');
        currentPanel.equalFields.queryMode = 'local';
    }, currentPanel, {
        single: true
    });

    currentPanel.searchFields = Ext.create('Ext.form.ComboBox', {
        name: 'advancedSearchSearchFields',
        store: currentPanel.xmlFields,
        xtype: "combobox",
        queryMode: "local",
	typeAhead : true,
	minChars:1,
	// forceSelection: true,
	triggerAction: 'all',
        displayField: cEntity + "Fields",
        emptyText: "Select field",
        multiple: false,
	listeners:{
	    expand : function(field, eOpts){
	      field.queryMode = "local";
	    },
	    keypress : function(combo, e, eOpts){
	      if((e.getKey() >= 65 && e.getKey() <= 90) 
		|| (e.getKey() >= 97 && e.getKey() <= 122)
		|| (e.getKey() == Ext.EventObject.ENTER)
		|| (e.getKey() == Ext.EventObject.BACKSPACE)
		) {
		combo.collapse();
		if(Ext.isEmpty(combo.getValue())){
		  combo.forceSelection=true;
		  combo.store.clearFilter(true);
		  combo.store.load();
		  combo.expand();
		}
	      }
	    },
	    focus : function(combo){
		combo.forceSelection=true;
		combo.store.clearFilter(true);
		combo.store.load();
	    },
	    render: function (combo, options) {
                combo.store.sort(cEntity + 'Fields', 'ASC');
            }
	},
        allowBlank: false
    });

    currentPanel.fromSearchDateTxt = Ext.create('Ext.form.field.Date', {
        fieldLabel: '',
        name: 'fromDate',
        xtype: 'datefield',
        editable: false,
        allowBlank: false,
        anchor: '18',
        width: 80,
        format: 'm/d/y',
        dateConfig: {
            altFormats: 'Y-m-d|Y-n-d',
            readOnly: false
        }
    });

    currentPanel.fromSearchTimeTxt = Ext.create('Ext.form.field.Time', {
        xtype: 'timefield',
        name: 'time_in',
        editable: false,
        allowBlank: false,
        fieldLabel: '',
        width: 60,
        format: 'H:i',
        timeConfig: {
            altFormats: 'H:i',
            readOnly: false
        }
    });

    currentPanel.fromSearchDateTxt.hide();
    currentPanel.fromSearchTimeTxt.hide();

    currentPanel.toSearchDateTxt = Ext.create('Ext.form.field.Date', {
        name: 'toDate',
        fieldLabel: '',
        editable: false,
        allowBlank: false,
        xtype: 'datefield',
        anchor: '18',
        width: 80,
        format: 'm/d/y',
        dateConfig: {
            altFormats: 'Y-m-d|Y-n-d',
            readOnly: false
        }
    });

    currentPanel.toSearchTimeTxt = Ext.create('Ext.form.field.Time', {
        xtype: 'timefield',
        name: 'time_out',
        editable: false,
        allowBlank: false,
        fieldLabel: '',
        width: 60,
        format: 'H:i',
        timeConfig: {
            altFormats: 'H:i',
            readOnly: false
        }
    });

    currentPanel.toSearchDateTxt.hide();
    currentPanel.toSearchTimeTxt.hide();
    currentPanel.queryTxt = Ext.create('Ext.form.field.Text', {
        width: 200,
        emptyText: 'Enter Search term',
        maxLength: 100,
        scope: this,
        enforceMaxLength: true,
        vtype: 'alphanumSearch',
        listeners: {
            focus: function (tbx) {
                tbx.setValue("");
            },
            blur: function (tbx) {
                var str = trim(tbx.getValue());
                str = str.replace(/ +(?= )/g, '');
                tbx.setValue(str);
            }
        }
    });
    currentPanel.queryContent = Ext.create('Ext.form.field.TextArea', {
        width: 738,
        height: 250,
        readOnly: true,
        anchor: '100%'
    });
    currentPanel.andBtn = Ext.create('Ext.Button', {
        text: "ADD",
        iconCls: 'icon-plus'
    });

    currentPanel.queryBuilder = Ext.create('Ext.window.Window', {
        width: 749,
        title: "Advanced Search - Query Builder",
        tbar: ["<b>Search</b>", "-", currentPanel.combineFields, "-", currentPanel.searchFields, "-", currentPanel.equalFields, "-", currentPanel.queryTxt, currentPanel.fromSearchDateTxt, currentPanel.fromSearchTimeTxt, "--", currentPanel.toSearchDateTxt, currentPanel.toSearchTimeTxt, currentPanel.andBtn],
        height: 340,
        modal: true,
        scope: currentPanel,
        closeAction: 'hide',
        items: currentPanel.queryContent,
        bbar: [{
            text: 'Search',
            scope: currentPanel,
            id: 'cms-advsearch-button',
            disabled: true,
            iconCls: 'icon-search',
            handler: function () {
                if (currentPanel.queryContent.getValue()) {
                    rightPanel.grid.store.currentPage = 1;
                    rightPanel.grid.store.proxy.url = dataservicesPath + '/' + cEntity.toLowerCase() + '/search?q=&format=extjson&' + currentPanel.queryContent.getValue() + getSubQuery(cEntity);
                    rightPanel.grid.store.proxy.setReader({
                        type: 'json',
                        root: 'Collections.' + cEntity,
                        totalProperty: 'Collections.Count'
                    });
                    rightPanel.grid.store.load();
                } else {
                    Ext.DropDownAlert.msg("<div class = 'errorHeaderMsg'>Search Term Missing</div>", "<div class = 'errorMsg'>Enter Keywords to Search</div>");
                }
            }
        }, {
            text: 'Reset',
            scope: currentPanel,
            iconCls: 'icon-reset',
            handler: function () {
                Ext.getCmp('cms-advsearch-button').disable(true);
                currentPanel.queryContent.reset();
                currentPanel.queryTxt.reset();
                currentPanel.fromSearchDateTxt.reset();
                currentPanel.fromSearchTimeTxt.reset();
                currentPanel.toSearchDateTxt.reset();
                currentPanel.toSearchTimeTxt.reset();
                currentPanel.queryValue = "";
                currentPanel.combineFields.hide();
            }
        }, {
            text: 'Close',
            scope: currentPanel,
            iconCls: 'icon-close',
            handler: function () {
                currentPanel.queryBuilder.hide();
                currentPanel.queryValue = "";
                currentPanel.combineFields.hide();
                currentPanel.advancedSearchFlag = false;
                currentPanel.queryContent.reset();
                currentPanel.queryTxt.reset();
                currentPanel.fromSearchDateTxt.reset();
                currentPanel.fromSearchTimeTxt.reset();
                currentPanel.toSearchDateTxt.reset();
                currentPanel.toSearchTimeTxt.reset();
            }
        }]
    });
    currentPanel.queryBuilder.on('beforeclose', function () {
        Ext.getCmp('cms-advsearch-button').disable(true);
        currentPanel.queryBuilder.hide();
        currentPanel.queryValue = "";
        currentPanel.combineFields.hide();
        currentPanel.advancedSearchFlag = false;
        currentPanel.queryContent.reset();
        currentPanel.queryTxt.reset();
        currentPanel.fromSearchDateTxt.reset();
        currentPanel.fromSearchTimeTxt.reset();
        currentPanel.toSearchDateTxt.reset();
        currentPanel.toSearchTimeTxt.reset();
        return false;
    }, currentPanel);
    currentPanel.advancedSearchFlag = true;
    currentPanel.queryBuilder.show();
    var validData = false;
    var isoFromDate = "";
    var isoFromTime = "";
    var isoToDate = "";
    var isoToTime = "";
    currentPanel.queryValue = "";

    currentPanel.andBtn.on('click', function () {

        if (currentPanel.queryTxt.isValid()) {
            if (currentPanel.searchFields.getValue() == 'CreatedDate' || currentPanel.searchFields.getValue() == 'LastModifiedDate' || currentPanel.searchFields.getValue() == 'MetaDataCreatedDate') {
                if (currentPanel.fromSearchDateTxt.getValue()) isoFromDate = new Date(currentPanel.fromSearchDateTxt.getValue()).format('Y-m-d');
                if (currentPanel.fromSearchTimeTxt.getValue()) isoFromTime = new Date(currentPanel.fromSearchTimeTxt.getValue()).format('TH:i:sZ');
                if (currentPanel.toSearchDateTxt.getValue()) isoToDate = new Date(currentPanel.toSearchDateTxt.getValue()).format('Y-m-d');
                if (currentPanel.toSearchTimeTxt.getValue()) isoToTime = new Date(currentPanel.toSearchTimeTxt.getValue()).format('TH:i:sZ');

                if ((!currentPanel.fromSearchDateTxt.getValue()) || (!currentPanel.fromSearchTimeTxt.getValue()) || (!currentPanel.toSearchDateTxt.getValue()) || (!currentPanel.toSearchTimeTxt.getValue())) {
                    validData = false;
                    Ext.DropDownAlert.msg("<div class = 'errorHeaderMsg'>Search Term Missing</div>", "<div class = 'errorMsg'>Enter Date to Search</div>");
                } else { 
                    Ext.getCmp('cms-advsearch-button').enable(true);
                    validData = true;
                    if (currentPanel.queryValue) {
                        currentPanel.queryValue = currentPanel.queryValue + "&";
                    }
                    currentPanel.queryValue = currentPanel.queryValue + currentPanel.searchFields.getValue() + "=[" + isoFromDate + isoFromTime + " TO " + isoToDate + isoToTime + "]";
                }
            } else {
                if ((!currentPanel.searchFields.getValue()) || (!currentPanel.queryTxt.getValue())) {
                    validData = false;
                    Ext.DropDownAlert.msg("<div class = 'errorHeaderMsg'>Search Term Missing</div>", "<div class = 'errorMsg'>Enter Keywords to Search</div>");
                } else {
                    Ext.getCmp('cms-advsearch-button').enable(true);
                    validData = true;
                    assignval = currentPanel.equalFields.getValue();
                    if (currentPanel.queryTxt.getValue()) {
                        if (assignval == '!=') qval = "!" + currentPanel.searchFields.getValue() + "=" + (currentPanel.queryTxt.getValue()).replace(/[' ']/gim, "+");
                        else qval = currentPanel.searchFields.getValue() + "=" + (currentPanel.queryTxt.getValue()).replace(/[' ']/gim, "+");

                        if (currentPanel.queryValue == '') {
                            currentPanel.queryValue = qval;
                        } else {
                            currentPanel.queryValue = currentPanel.queryValue + "&" + qval;
                        }
                    }
                }
            }
            if (validData) {
                currentPanel.combineFields.show();
                currentPanel.queryParam = currentPanel.queryValue + "&cond=" + currentPanel.combineFields.value;
                currentPanel.queryContent.setValue(currentPanel.queryParam);
            }
        } else {
            Ext.DropDownAlert.msg("<div class = 'errorHeaderMsg'>Invalid Keyword</div>", "<div class = 'errorMsg'>Enter valid keyword</div>");
        }

    }, currentPanel);
    currentPanel.searchFields.on('change', function (field, newVal, oldVal) {
        if (newVal == 'CreatedDate' || newVal == 'LastModifiedDate' || newVal == 'MetaDataCreatedDate') {
            currentPanel.queryTxt.hide();
            currentPanel.fromSearchDateTxt.show();
            currentPanel.fromSearchTimeTxt.show();
            currentPanel.toSearchDateTxt.show();
            currentPanel.toSearchTimeTxt.show();
        } else {
            currentPanel.queryTxt.show();
            currentPanel.fromSearchDateTxt.hide();
            currentPanel.fromSearchTimeTxt.hide();
            currentPanel.toSearchDateTxt.hide();
            currentPanel.toSearchTimeTxt.hide();
        }
    }, currentPanel);

}

/**
 * Method to reset search text box value
 * @param searchBox {String}
 */

function clearSearchBox(searchBox) {
    searchBox.setValue('');
}

/**
 * Method to show/perform search option for all entities and also display backend/ui response
 * @param cElement
 * @param e
 * @param rightPanel
 * @param cEntity
 * @param Key
 */

function globalSearch(cElement, e, rightPanel, cEntity, Key) {
    var searchValue = rightPanel.searchText.getValue();
    if (e.getKey() == e.ENTER || Key == 'searchbutton') {
        if (searchValue) {
            if (!rightPanel.searchText.isValid()) {
                Ext.DropDownAlert.msg("<div class = 'errorHeaderMsg'>Invalid Keyword</div>", "<div class = 'errorMsg'>Enter valid keyword</div>");
            } else {
                rightPanel.grid.store.currentPage = 1;
                rightPanel.grid.store.proxy.url = dataservicesPath + '/search?format=extjson' + getSubQuery(cEntity) + '&q=' + searchValue;
                rightPanel.grid.store.proxy.setReader({
                    type: 'json',
                    root: 'Collections.' + cEntity,
                    totalProperty: 'Collections.Count'
                });
                rightPanel.grid.store.load();
            }
        } else {
            Ext.DropDownAlert.msg("<div class = 'errorHeaderMsg'>Search Term Missing</div>", "<div class = 'errorMsg'>Enter Keywords to Search</div>");
        }
    }
}

/**
 * Dependent Npimetadata form declaration 
 */

var DependentNpiMetadataForm = [{
    name: "Id",
    id: "NpiMetadataId",
    readOnly: true,
    enforceMaxLength: true,
    xtype: "textfield",
    fieldLabel: "Id",
    listeners: {
        blur: function () {
            var str = trim(this.getValue());
            str = str.replace(/ +(?= )/g, '');
            this.setValue(str);
        }
    },
    hidden: true,
    allowBlank: true

},

{
    name: "EntityType",
    id: "NpiMetadataEntityType",
    readOnly: true,
    enforceMaxLength: true,
    xtype: "textfield",
    fieldLabel: "Entity Type",
    listeners: {
        blur: function () {
            var str = trim(this.getValue());
            str = str.replace(/ +(?= )/g, '');
            this.setValue(str);
        }
    },
    hidden: true,
    value: "NpiMetadata",
    allowBlank: true

},

{
    name: "Identifier",
    id: "NpiMetadataIdentifier",
    maxLength: 250,
    enforceMaxLength: true,
    xtype: "textfield",
    fieldLabel: "Identifier <span style='color: rgb(255, 0, 0); padding-left: 2px;'>*</span>",
    listeners: {
        blur: function () {
            var str = trim(this.getValue());
            str = str.replace(/ +(?= )/g, '');
            this.setValue(str);
        }
    },
    vtype: "url",
    allowBlank: false

},

/*                                             {
     name :"ContentId",
           id:"NpiMetadataContentId",
                         minLength :13,
               maxLength :13,
          enforceMaxLength:true,
     xtype:"textfield",
     fieldLabel : "Content Id",
                               listeners:{
	    blur:function(){
	       var str = trim(this.getValue());
               str = str.replace(/ +(?= )/g,'');
	       this.setValue(str);
	    }
	},
                                                                                               allowBlank : true
              
},

                                             {
     name :"ContentEntityType",
           id:"NpiMetadataContentEntityType",
                              maxLength :50,
          enforceMaxLength:true,
     xtype : 'combobox',
      editable : false,
      store : Ext.create('Ext.data.ArrayStore', {
	      fields : [ "MasterEntity" ],
	      data : [['Article'],['Banner'],['Book'],['Form'],['Gallery'],['InformationArchitecture'],['Media'],['Scheme'],['Service']]
      }),
      displayField : "MasterEntity",
      valueField : "MasterEntity",
      emptyText : "",
     fieldLabel : "Content Entity Type",
                               listeners:{
	    blur:function(){
	       var str = trim(this.getValue());
               str = str.replace(/ +(?= )/g,'');
	       this.setValue(str);
	    }
	},
                                                                                               allowBlank : true
              
},*/

{
    name: "IdentifierAlternate",
    id: "NpiMetadataIdentifierAlternate",
    maxLength: 50,
    enforceMaxLength: true,
    xtype: "textfield",
    fieldLabel: "Identifier Alternate",
    listeners: {
        blur: function () {
            var str = trim(this.getValue());
            str = str.replace(/ +(?= )/g, '');
            this.setValue(str);
        }
    },
    vtype: "url",
    allowBlank: true

},

{
    name: "TitleMain",
    id: "NpiMetadataTitleMain",
    maxLength: 50,
    enforceMaxLength: true,
    xtype: "textfield",
    fieldLabel: "Title Main <span style='color: rgb(255, 0, 0); padding-left: 2px;'>*</span>",
    listeners: {
        blur: function () {
            var str = trim(this.getValue());
            str = str.replace(/ +(?= )/g, '');
            this.setValue(str);
        }
    },
    vtype: "alphanumMid",
    allowBlank: false
},

{
    name: "TitleAlternate",
    id: "NpiMetadataTitleAlternate",
    maxLength: 50,
    enforceMaxLength: true,
    xtype: "textfield",
    fieldLabel: "Title Alternate",
    listeners: {
        blur: function () {
            var str = trim(this.getValue());
            str = str.replace(/ +(?= )/g, '');
            this.setValue(str);
        }
    },
    vtype: "alphanumMid",
    allowBlank: true

},

{
    name: "Description",
    id: "NpiMetadataDescription",
    xtype: "htmleditor",
    maxLength: 4000,
    fieldLabel: "Description  <span style='color: rgb(255, 0, 0); padding-left: 2px;'>*</span>",
    height: 200,
    value: "",
    defaultValue: "",
    anchor: '100%',
    listeners: {
        blur: function () {
            var str = trim(this.getValue());
            str = str.replace(/ +(?= )/g, '');
            this.setValue(str);
        }
    },
    allowBlank: false

}, {
    name: "AssociatedIAPath",
    id: "NpiMetadataAssociatedIAPath",
    readOnly: true,
    fieldCls: 'readonly-background-class',
    xtype: "textarea",
    maxLength: 400,
    fieldLabel: "Associated IA Path  <span style='color: rgb(255, 0, 0); padding-left: 2px;'>*</span>",
    height: 40,
    value: "",
    defaultValue: "",
    anchor: '100%',
    listeners: {
        blur: function () {
            var str = trim(this.getValue());
            str = str.replace(/ +(?= )/g, '');
            this.setValue(str);
        },
        focus: function () {
            showTreePanelWindow(this, 'InformationArchitecture', '', 'associatedia');
        }
    },
    allowBlank: false

}, {
    name: "SubjectKeyword",
    id: "SubjectKeywordsSubjectKeyword",
    maxLength: 50,
    enforceMaxLength: true,
    xtype: "textfield",
    fieldLabel: "Subject Keyword <span style='color: rgb(255, 0, 0); padding-left: 2px;'>*</span>",
    listeners: {
        blur: function () {
            var str = trim(this.getValue());
            str = str.replace(/ +(?= )/g, '');
            this.setValue(str);
        }
    },
    vtype: "alphanumMid",
    allowBlank: false

},

{
    name: "Sector",
    id: "SubjectClassificationSector",
    fieldLabel: "Subject Classification <span style='color: rgb(255, 0, 0); padding-left: 2px;'>*</span>",
    xtype: "combobox",
    multiSelect: true,
    typeAhead : true,
    minChars:1,
  //  forceSelection: true,
    triggerAction: 'all',
    store: createStore('Sector', ''),
    queryMode: "local",
    displayField: "SectorName",
    valueField: "SectorName",
    emptyText: "",
    listeners: {
        beforerender: function (combo) {
            this.store.load();
        },
        render: function (combo) {
            this.store.sort('SectorName', 'ASC');
        },
	expand : function(field, eOpts){
		    field.queryMode = "local";
	},
	keypress : function(combo, e, eOpts){
	  if((e.getKey() >= 65 && e.getKey() <= 90) 
	    || (e.getKey() >= 97 && e.getKey() <= 122)
	    || (e.getKey() == Ext.EventObject.ENTER)
	    || (e.getKey() == Ext.EventObject.BACKSPACE)
	    ) {
	    combo.collapse();
	    if(Ext.isEmpty(combo.getValue())){
	      combo.forceSelection=true;
	      combo.store.clearFilter(true);
	      combo.store.load();
	      combo.expand();
	    }
	  }
	},
	focus : function(combo){
	    combo.forceSelection=true;
	    combo.store.clearFilter(true);
	    combo.store.load();
	} 
    },
    allowBlank: false

},

{
    name: "PublisherOrgName",
    id: "PublisherOrgNamesPublisherOrgName",
    fieldLabel: "PublisherOrg",
    xtype: "combobox",
    multiSelect: false,
    typeAhead : true,
    minChars:1,
 //   forceSelection: true,
    triggerAction: 'all',
    store: createQueryStore('GoiDirItem', 'Category="Organisations"'),
    width: 500,
    pageSize: 100,  
    queryMode: "remote",
    displayField: "GoiDirItemName",
    valueField: "GoiDirItemName",
    emptyText: "",
    listeners: {
        beforerender: function (combo) {
            this.store.load();
        },
        render: function (combo) {
            this.store.sort('GoiDirItemName', 'ASC');
        },
	expand : function(field, eOpts){
		    field.queryMode = "local";
	},
        keypress : function(combo, e, eOpts){
	  if((e.getKey() >= 65 && e.getKey() <= 90) 
	    || (e.getKey() >= 97 && e.getKey() <= 122)
	    || (e.getKey() == Ext.EventObject.ENTER)
	    || (e.getKey() == Ext.EventObject.BACKSPACE)
	    ) {
	    combo.collapse();
	    if(Ext.isEmpty(combo.getValue())){
	      combo.forceSelection=true;
	      combo.store.clearFilter(true);
	      combo.store.load();
	      combo.expand();
	    }
	  }
	},
	focus : function(combo){
	    combo.forceSelection=true;
	    combo.store.clearFilter(true);
	    combo.store.load();
	} 
    },
    allowBlank: true

},

{
    name: "PublisherDepartment",
    id: "PublisherDeptNamePublisherDepartment",
    fieldLabel: "PublisherDept <span style='color: rgb(255, 0, 0); padding-left: 2px;'>*</span>",
    xtype: "combobox",
    multiSelect: false,
    store: createQueryStore('GoiDirItem', 'Category="Departments"'),
    width: 500,
    pageSize: 100,
    typeAhead : true,
    minChars:1,
  //  forceSelection: true,
    triggerAction: 'all',
    queryMode: "remote",
    displayField: "GoiDirItemName",
    valueField: "GoiDirItemName",
    emptyText: "",
    listeners: {
        beforerender: function (combo) {
            this.store.load();
        },
        render: function (combo) {
            this.store.sort('GoiDirItemName', 'ASC');
        },
	expand : function(field, eOpts){
		    field.queryMode = "local";
	},
        keypress : function(combo, e, eOpts){
	  if((e.getKey() >= 65 && e.getKey() <= 90) 
	    || (e.getKey() >= 97 && e.getKey() <= 122)
	    || (e.getKey() == Ext.EventObject.ENTER)
	    || (e.getKey() == Ext.EventObject.BACKSPACE)
	    ) {
	    combo.collapse();
	    if(Ext.isEmpty(combo.getValue())){
	      combo.forceSelection=true;
	      combo.store.clearFilter(true);
	      combo.store.load();
	      combo.expand();
	    }
	  }
	},
	focus : function(combo){
	    combo.forceSelection=true;
	    combo.store.clearFilter(true);
	    combo.store.load();
	} 
    },
    allowBlank: false

},

{
    name: "PublisherAddress",
    id: "NpiMetadataPublisherAddress",
    maxLength: 1000,
    enforceMaxLength: true,
    height: 100,
    anchor: '60%',
    xtype: "textarea",
    fieldLabel: "Publisher Address",
    listeners: {
        blur: function () {
            var str = trim(this.getValue());
            str = str.replace(/ +(?= )/g, '');
            this.setValue(str);
        }
    },
    allowBlank: true

},


{
    name: "SameAsPublisher",
    id: "NpiMetadataSameAsPublisher",
    xtype: "checkboxfield",
    isFormField: false,
    fieldLabel: "Creator details same as Publisher?",
    listeners: {
        change: function (checkbox, newValue, oldValue) {
            var creatorOrgName = Ext.getCmp('CreatorOrgNamesCreatorOrgName');
            var creatorDepartment = Ext.getCmp('CreatorDeptNameCreatorDepartment');
            var creatorAddress = Ext.getCmp('NpiMetadataCreatorAddress');
            var publisherOrgName = Ext.getCmp('PublisherOrgNamesPublisherOrgName');
            var publisherDepartment = Ext.getCmp('PublisherDeptNamePublisherDepartment');
            var publisherAddress = Ext.getCmp('NpiMetadataPublisherAddress');
            if (this.getValue()) {
                creatorOrgName.setValue(publisherOrgName.getValue());
                creatorDepartment.setValue(publisherDepartment.getValue());
                creatorAddress.setValue(publisherAddress.getValue());
            } else {
                creatorOrgName.setValue('');
                creatorDepartment.setValue('');
                creatorAddress.setValue('');
            }
        }
    }
},


{
    name: "CreatorOrgName",
    id: "CreatorOrgNamesCreatorOrgName",
    fieldLabel: "CreatorOrg",
    xtype: "combobox",
    multiSelect: false,
    store: createQueryStore('GoiDirItem', 'Category="Organisations"'),
    width: 500,
    pageSize: 100,
    typeAhead : true,
    minChars:1,
   // forceSelection: true,
    triggerAction: 'all',
    queryMode: "remote",
    displayField: "GoiDirItemName",
    valueField: "GoiDirItemName",
    emptyText: "",
    listeners: {
        beforerender: function (combo) {
            this.store.load();
        },
        render: function (combo) {
            this.store.sort('GoiDirItemName', 'ASC');
        },
	expand : function(field, eOpts){
		    field.queryMode = "local";
	},
        keypress : function(combo, e, eOpts){
	  if((e.getKey() >= 65 && e.getKey() <= 90) 
	    || (e.getKey() >= 97 && e.getKey() <= 122)
	    || (e.getKey() == Ext.EventObject.ENTER)
	    || (e.getKey() == Ext.EventObject.BACKSPACE)
	    ) {
	    combo.collapse();
	    if(Ext.isEmpty(combo.getValue())){
	      combo.forceSelection=true;
	      combo.store.clearFilter(true);
	      combo.store.load();
	      combo.expand();
	    }
	  }
	},
	focus : function(combo){
	    combo.forceSelection=true;
	    combo.store.clearFilter(true);
	    combo.store.load();
	} 
    },
    allowBlank: true

},

{
    name: "CreatorDepartment",
    id: "CreatorDeptNameCreatorDepartment",
    fieldLabel: "CreatorDept <span style='color: rgb(255, 0, 0); padding-left: 2px;'>*</span>",
    xtype: "combobox",
    multiSelect: false,
    store: createQueryStore('GoiDirItem', 'Category="Departments"'),
    width: 500,
    pageSize: 100,
    typeAhead : true,
    minChars:1,
   // forceSelection: true,
    triggerAction: 'all',
    queryMode: "remote",
    displayField: "GoiDirItemName",
    valueField: "GoiDirItemName",
    emptyText: "",
    listeners: {
        beforerender: function (combo) {
            this.store.load();
        },
        render: function (combo) {
            this.store.sort('GoiDirItemName', 'ASC');
        },
	expand : function(field, eOpts){
		    field.queryMode = "local";
	},
        keypress : function(combo, e, eOpts){
	  if((e.getKey() >= 65 && e.getKey() <= 90) 
	    || (e.getKey() >= 97 && e.getKey() <= 122)
	    || (e.getKey() == Ext.EventObject.ENTER)
	    || (e.getKey() == Ext.EventObject.BACKSPACE)
	    ) {
	    combo.collapse();
	    if(Ext.isEmpty(combo.getValue())){
	      combo.forceSelection=true;
	      combo.store.clearFilter(true);
	      combo.store.load();
	      combo.expand();
	    }
	  }
	},
	focus : function(combo){
	    combo.forceSelection=true;
	    combo.store.clearFilter(true);
	    combo.store.load();
	}  
    },
    allowBlank: false

},

{
    name: "CreatorAddress",
    id: "NpiMetadataCreatorAddress",
    maxLength: 500,
    anchor: '60%',
    enforceMaxLength: true,
    height: 100,
    xtype: "textarea",
    fieldLabel: "Creator address",
    listeners: {
        blur: function () {
            var str = trim(this.getValue());
            str = str.replace(/ +(?= )/g, '');
            this.setValue(str);
        }
    },
    allowBlank: true

},

{
    name: "Format",
    id: "NpiMetadataFormat",
    fieldLabel: "Format <span style='color: rgb(255, 0, 0); padding-left: 2px;'>*</span>",
    xtype: "combobox",
    typeAhead : true,
    minChars:1,
  //  forceSelection: true,
    triggerAction: 'all',
    store: createStore('Format', ''),
    queryMode: "remote",
    displayField: "FormatName",
    valueField: "FormatName",
    emptyText: "",
    listeners: {
        beforerender: function (combo) {
            this.store.load();
        },
        render: function (combo, options) {
            this.store.sort('FormatName', 'ASC');
        },
	expand : function(field, eOpts){
		    field.queryMode = "local";
	},
        keypress : function(combo, e, eOpts){
	  if((e.getKey() >= 65 && e.getKey() <= 90) 
	    || (e.getKey() >= 97 && e.getKey() <= 122)
	    || (e.getKey() == Ext.EventObject.ENTER)
	    || (e.getKey() == Ext.EventObject.BACKSPACE)
	    ) {
	    combo.collapse();
	    if(Ext.isEmpty(combo.getValue())){
	      combo.forceSelection=true;
	      combo.store.clearFilter(true);
	      combo.store.load();
	      combo.expand();
	    }
	  }
	},
	focus : function(combo){
	    combo.forceSelection=true;
	    combo.store.clearFilter(true);
	    combo.store.load();
	} 
    },
    allowBlank: false

}, {
    name: "LanguageId",
    id: "NpiMetadataLanguageId",
    readOnly: true,
    enforceMaxLength: true,
    xtype: "textfield",
    fieldLabel: "Content Language Id",
    listeners: {
        blur: function () {
            var str = trim(this.getValue());
            str = str.replace(/ +(?= )/g, '');
            this.setValue(str);
        }
    },
    hidden: true,
    allowBlank: true

},

{
    name: "Language",
    id: "NpiMetadataLanguage",
    fieldLabel: "Language <span style='color: rgb(255, 0, 0); padding-left: 2px;'>*</span>",
    xtype: "combobox",
    typeAhead : true,
    minChars:1,
   // forceSelection: true,
    triggerAction: 'all',
    store: createStore('Language', '', 'LanguageName'),
    queryMode: "remote",
    displayField: "LanguageName",
    valueField: "LanguageName",
    emptyText: "",
    listeners: {
        select: function () {
            var v = this.getValue();
            var i = this.store.findExact(this.valueField || this.displayField, v);
            if (typeof (Ext.getCmp('NpiMetadataIsTopLevel')) != "undefined" && v != "") {
                var isTopLevel = Ext.getCmp('NpiMetadataIsTopLevel');
                isTopLevel.setValue("false");
            }
            if (v != "") {
                var pId = Ext.getCmp('NpiMetadataLanguageId');
                pId.setValue(this.store.getAt(i).get('Id'));
            }
        },
        render: function (combo, options) {
            this.store.sort('LanguageName', 'ASC');
        },
	expand : function(field, eOpts){
		    field.queryMode = "local";
	},
        keypress : function(combo, e, eOpts){
	  if((e.getKey() >= 65 && e.getKey() <= 90) 
	    || (e.getKey() >= 97 && e.getKey() <= 122)
	    || (e.getKey() == Ext.EventObject.ENTER)
	    || (e.getKey() == Ext.EventObject.BACKSPACE)
	    ) {
	    combo.collapse();
	    if(Ext.isEmpty(combo.getValue())){
	      combo.forceSelection=true;
	      combo.store.clearFilter(true);
	      combo.store.load();
	      combo.expand();
	    }
	  }
	},
	focus : function(combo){
	    combo.forceSelection=true;
	    combo.store.clearFilter(true);
	    combo.store.load();
	} 
    },
    allowBlank: false

},

{
    name: "MetaDataCreatedDate",
    id: "NpiMetadataMetaDataCreatedDate",
    fieldLabel: "MetaData Created Date",
    xtype: "datetimefield",
    allowBlank: true,
    editable: false

},

{
    name: "PublishedDate",
    id: "NpiMetadataPublishedDate",
    fieldLabel: "Published Date",
    xtype: "datetimefield",
    allowBlank: true,
    editable: false

},

{
    name: "ValidDate",
    id: "NpiMetadataValidDate",
    fieldLabel: "Valid Date",
    xtype: "datetimefield",
    allowBlank: true,
    editable: false

},

{
    name: "JurisdictionName",
    id: "JurisdictionJurisdictionName",
    fieldLabel: "Jurisdiction <span style='color: rgb(255, 0, 0); padding-left: 2px;'>*</span>",
    xtype: "combobox",
    typeAhead : true,
    minChars:1,
  //  forceSelection: true,
    triggerAction: 'all',
    store: createStore('JurisdictionType', ''),
    queryMode: "remote",
    displayField: "JurisdictionTypeName",
    valueField: "JurisdictionTypeName",
    emptyText: "",
    allowBlank: false,
    listeners:{
	expand : function(field, eOpts){
	  field.queryMode = "local";
	},
        keypress : function(combo, e, eOpts){
	  if((e.getKey() >= 65 && e.getKey() <= 90) 
	    || (e.getKey() >= 97 && e.getKey() <= 122)
	    || (e.getKey() == Ext.EventObject.ENTER)
	    || (e.getKey() == Ext.EventObject.BACKSPACE)
	    ) {
	    combo.collapse();
	    if(Ext.isEmpty(combo.getValue())){
	      combo.forceSelection=true;
	      combo.store.clearFilter(true);
	      combo.store.load();
	      combo.expand();
	    }
	  }
	},
	focus : function(combo){
	    combo.forceSelection=true;
	    combo.store.clearFilter(true);
	    combo.store.load();
	},
	select :function(combo){
		var juriState = Ext.getCmp("JurisdictionJurisdictionStateName");
		var juriDis   = Ext.getCmp("JurisdictionJurisdictionDistrictName");
		    if(combo.value.toLowerCase() == "allindia"){
			    juriState.setVisible(false);
			    juriDis.setVisible(false);
			    juriState.forceSelection=false;
			    juriDis.forceSelection=false;
			    juriState.setValue(''); 
			    juriDis.setValue('');
			    juriState.allowBlank = true;
			    juriDis.allowBlank = true;
		    }
		    else if(combo.value.toLowerCase() == "state"){
			    juriState.setVisible(true);
			    juriDis.setVisible(false);
			    juriState.setValue('');
			    juriState.forceSelection=true;
			    juriState.allowBlank = false;
		    }		    
	    } 
	}
},
{
    name: "JurisdictionStateId",
    id: "JurisdictionJurisdictionStateId",
    readOnly: true,
    enforceMaxLength: true,
    xtype: "textfield",
    fieldLabel: "JurisdictionStateId",
    listeners: {
        blur: function () {
            var str = trim(this.getValue());
            str = str.replace(/ +(?= )/g, '');
            this.setValue(str);
        }
    },
    hidden: true,
    allowBlank: true

},

{
    name: "JurisdictionStateName",
    id: "JurisdictionJurisdictionStateName",
    fieldLabel: "Jurisdiction State <span style='color: rgb(255, 0, 0); padding-left: 2px;'>*</span>",
    xtype: "combobox",
    typeAhead : true,
    minChars:1,
  //  forceSelection: true,
    triggerAction: 'all',
    store: createQueryStore('GoiDirItem', 'category="State"', 'GoiDirItemName'),
    width: 500,
    pageSize: 40,
    queryMode: "remote",
    hidden: true,
    displayField: "GoiDirItemName",
    valueField: "GoiDirItemName",
    emptyText: "",
    listeners: {
        select: function () {
	    var juriDis = Ext.getCmp("JurisdictionJurisdictionDistrictName");
	    juriDis.setVisible(true);
	    juriDis.allowBlank = false;
            var sname = this.getValue();
            var i = this.store.findExact(this.valueField || this.displayField, sname);
            if (typeof (Ext.getCmp('JurisdictionIsTopLevel')) != "undefined" && sname != "") {
                var isTopLevel = Ext.getCmp('JurisdictionIsTopLevel');
                isTopLevel.setValue("false");
            }
            if (sname != "") {
                var pId = Ext.getCmp('JurisdictionJurisdictionStateId');
                pId.setValue(this.store.getAt(i).get('Id'));
            }
            var dname = Ext.getCmp('JurisdictionJurisdictionDistrictName');
            if (!Ext.isEmpty(sname)) {
                dname.setValue('');
                dname.queryMode = "local";
		dname.allowBlank = false;
                dname.store.load({
                    params: {
                        "ParentGoiDirItemName": '"' + sname + '"'
                    }
                });
		dname.store.on('load', function(store, records, successful, operation, eOpts){
		   if(store.getCount()>0){
		     dname.setVisible(true);  
		   }
		   else{
		     dname.setVisible(false);
		     dname.allowBlank = true;
		   }
		});
		
            }
        },
        focus: function (combo) {
            var sname = combo.getValue();
            var dname = Ext.getCmp('JurisdictionJurisdictionDistrictName');
            if (!Ext.isEmpty(sname)) {
               // dname.setValue('');
                dname.queryMode = "local";
		dname.allowBlank = false;
                dname.store.load({
                    params: {
                        "ParentGoiDirItemName": '"' + sname + '"'
                    }
                });		
            }
            combo.forceSelection=true;
	    combo.store.clearFilter(true);
	    combo.store.load();
        },
        render: function (combo, options) {
            this.store.sort('GoiDirItemName', 'ASC');
        },
	expand : function(field, eOpts){
	    field.queryMode = "local";
	},
        keypress : function(combo, e, eOpts){
	  if((e.getKey() >= 65 && e.getKey() <= 90) 
	    || (e.getKey() >= 97 && e.getKey() <= 122)
	    || (e.getKey() == Ext.EventObject.ENTER)
	    || (e.getKey() == Ext.EventObject.BACKSPACE)
	    ) {
	    combo.collapse();
	    if(Ext.isEmpty(combo.getValue())){
	      combo.forceSelection=true;
	      combo.store.clearFilter(true);
	      combo.store.load();
	      combo.expand();
	    }
	  }
	} 
    },
    allowBlank: true
},

{
    name: "JurisdictionDistrictId",
    id: "JurisdictionJurisdictionDistrictId",
    readOnly: true,
    enforceMaxLength: true,
    xtype: "textfield",
    fieldLabel: "JurisidictionDistrictId",
    listeners: {
        blur: function () {
            var str = trim(this.getValue());
            str = str.replace(/ +(?= )/g, '');
            this.setValue(str);
        }
    },
    hidden: true,
    allowBlank: true

},

{
    name: "JurisdictionDistrictName",
    id: "JurisdictionJurisdictionDistrictName",
    fieldLabel: "Jurisdiction District <span style='color: rgb(255, 0, 0); padding-left: 2px;'>*</span>",
    xtype: "combobox",
    store: createQueryStore('GoiDirItem', 'category="State District"', 'GoiDirItemName'),
    width: 500,
    typeAhead : true,
    minChars:1,
  //  forceSelection: true,
    triggerAction: 'all',
    queryMode: "local",
    hidden: true,
    displayField: "GoiDirItemName",
    valueField: "GoiDirItemName",
    emptyText: "",
    listeners: {
        select: function () {
            var v = this.getValue();
            var i = this.store.findExact(this.valueField || this.displayField, v);
            if (typeof (Ext.getCmp('JurisdictionIsTopLevel')) != "undefined" && v != "") {
                var isTopLevel = Ext.getCmp('JurisdictionIsTopLevel');
                isTopLevel.setValue("false");
            }
            if (v != "") {
                var pId = Ext.getCmp('JurisdictionJurisdictionDistrictId');
                pId.setValue(this.store.getAt(i).get('Id'));
            }
        },
        render: function (combo, options) {
            this.store.removeAll(); // added
            this.store.sort('GoiDirItemName', 'ASC');
        },
	expand : function(field, eOpts){
	  field.queryMode = "local";
	},
        keypress : function(combo, e, eOpts){
	  if((e.getKey() >= 65 && e.getKey() <= 90) 
	    || (e.getKey() >= 97 && e.getKey() <= 122)
	    || (e.getKey() == Ext.EventObject.ENTER)
	    || (e.getKey() == Ext.EventObject.BACKSPACE)
	    ) {
	    combo.collapse();
	    if(Ext.isEmpty(combo.getValue())){
	      combo.forceSelection=true;
	      combo.store.clearFilter(true);
	      combo.store.load();
	      combo.expand();
	    }
	  }
	},
	focus : function(combo){
	    combo.forceSelection=true;
	    combo.store.clearFilter(true);
	    //combo.store.load();
	}
    },
    allowBlank: true

},

{
    name: "SpatialStateId",
    id: "SpatialSpatialStateId",
    readOnly: true,
    enforceMaxLength: true,
    xtype: "textfield",
    fieldLabel: "Spatial State Id",
    listeners: {
        blur: function () {
            var str = trim(this.getValue());
            str = str.replace(/ +(?= )/g, '');
            this.setValue(str);
        }
    },
    hidden: true,
    allowBlank: true

},

{
    name: "SpatialStateName",
    id: "SpatialSpatialStateName",
    fieldLabel: "Spatial State <span style='color: rgb(255, 0, 0); padding-left: 2px;'>*</span>",
    xtype: "combobox",
    typeAhead : true,
    minChars:1,
  //  forceSelection: true,
    triggerAction: 'all',
    store: createQueryStore('GoiDirItem', 'category="State"', 'GoiDirItemName'),
    width: 500,
    pageSize: 40,
    typeAhead: true,
    queryMode: "remote",
    displayField: "GoiDirItemName",
    valueField: "GoiDirItemName",
    emptyText: "",
    listeners: {
        select: function () {
            var sname = this.getValue();
            var i = this.store.findExact(this.valueField || this.displayField, sname);
            if (typeof (Ext.getCmp('SpatialIsTopLevel')) != "undefined" && sname != "") {
                var isTopLevel = Ext.getCmp('SpatialIsTopLevel');
                isTopLevel.setValue("false");
            }
            if (sname != "") {
                var pId = Ext.getCmp('SpatialSpatialStateId');
                pId.setValue(this.store.getAt(i).get('Id'));
            }
            var dname = Ext.getCmp('SpatialSpatialDistrictName');
            if (!Ext.isEmpty(sname) && sname.toLowerCase() !== 'allindia') {
                dname.setValue('');
                dname.queryMode = "local";
		dname.allowBlank = false;
                dname.store.load({
                    params: {
                        "ParentGoiDirItemName": '"' + sname + '"'
                    }
                });
            } else {
                //dname.store.load();
                dname.setValue('');
                dname.queryMode = "local";
		dname.allowBlank = true;
                dname.store.load({
                    params: {
                        "ParentGoiDirItemName": '"' + sname + '"'
                    }
                });
            }
        },
        focus: function (combo) {
            var sname = combo.getValue();
            var dname = Ext.getCmp('SpatialSpatialDistrictName');
            if (!Ext.isEmpty(sname) && sname.toLowerCase() !== 'allindia') {
                dname.setValue('');
                dname.queryMode = "local";
		dname.allowBlank = false;
                dname.store.load({
                    params: {
                        "ParentGoiDirItemName": '"' + sname + '"'
                    }
                });
            } else {
                //dname.store.load();
                dname.setValue('');
                dname.queryMode = "local";
		dname.allowBlank = true;
                dname.store.load({
                    params: {
                        "ParentGoiDirItemName": '"' + sname + '"'
                    }
                });
            }
            combo.forceSelection=true;
	    combo.store.clearFilter(true);
	    combo.store.load();
        },
        render: function (combo, options) {
            this.store.sort('GoiDirItemName', 'ASC');
        },
	expand : function(field, eOpts){
	  field.queryMode = "local";
	},
        keypress : function(combo, e, eOpts){
	  if((e.getKey() >= 65 && e.getKey() <= 90) 
	    || (e.getKey() >= 97 && e.getKey() <= 122)
	    || (e.getKey() == Ext.EventObject.ENTER)
	    || (e.getKey() == Ext.EventObject.BACKSPACE)
	    ) {
	    combo.collapse();
	    if(Ext.isEmpty(combo.getValue())){
	      combo.forceSelection=true;
	      combo.store.clearFilter(true);
	      combo.store.load();
	      combo.expand();
	    }
	  }
	}
    },
    allowBlank: true

},

{
    name: "SpatialDistrictId",
    id: "SpatialSpatialDistrictId",
    readOnly: true,
    enforceMaxLength: true,
    xtype: "textfield",
    fieldLabel: "Spatial District Id",
    listeners: {
        blur: function () {
            var str = trim(this.getValue());
            str = str.replace(/ +(?= )/g, '');
            this.setValue(str);
        }
    },
    hidden: true,
    allowBlank: true

},

{
    name: "SpatialDistrictName",
    id: "SpatialSpatialDistrictName",
    fieldLabel: "Spatial District",
    xtype: "combobox",
    store: createQueryStore('GoiDirItem', 'category="State District"', 'GoiDirItemName'),
    width: 500,
    typeAhead : true,
    minChars:1,
  //  forceSelection: true,
    triggerAction: 'all',
    queryMode: "local",
    displayField: "GoiDirItemName",
    valueField: "GoiDirItemName",
    emptyText: "",
    listeners: {
        select: function () {
            var v = this.getValue();
            var i = this.store.findExact(this.valueField || this.displayField, v);
            if (typeof (Ext.getCmp('SpatialIsTopLevel')) != "undefined" && v != "") {
                var isTopLevel = Ext.getCmp('SpatialIsTopLevel');
                isTopLevel.setValue("false");
            }
            if (v != "") {
                var pId = Ext.getCmp('SpatialSpatialDistrictId');
                pId.setValue(this.store.getAt(i).get('Id'));
            }
        },
        render: function (combo, options) {
            this.store.removeAll(); // added 
            this.store.sort('GoiDirItemName', 'ASC');
        },
	expand : function(field, eOpts){
	  field.queryMode = "local";
	},
	keypress : function(combo, e, eOpts){
	  if((e.getKey() >= 65 && e.getKey() <= 90) 
	    || (e.getKey() >= 97 && e.getKey() <= 122)
	    || (e.getKey() == Ext.EventObject.ENTER)
	    || (e.getKey() == Ext.EventObject.BACKSPACE)
	    ) {
	    combo.collapse();
	    if(Ext.isEmpty(combo.getValue())){
	      combo.forceSelection=true;
	      combo.store.clearFilter(true);
	      combo.store.load();
	      combo.expand();
	    }
	  }
	},
	focus : function(combo){
	    combo.forceSelection=true;
	    combo.store.clearFilter(true);
	    //combo.store.load();
	} 
    },
    allowBlank: true

},

{
    name: "CoverageTemporal",
    id: "NpiMetadataCoverageTemporal",
    maxLength: 50,
    enforceMaxLength: true,
    xtype: "textfield",
    fieldLabel: "Coverage Temporal",
    listeners: {
        blur: function () {
            var str = trim(this.getValue());
            str = str.replace(/ +(?= )/g, '');
            this.setValue(str);
        }
    },
    vtype: "alphanumMid",
    allowBlank: true

},

{
    name: "AudienceCategory",
    id: "NpiMetadataAudienceAudienceCategory",
    fieldLabel: "Audience <span style='color: rgb(255, 0, 0); padding-left: 2px;'>*</span>",
    xtype: "combobox",
    multiSelect: true,
    typeAhead : true,
    minChars:1,
  //  forceSelection: true,
    triggerAction: 'all',
    store: createStore('AudienceCategory', ''),
    queryMode: "local",
    displayField: "AudienceCategoryName",
    valueField: "AudienceCategoryName",
    emptyText: "",
    listeners: {
        beforerender: function (combo) {
            this.store.load();
        },
        render: function (combo) {
            this.store.sort('AudienceCategoryName', 'ASC');
        },
	expand : function(field, eOpts){
	  field.queryMode = "local";
	},
	keypress : function(combo, e, eOpts){
	  if((e.getKey() >= 65 && e.getKey() <= 90) 
	    || (e.getKey() >= 97 && e.getKey() <= 122)
	    || (e.getKey() == Ext.EventObject.ENTER)
	    || (e.getKey() == Ext.EventObject.BACKSPACE)
	    ) {
	    combo.collapse();
	    if(Ext.isEmpty(combo.getValue())){
	      combo.forceSelection=true;
	      combo.store.clearFilter(true);
	      combo.store.load();
	      combo.expand();
	    }
	  }
	},
	focus : function(combo){
	    combo.forceSelection=true;
	    combo.store.clearFilter(true);
	    combo.store.load();
	}
    },
    allowBlank: false

},

{
    name: "CategoryType",
    id: "NpiMetadataCategoryTypesCategoryType",
    fieldLabel: "Type Category <span style='color: rgb(255, 0, 0); padding-left: 2px;'>*</span>",
    xtype: "combobox",
    typeAhead : true,
    minChars:1,
   // forceSelection: true,
    triggerAction: 'all',
    multiSelect: true,
    store: createStore('Category', ''),
    queryMode: "local",
    displayField: "CategoryName",
    valueField: "CategoryName",
    emptyText: "",
    listeners: {
        beforerender: function (combo) {
            this.store.load();
        },
        render: function (combo) {
            this.store.sort('CategoryName', 'ASC');
        },
	expand : function(field, eOpts){
	  field.queryMode = "local";
	},
	keypress : function(combo, e, eOpts){
	  if((e.getKey() >= 65 && e.getKey() <= 90) 
	    || (e.getKey() >= 97 && e.getKey() <= 122)
	    || (e.getKey() == Ext.EventObject.ENTER)
	    || (e.getKey() == Ext.EventObject.BACKSPACE)
	    ) {
	    combo.collapse();
	    if(Ext.isEmpty(combo.getValue())){
	      combo.forceSelection=true;
	      combo.store.clearFilter(true);
	      combo.store.load();
	      combo.expand();
	    }
	  }
	},
	focus : function(combo){
	    combo.forceSelection=true;
	    combo.store.clearFilter(true);
	    combo.store.load();
	}
    },
    allowBlank: false

},

{
    name: "ConformsTo",
    id: "NpiMetadataConformsTo",
    maxLength: 50,
    enforceMaxLength: true,
    xtype: "textfield",
    fieldLabel: "Relation ConformsTo",
    listeners: {
        blur: function () {
            var str = trim(this.getValue());
            str = str.replace(/ +(?= )/g, '');
            this.setValue(str);
        }
    },
    vtype: "alphanumMid",
    allowBlank: true

},

{
    name: "HasPart",
    id: "NpiMetadataHasPartsHasPart",
    maxLength: 50,
    enforceMaxLength: true,
    xtype: "textfield",
    fieldLabel: "Relation HasPart",
    listeners: {
        blur: function () {
            var str = trim(this.getValue());
            str = str.replace(/ +(?= )/g, '');
            this.setValue(str);
        }
    },
    vtype: "alphanumMid",
    allowBlank: true

},

{
    name: "IsPartOf",
    id: "NpiMetadataIsPartOf",
    maxLength: 50,
    enforceMaxLength: true,
    xtype: "textfield",
    fieldLabel: "Relation IsPartOf",
    listeners: {
        blur: function () {
            var str = trim(this.getValue());
            str = str.replace(/ +(?= )/g, '');
            this.setValue(str);
        }
    },
    vtype: "alphanumMid",
    allowBlank: true

},

{
    name: "HasVersion",
    id: "NpiMetadataHasVersion",
    maxLength: 50,
    enforceMaxLength: true,
    xtype: "textfield",
    fieldLabel: "Relation HasVersion",
    listeners: {
        blur: function () {
            var str = trim(this.getValue());
            str = str.replace(/ +(?= )/g, '');
            this.setValue(str);
        }
    },
    vtype: "alphanumMid",
    allowBlank: true

},

{
    name: "IsVersionOf",
    id: "NpiMetadataIsVersionOf",
    maxLength: 50,
    enforceMaxLength: true,
    xtype: "textfield",
    fieldLabel: "Relation IsVersionof",
    listeners: {
        blur: function () {
            var str = trim(this.getValue());
            str = str.replace(/ +(?= )/g, '');
            this.setValue(str);
        }
    },
    vtype: "alphanumMid",
    allowBlank: true

},

{
    name: "Status",
    id: "NpiMetadataStatus",
    editable: false,
    fieldLabel: "Status",
    hidden: true,
    xtype: "combobox",
    editable: false,
    store: createStore('Stage', ''),
    queryMode: "remote",
    displayField: "StageName",
    valueField: "StageName",
    emptyText: "",
    allowBlank: true

},

{
    name: "Source",
    id: "NpiMetadataSource",
    maxLength: 50,
    enforceMaxLength: true,
    xtype: "textfield",
    fieldLabel: "Source <span style='color: rgb(255, 0, 0); padding-left: 2px;'>*</span>",
    listeners: {
        blur: function () {
            var str = trim(this.getValue());
            str = str.replace(/ +(?= )/g, '');
            this.setValue(str);
        }
    },
    vtype: "alphanumMid",
    allowBlank: false

}, {
    name: "WorkflowId",
    id: "DependentNpiMetadataWorkflowInfoWorkflowId",
    readOnly: true,
    fieldCls: 'readonly-background-class',
    enforceMaxLength: true,
    xtype: "textfield",
    fieldLabel: "Workflow Id",
    listeners: {
        blur: function () {
            var str = trim(this.getValue());
            str = str.replace(/ +(?= )/g, '');
            this.setValue(str);
        }
    },
    hidden: true,
    allowBlank: true

},

{
    name: "WorkflowName",
    id: "DependentNpiMetadataWorkflowInfoWorkflowName",
    fieldLabel: "Choose Workflow <span style='color: rgb(255, 0, 0); padding-left: 2px;'>*</span>",
    xtype: "combobox",
    typeAhead : true,
    minChars:1,
   // forceSelection: true,
    triggerAction: 'all',
    store: createPreloadedStore('Workflow', 'contentcreator', 'WorkflowName'),
    queryMode: "remote",
    displayField: "WorkflowName",
    valueField: "WorkflowName",
    emptyText: "",
    listeners: {
        select: function () {
            var v = this.getValue();
            var i = this.store.findExact(this.valueField || this.displayField, v);
            if (typeof (Ext.getCmp('WorkflowInfoIsTopLevel')) != "undefined" && v != "") {
                var isTopLevel = Ext.getCmp('WorkflowInfoIsTopLevel');
                isTopLevel.setValue("false");
            }
            if (v != "") {
                var pId = Ext.getCmp('DependentNpiMetadataWorkflowInfoWorkflowId');
                pId.setValue(this.store.getAt(i).get('Id'));
            }
        },
        render: function (combo, options) {
            this.store.sort('WorkflowName', 'ASC');
        },
	expand : function(field, eOpts){
	  field.queryMode = "local";
	},
	keypress : function(combo, e, eOpts){
	  if((e.getKey() >= 65 && e.getKey() <= 90) 
	    || (e.getKey() >= 97 && e.getKey() <= 122)
	    || (e.getKey() == Ext.EventObject.ENTER)
	    || (e.getKey() == Ext.EventObject.BACKSPACE)
	    ) {
	    combo.collapse();
	    if(Ext.isEmpty(combo.getValue())){
	      combo.forceSelection=true;
	      combo.store.clearFilter(true);
	      combo.store.load();
	      combo.expand();
	    }
	  }
	},
	focus : function(combo){
	    combo.forceSelection=true;
	    combo.store.clearFilter(true);
	    combo.store.load();
	}
    },
    allowBlank: false

},

{
    name: "CreatedDate",
    id: "NpiMetadataCreatedDate",
    readOnly: true,
    fieldLabel: "Created Date",
    xtype: "datetimefield",
    listeners: {
        render: function () {
            var date = new Date();
            if (this.getValue() == null || this.getValue() == "") {
                this.setValue(date);
            }
        }
    },
    hidden: true,
    allowBlank: true

}, {
    name: "LastModifiedDate",
    id: "NpiMetadataLastModifiedDate",
    readOnly: true,
    fieldLabel: "Last Modified Date",
    xtype: "datetimefield",
    listeners: {
        render: function () {
            var date = new Date();
            this.setValue(date);
        }
    },
    hidden: true,
    allowBlank: true

}, {
    name: "CreatedBy",
    id: "NpiMetadataCreatedBy",
    readOnly: true,
    enforceMaxLength: true,
    xtype: "textfield",
    fieldLabel: "Created By",
    listeners: {
        blur: function () {
            var str = trim(this.getValue());
            str = str.replace(/ +(?= )/g, '');
            this.setValue(str);
        }
    },
    hidden: true,
    listeners: {
        render: function () {
            if (this.getValue() == "") {
                this.setValue(cmsUserName);
            }
        }
    },
    allowBlank: true

},

{
    name: "LastModifiedBy",
    id: "NpiMetadataLastModifiedBy",
    readOnly: true,
    enforceMaxLength: true,
    xtype: "textfield",
    fieldLabel: "Last Modified By",
    listeners: {
        blur: function () {
            var str = trim(this.getValue());
            str = str.replace(/ +(?= )/g, '');
            this.setValue(str);
        }
    },
    hidden: true,
    listeners: {
        render: function () {
            this.setValue(cmsUserName);
        }
    },
    allowBlank: true

},


{
    name: "CurrentUser",
    id: "WorkflowInfoCurrentUser",
    readOnly: true,
    enforceMaxLength: true,
    xtype: "textfield",
    fieldLabel: "CurrentRole",
    listeners: {
        blur: function () {
            var str = trim(this.getValue());
            str = str.replace(/ +(?= )/g, '');
            this.setValue(str);
        }
    },
    hidden: true,
    allowBlank: true

},

{
    name: "CurrentAction",
    id: "WorkflowInfoCurrentAction",
    readOnly: true,
    enforceMaxLength: true,
    xtype: "textfield",
    fieldLabel: "CurrentAction",
    listeners: {
        blur: function () {
            var str = trim(this.getValue());
            str = str.replace(/ +(?= )/g, '');
            this.setValue(str);
        }
    },
    hidden: true,
    allowBlank: true

},


{
    name: "Stage",
    id: "WorkflowInfoStage",
    readOnly: true,
    enforceMaxLength: true,
    xtype: "textfield",
    fieldLabel: "Stage",
    listeners: {
        blur: function () {
            var str = trim(this.getValue());
            str = str.replace(/ +(?= )/g, '');
            this.setValue(str);
        }
    },
    hidden: true,
    allowBlank: true

},

{
    name: "WorkflowComments",
    id: "WorkflowInfoWorkflowComments",
    readOnly: true,
    enforceMaxLength: true,
    xtype: "textfield",
    fieldLabel: "Stage",
    listeners: {
        blur: function () {
            var str = trim(this.getValue());
            str = str.replace(/ +(?= )/g, '');
            this.setValue(str);
        }
    },
    hidden: true,
    allowBlank: true

},

{
    name: "Site",
    id: "NpiMetadataSite",
    readOnly: true,
    enforceMaxLength: true,
    xtype: "textfield",
    fieldLabel: "Site",
    listeners: {
        blur: function () {
            var str = trim(this.getValue());
            str = str.replace(/ +(?= )/g, '');
            this.setValue(str);
        }
    },
    hidden: true,
    allowBlank: true

},

{
    name: "Version",
    id: "NpiMetadataVersion",
    readOnly: true,
    enforceMaxLength: true,
    xtype: "textfield",
    fieldLabel: "Version",
    listeners: {
        blur: function () {
            var str = trim(this.getValue());
            str = str.replace(/ +(?= )/g, '');
            this.setValue(str);
        }
    },
    hidden: true,
    allowBlank: true

}];

/**
 * Dependent Address form declaration 
 */

var DependentAddressForm = [

{
    name: "AddressName",
    id: "AddressAddressName",
    maxLength: 50,
    enforceMaxLength: true,
    xtype: "textfield",
    fieldLabel: "Address Name <span style='color: rgb(255, 0, 0); padding-left: 2px;'>*</span>",
    listeners: {
        blur: function () {
            var str = trim(this.getValue());
            str = str.replace(/ +(?= )/g, '');
            this.setValue(str);
        }
    },
    vtype: "alphanumMid",
    allowBlank: false

},

{
    name: "Address",
    id: "AddressAddress",
    xtype: "textarea",
    maxLength: 1000,
    fieldLabel: "Address <span style='color: rgb(255, 0, 0); padding-left: 2px;'>*</span>",
    height: 200,
    value: "",
    defaultValue: "",
    anchor: '100%',
    listeners: {
        blur: function () {
            var str = trim(this.getValue());
            str = str.replace(/ +(?= )/g, '');
            this.setValue(str);
        }
    },
    allowBlank: false

},

{
    name: "Village",
    id: "AddressVillage",
    maxLength: 50,
    enforceMaxLength: true,
    xtype: "textfield",
    fieldLabel: "Village",
    listeners: {
        blur: function () {
            var str = trim(this.getValue());
            str = str.replace(/ +(?= )/g, '');
            this.setValue(str);
        }
    },
    vtype: "alphanumMid",
    allowBlank: true

},

{
    name: "Taluk",
    id: "AddressTaluk",
    maxLength: 50,
    enforceMaxLength: true,
    xtype: "textfield",
    fieldLabel: "Taluk",
    listeners: {
        blur: function () {
            var str = trim(this.getValue());
            str = str.replace(/ +(?= )/g, '');
            this.setValue(str);
        }
    },
    vtype: "alphanumMid",
    allowBlank: true

},

{
    name: "StateId",
    id: "AddressStateId",
    enforceMaxLength: true,
    xtype: "textfield",
    fieldLabel: "State Id",
    listeners: {
        blur: function () {
            var str = trim(this.getValue());
            str = str.replace(/ +(?= )/g, '');
            this.setValue(str);
        }
    },
    hidden: true,
    allowBlank: true

},

{
    name: "State",
    id: "AddressState",
    fieldLabel: "State  <span style='color: rgb(255, 0, 0); padding-left: 2px;'>*</span>",
    xtype: "combobox",
    typeAhead : true,
    minChars:1,
   // forceSelection: true,
    triggerAction: 'all',
    store: createQueryStore('GoiDirItem', 'category="State"', 'GoiDirItemName'),
    width: 500,
    pageSize: 100,
    queryMode: "remote",
    displayField: "GoiDirItemName",
    valueField: "GoiDirItemName",
    emptyText: "",

    listeners: {
        select: function () {
            var sname = this.getValue();
            var i = this.store.findExact(this.valueField || this.displayField, sname);
            if (typeof (Ext.getCmp('AddressIsTopLevel')) != "undefined" && sname != "") {
                var isTopLevel = Ext.getCmp('AddressIsTopLevel');
                isTopLevel.setValue("false");
            }
            if (sname != "") {
                var pId = Ext.getCmp('AddressStateId');
                pId.setValue(this.store.getAt(i).get('Id'));
            }
            var dname = Ext.getCmp('AddressDistrict');
            if (!Ext.isEmpty(sname) && sname.toLowerCase() !== 'allindia') {
                dname.setValue('');
                dname.queryMode = "local";
                dname.store.load({
                    params: {
                        "ParentGoiDirItemName": '"' + sname + '"'
                    }
                });
            } else {
                //dname.store.load();
                dname.setValue('');
                dname.queryMode = "local";
                dname.store.load({
                    params: {
                        "ParentGoiDirItemName": '"' + sname + '"'
                    }
                });
            }
        },
        focus: function (combo) {
            var sname = combo.getValue();
            var dname = Ext.getCmp('AddressDistrict');
            if (!Ext.isEmpty(sname) && sname.toLowerCase() !== 'allindia') {
                dname.setValue('');
                dname.queryMode = "local";
                dname.store.load({
                    params: {
                        "ParentGoiDirItemName": '"' + sname + '"'
                    }
                });
            } else {
                //dname.store.load();
                dname.setValue('');
                dname.queryMode = "local";
                dname.store.load({
                    params: {
                        "ParentGoiDirItemName": '"' + sname + '"'
                    }
                });
            }
            combo.forceSelection=true;
	    combo.store.clearFilter(true);
	   // combo.store.load();
        },
        render: function (combo, options) {
            this.store.sort('GoiDirItemName', 'ASC');
        },
	expand : function(field, eOpts){
	  field.queryMode = "local";
	},
	keypress : function(combo, e, eOpts){
	  if((e.getKey() >= 65 && e.getKey() <= 90) 
	    || (e.getKey() >= 97 && e.getKey() <= 122)
	    || (e.getKey() == Ext.EventObject.ENTER)
	    || (e.getKey() == Ext.EventObject.BACKSPACE)
	    ) {
	    combo.collapse();
	    if(Ext.isEmpty(combo.getValue())){
	      combo.forceSelection=true;
	      combo.store.clearFilter(true);
	      combo.store.load();
	      combo.expand();
	    }
	  }
	}
    },
    allowBlank: false

},

{
    name: "DistrictId",
    id: "AddressDistrictId",
    readOnly: true,
    enforceMaxLength: true,
    xtype: "textfield",
    fieldLabel: "District Id",
    listeners: {
        blur: function () {
            var str = trim(this.getValue());
            str = str.replace(/ +(?= )/g, '');
            this.setValue(str);
        }
    },
    hidden: true,
    allowBlank: true

},

{
    name: "District",
    id: "AddressDistrict",
    fieldLabel: "District",
    xtype: "combobox",
    store: createQueryStore('GoiDirItem', 'category="State District"', 'GoiDirItemName'),
    width: 500,
    typeAhead : true,
    minChars:1,
  //  forceSelection: true,
    triggerAction: 'all',
    queryMode: "local",
    displayField: "GoiDirItemName",
    valueField: "GoiDirItemName",
    emptyText: "",

    listeners: {
        select: function () {
            var v = this.getValue();
            var i = this.store.findExact(this.valueField || this.displayField, v);
            if (typeof (Ext.getCmp('AddressIsTopLevel')) != "undefined" && v != "") {
                var isTopLevel = Ext.getCmp('AddressIsTopLevel');
                isTopLevel.setValue("false");
            }
            if (v != "") {
                var pId = Ext.getCmp('AddressDistrictId');
                pId.setValue(this.store.getAt(i).get('Id'));
            }
        },
        render: function (combo, options) {
            this.store.removeAll(); // added
            this.store.sort('GoiDirItemName', 'ASC');
        },
	expand : function(field, eOpts){
	  field.queryMode = "local";
	},
	keypress : function(combo, e, eOpts){
	  if((e.getKey() >= 65 && e.getKey() <= 90) 
	    || (e.getKey() >= 97 && e.getKey() <= 122)
	    || (e.getKey() == Ext.EventObject.ENTER)
	    || (e.getKey() == Ext.EventObject.BACKSPACE)
	    ) {
	    combo.collapse();
	    if(Ext.isEmpty(combo.getValue())){
	      combo.forceSelection=true;
	      combo.store.clearFilter(true);
	      combo.store.load();
	      combo.expand();
	    }
	  }
	},
	focus : function(combo){
	    combo.forceSelection=true;
	    combo.store.clearFilter(true);
	    //combo.store.load();
	}
    },
    allowBlank: true

},

{
    name: "CityId",
    id: "AddressCityId",
    readOnly: true,
    enforceMaxLength: true,
    xtype: "textfield",
    fieldLabel: "CityId",
    listeners: {
        blur: function () {
            var str = trim(this.getValue());
            str = str.replace(/ +(?= )/g, '');
            this.setValue(str);
        }
    },
    hidden: true,
    allowBlank: true

},

{
    name: "City",
    id: "AddressCity",
    fieldLabel: "City <span style='color: rgb(255, 0, 0); padding-left: 2px;'>*</span>",
    xtype: "combobox",
    typeAhead : true,
    minChars:1,
   // forceSelection: true,
    triggerAction: 'all',
    store: createStore('City', '', 'CityName'),
    queryMode: "remote",
    displayField: "CityName",
    valueField: "CityName",
    emptyText: "",
    listeners: {
        select: function () {
            var v = this.getValue();
            var i = this.store.findExact(this.valueField || this.displayField, v);
            if (typeof (Ext.getCmp('AddressIsTopLevel')) != "undefined" && v != "") {
                var isTopLevel = Ext.getCmp('AddressIsTopLevel');
                isTopLevel.setValue("false");
            }
            if (v != "") {
                var pId = Ext.getCmp('AddressCityId');
                pId.setValue(this.store.getAt(i).get('Id'));
            }
        },
        render: function (combo, options) {
            this.store.sort('CityName', 'ASC');
        },
	expand : function(field, eOpts){
	  field.queryMode = "local";
	},
	keypress : function(combo, e, eOpts){
	  if((e.getKey() >= 65 && e.getKey() <= 90) 
	    || (e.getKey() >= 97 && e.getKey() <= 122)
	    || (e.getKey() == Ext.EventObject.ENTER)
	    || (e.getKey() == Ext.EventObject.BACKSPACE)
	    ) {
	    combo.collapse();
	    if(Ext.isEmpty(combo.getValue())){
	      combo.forceSelection=true;
	      combo.store.clearFilter(true);
	      combo.store.load();
	      combo.expand();
	    }
	  }
	},
	focus : function(combo){
	    combo.forceSelection=true;
	    combo.store.clearFilter(true);
	    combo.store.load();
	}
    },
    allowBlank: false

},

{
    name: "Pincode",
    id: "AddressPincode",
    maxLength: 50,
    enforceMaxLength: true,
    xtype: "textfield",
    fieldLabel: "Pincode",
    listeners: {
        blur: function () {
            var str = trim(this.getValue());
            str = str.replace(/ +(?= )/g, '');
            this.setValue(str);
        }
    },
    vtype: "pincode",
    allowBlank: true

}];

/**
 * Dependent Hindi Address form declaration 
 */

var DependentHindiAddressForm = [{
    name: "HindiAddressName",
    id: "HindiAddressAddressName",
    maxLength: 50,
    enforceMaxLength: true,
    xtype: "textfield",
    fieldLabel: "Address Name <span style='color: rgb(255, 0, 0); padding-left: 2px;'>*</span>",
    listeners: {
        blur: function () {
            var str = trim(this.getValue());
            str = str.replace(/ +(?= )/g, '');
            this.setValue(str);
        }
    },
    vtype: "alphanumMid",
    allowBlank: false

},

{
    name: "HindiAddress",
    id: "HindiAddressAddress",
    xtype: "textarea",
    maxLength: 1000,
    fieldLabel: "Address <span style='color: rgb(255, 0, 0); padding-left: 2px;'>*</span>",
    height: 200,
    value: "",
    defaultValue: "",
    anchor: '100%',
    listeners: {
        blur: function () {
            var str = trim(this.getValue());
            str = str.replace(/ +(?= )/g, '');
            this.setValue(str);
        }
    },
    allowBlank: false

},

{
    name: "HindiVillage",
    id: "HindiAddressVillage",
    maxLength: 50,
    enforceMaxLength: true,
    xtype: "textfield",
    fieldLabel: "Village",
    listeners: {
        blur: function () {
            var str = trim(this.getValue());
            str = str.replace(/ +(?= )/g, '');
            this.setValue(str);
        }
    },
    vtype: "alphanumMid",
    allowBlank: true

},

{
    name: "HindiTaluk",
    id: "HindiAddressTaluk",
    maxLength: 50,
    enforceMaxLength: true,
    xtype: "textfield",
    fieldLabel: "Taluk",
    listeners: {
        blur: function () {
            var str = trim(this.getValue());
            str = str.replace(/ +(?= )/g, '');
            this.setValue(str);
        }
    },
    vtype: "alphanumMid",
    allowBlank: true

},

{
    name: "HindiStateId",
    id: "HindiAddressStateId",
    enforceMaxLength: true,
    xtype: "textfield",
    fieldLabel: "State Id",
    listeners: {
        blur: function () {
            var str = trim(this.getValue());
            str = str.replace(/ +(?= )/g, '');
            this.setValue(str);
        }
    },
    hidden: true,
    allowBlank: true

},

{
    name: "HindiState",
    id: "HindiAddressState",
    fieldLabel: "State  <span style='color: rgb(255, 0, 0); padding-left: 2px;'>*</span>",
    xtype: "combobox",
    store: createQueryStore('GoiDirItem', 'category="State"', 'GoiDirItemName'),
    width: 500,
    pageSize: 100,
    typeAhead : true,
    minChars:1,
   // forceSelection: true,
    triggerAction: 'all',
    queryMode: "remote",
    displayField: "GoiDirItemName",
    valueField: "GoiDirItemName",
    emptyText: "",
    listeners: {
        select: function () {
            var sname = this.getValue();
            var i = this.store.findExact(this.valueField || this.displayField, sname);
            if (typeof (Ext.getCmp('HindiAddressIsTopLevel')) != "undefined" && sname != "") {
                var isTopLevel = Ext.getCmp('HindiAddressIsTopLevel');
                isTopLevel.setValue("false");
            }
            if (sname != "") {
                var pId = Ext.getCmp('HindiAddressStateId');
                pId.setValue(this.store.getAt(i).get('Id'));
            }
            var dname = Ext.getCmp('HindiAddressDistrict');
            if (!Ext.isEmpty(sname) && sname.toLowerCase() !== 'allindia') {
                dname.setValue('');
                dname.queryMode = "local";
              //  dname.allowBlank = false;
                dname.store.load({
                    params: {
                        "ParentGoiDirItemName": '"' + sname + '"'
                    }
                });
            } else {
                //dname.store.load();
                dname.setValue('');
                dname.queryMode = "local";
              //  dname.allowBlank = true;
                dname.store.load({
                    params: {
                        "ParentGoiDirItemName": '"' + sname + '"'
                    }
                });
            }
        },
        focus: function (combo) {
            var sname = combo.getValue();
            var dname = Ext.getCmp('HindiAddressDistrict');
            if (!Ext.isEmpty(sname) && sname.toLowerCase() !== 'allindia') {
                dname.setValue('');
                dname.queryMode = "local";
                dname.store.load({
                    params: {
                        "ParentGoiDirItemName": '"' + sname + '"'
                    }
                });
            } else {
                //dname.store.load();
                dname.setValue('');
                dname.queryMode = "local";
             //   dname.allowBlank = true;
                dname.store.load({
                    params: {
                        "ParentGoiDirItemName": '"' + sname + '"'
                    }
                });
            }
            combo.forceSelection=true;
	    combo.store.clearFilter(true);
	    combo.store.load();
        },
        render: function (combo, options) {
            this.store.sort('GoiDirItemName', 'ASC');
        },
	expand : function(field, eOpts){
	  field.queryMode = "local";
	},
	keypress : function(combo, e, eOpts){
	  if((e.getKey() >= 65 && e.getKey() <= 90) 
	    || (e.getKey() >= 97 && e.getKey() <= 122)
	    || (e.getKey() == Ext.EventObject.ENTER)
	    || (e.getKey() == Ext.EventObject.BACKSPACE)
	    ) {
	    combo.collapse();
	    if(Ext.isEmpty(combo.getValue())){
	      combo.forceSelection=true;
	      combo.store.clearFilter(true);
	      combo.store.load();
	      combo.expand();
	    }
	  }
	}
    },
    allowBlank: false
},

{
    name: "HindiDistrictId",
    id: "HindiAddressDistrictId",
    readOnly: true,
    enforceMaxLength: true,
    xtype: "textfield",
    fieldLabel: "District Id",
    listeners: {
        blur: function () {
            var str = trim(this.getValue());
            str = str.replace(/ +(?= )/g, '');
            this.setValue(str);
        }
    },
    hidden: true,
    allowBlank: true
},

{
    name: "HindiDistrict",
    id: "HindiAddressDistrict",
    fieldLabel: "District",
    xtype: "combobox",
    typeAhead : true,
    minChars:1,
  //  forceSelection: true,
    triggerAction: 'all',
    store: createQueryStore('GoiDirItem', 'category="State District"', 'GoiDirItemName'),
    width: 500,
    queryMode: "local",
    displayField: "GoiDirItemName",
    valueField: "GoiDirItemName",
    emptyText: "",
    listeners: {
        select: function () {
            var v = this.getValue();
            var i = this.store.findExact(this.valueField || this.displayField, v);
            if (typeof (Ext.getCmp('HindiAddressIsTopLevel')) != "undefined" && v != "") {
                var isTopLevel = Ext.getCmp('HindiAddressIsTopLevel');
                isTopLevel.setValue("false");
            }
            if (v != "") {
                var pId = Ext.getCmp('HindiAddressDistrictId');
                pId.setValue(this.store.getAt(i).get('Id'));
            }
        },
        render: function (combo, options) {
            this.store.removeAll(); // added
            this.store.sort('GoiDirItemName', 'ASC');
        },
	expand : function(field, eOpts){
	  field.queryMode = "local";
	},
	keypress : function(combo, e, eOpts){
	  if((e.getKey() >= 65 && e.getKey() <= 90) 
	    || (e.getKey() >= 97 && e.getKey() <= 122)
	    || (e.getKey() == Ext.EventObject.ENTER)
	    || (e.getKey() == Ext.EventObject.BACKSPACE)
	    ) {
	    combo.collapse();
	    if(Ext.isEmpty(combo.getValue())){
	      combo.forceSelection=true;
	      combo.store.clearFilter(true);
	      combo.store.load();
	      combo.expand();
	    }
	  }
	},
	focus : function(combo){
	    combo.forceSelection=true;
	    combo.store.clearFilter(true);
	    //combo.store.load();
	}
    },
    allowBlank: true

},

{
    name: "HindiCityId",
    id: "HindiAddressCityId",
    readOnly: true,
    enforceMaxLength: true,
    xtype: "textfield",
    fieldLabel: "CityId",
    listeners: {
        blur: function () {
            var str = trim(this.getValue());
            str = str.replace(/ +(?= )/g, '');
            this.setValue(str);
        }
    },
    hidden: true,
    allowBlank: true

},

{
    name: "HindiCity",
    id: "HindiAddressCity",
    fieldLabel: "City <span style='color: rgb(255, 0, 0); padding-left: 2px;'>*</span>",
    xtype: "combobox",
    typeAhead : true,
    minChars:1,
   // forceSelection: true,
    triggerAction: 'all',
    store: createStore('City', '', 'CityName'),
    queryMode: "remote",
    displayField: "CityName",
    valueField: "CityName",
    emptyText: "",
    listeners: {
        select: function () {
            var v = this.getValue();
            var i = this.store.findExact(this.valueField || this.displayField, v);
            if (typeof (Ext.getCmp('HindiAddressIsTopLevel')) != "undefined" && v != "") {
                var isTopLevel = Ext.getCmp('HindiAddressIsTopLevel');
                isTopLevel.setValue("false");
            }
            if (v != "") {
                var pId = Ext.getCmp('HindiAddressCityId');
                pId.setValue(this.store.getAt(i).get('Id'));
            }
        },
        render: function (combo, options) {
            this.store.sort('CityName', 'ASC');
        },
	expand : function(field, eOpts){
	  field.queryMode = "local";
	},
	keypress : function(combo, e, eOpts){
	  if((e.getKey() >= 65 && e.getKey() <= 90) 
	    || (e.getKey() >= 97 && e.getKey() <= 122)
	    || (e.getKey() == Ext.EventObject.ENTER)
	    || (e.getKey() == Ext.EventObject.BACKSPACE)
	    ) {
	    combo.collapse();
	    if(Ext.isEmpty(combo.getValue())){
	      combo.forceSelection=true;
	      combo.store.clearFilter(true);
	      combo.store.load();
	      combo.expand();
	    }
	  }
	},
	focus : function(combo){
	    combo.forceSelection=true;
	    combo.store.clearFilter(true);
	    combo.store.load();
	}
    },
    allowBlank: false

},

{
    name: "HindiAddressPincode",
    id: "HindiAddressPincode",
    maxLength: 50,
    enforceMaxLength: true,
    xtype: "textfield",
    fieldLabel: "Pincode",
    listeners: {
        blur: function () {
            var str = trim(this.getValue());
            str = str.replace(/ +(?= )/g, '');
            this.setValue(str);
        }
    },
    vtype: "pincode",
    allowBlank: true

}];

var DependentMetadataInfoForm = [{
	name :"AdTag",
		  id:"AdTagsAdTag",
				  fieldLabel : "Ad Tags",
				    xtype:"combobox",
	    typeAhead : true,
	    minChars:1,
	    enableKeyEvents:true,
	    forceSelection: false,
	    triggerAction: 'all',
	    	      multiSelect:true,
	    	    	      				  		    store:createPreloadedStore('Article', '', 'AdTag'),
		  			      	      	      queryMode:"remote",
	      	    displayField:"AdTag",
	    valueField:"AdTag",
	    	    emptyText:"",

	    	      listeners:{
		  beforerender:function(combo){
		      this.store.load();
		  },
		  render:function(combo){
		      this.store.sort('AdTag','ASC');
		  }
		  ,expand : function(field, eOpts){
		    field.queryMode = "local";
		  },
          focus : function(combo){
              combo.forceSelection=true;
              combo.store.clearFilter(true);
          },
		  keypress : function(combo, e, eOpts){
            if((e.getKey() >= 65 && e.getKey() <= 90) 
              || (e.getKey() >= 97 && e.getKey() <= 122)
              || (e.getKey() == Ext.EventObject.ENTER)
              || (e.getKey() == Ext.EventObject.BACKSPACE)
              ) {
              combo.collapse();
              if(Ext.isEmpty(combo.getValue())){
                combo.forceSelection=true;
                combo.store.clearFilter(true);
                combo.store.load();
                combo.expand();
              }
            }
		  }
		},
	    										    allowBlank:false
				
    },
         	                         	                   	{
	name :"Tag",
		  id:"TagsTag",
				  fieldLabel : "Tags",
				    xtype:"combobox",
	    typeAhead : true,
	    minChars:1,
	    enableKeyEvents:true,
	    forceSelection: false,
	    triggerAction: 'all',
	    	      multiSelect:true,
	    	    	      				  		    store:createPreloadedStore('Article', '', 'Tag'),
		  			      	      	      queryMode:"remote",
	      	    displayField:"Tag",
	    valueField:"Tag",
	    	    emptyText:"",

	    	      listeners:{
		  beforerender:function(combo){
		      this.store.load();
		  },
		  render:function(combo){
		      this.store.sort('Tag','ASC');
		  }
		  ,expand : function(field, eOpts){
		    field.queryMode = "local";
		  },
          focus : function(combo){
              combo.forceSelection=true;
              combo.store.clearFilter(true);
          },
		  keypress : function(combo, e, eOpts){
            if((e.getKey() >= 65 && e.getKey() <= 90) 
              || (e.getKey() >= 97 && e.getKey() <= 122)
              || (e.getKey() == Ext.EventObject.ENTER)
              || (e.getKey() == Ext.EventObject.BACKSPACE)
              ) {
              combo.collapse();
              if(Ext.isEmpty(combo.getValue())){
                combo.forceSelection=true;
                combo.store.clearFilter(true);
                combo.store.load();
                combo.expand();
              }
            }
		  }
		},
	    										    allowBlank:false
				
    },
         	                              	{
	name :"Caption",
		  id:"MetadataInfoCaption",
				    	    	    maxLength :50,
	    	    enforceMaxLength:true,
	    	      xtype:"textfield",
	    	    fieldLabel : "Caption",
	    	      				  listeners:{
		    blur:function(){
		      var str = trim(this.getValue());
		      str = str.replace(/ +(?= )/g,'');
		      this.setValue(str);
		    }
		    		    		},
			      	    	      		  	      	    											vtype:"alphanumMid",
			  	  	    	      allowBlank :true
	    				
    },
                   	                   	{
	name :"Personality",
		  id:"PersonalitiesPersonality",
				    	    	    maxLength :50,
	    	    enforceMaxLength:true,
	    	      xtype:"textfield",
	    	    fieldLabel : "Personality",
	    	      				  listeners:{
		    blur:function(){
		      var str = trim(this.getValue());
		      str = str.replace(/ +(?= )/g,'');
		      this.setValue(str);
		    }
		    		    		},
			      	    	      		  	      	    											vtype:"alphanumMid",
			  	  	    	      allowBlank : false
	    				
    },
         	                         	                   	{
	name :"Event",
		  id:"EventsEvent",
				    	    	    maxLength :50,
	    	    enforceMaxLength:true,
	    	      xtype:"textfield",
	    	    fieldLabel : "Events",
	    	      				  listeners:{
		    blur:function(){
		      var str = trim(this.getValue());
		      str = str.replace(/ +(?= )/g,'');
		      this.setValue(str);
		    }
		    		    		},
			      	    	      		  	      	    												  	  	    	      allowBlank : false
	    				
    },
         	                              	{
	name :"Format",
		  id:"MetadataInfoFormat",
			  //editable:false,
			  fieldLabel : "Format",
				    xtype:"combobox",
	    typeAhead : true,
	    minChars:1,
	    enableKeyEvents:true,
	    forceSelection: false,
	    triggerAction: 'all',
	    	    	      				  		    store:createStore('Format', '', 'FormatName'),
		  			      	      	      queryMode:"remote",
	      	    displayField:"FormatName",
	    valueField:"FormatName",
	    	    emptyText:"",

	    	      listeners:{
		  expand : function(field, eOpts){
		    field.queryMode = "local";
		  },
          focus : function(combo){
              combo.forceSelection=true;
              combo.store.clearFilter(true);
              combo.store.load();
          },
		  keypress : function(combo, e, eOpts){
                if((e.getKey() >= 65 && e.getKey() <= 90) 
                  || (e.getKey() >= 97 && e.getKey() <= 122)
                  || (e.getKey() == Ext.EventObject.ENTER)
                  || (e.getKey() == Ext.EventObject.BACKSPACE)
                  ) {
                  combo.collapse();
                  if(Ext.isEmpty(combo.getValue())){
                combo.forceSelection=true;
                combo.store.clearFilter(true);
                combo.store.load();
                combo.expand();
                  }
                }
		  } 
		},
	    									vtype:"alphanumMid",
			    allowBlank:true
				
    },
                        	{
	name :"LanguageId",
		  id:"MetadataInfoLanguageId",
			  readOnly:true,
	  fieldCls:'readonly-background-class',
			    	    	    enforceMaxLength:true,
	    	      xtype:"textfield",
	    	    fieldLabel : "Language Id",
	    	      				  listeners:{
		    blur:function(){
		      var str = trim(this.getValue());
		      str = str.replace(/ +(?= )/g,'');
		      this.setValue(str);
		    }
		    		    		},
			      	    	      		  	      	    			  hidden:true,
											  	  	    	      allowBlank :true
	    				
    },
                        	{
	name :"Language",
		  id:"MetadataInfoLanguage",
			  //editable:false,
			  fieldLabel : "Language",
				    xtype:"combobox",
	    typeAhead : true,
	    minChars:1,
	    enableKeyEvents:true,
	    forceSelection: false,
	    triggerAction: 'all',
	    	    	      				  		    store:createStore('Language', '', 'LanguageCode'),
		  			      	      	      queryMode:"remote",
	      	    displayField:"LanguageCode",
	    valueField:"LanguageCode",
	    	    emptyText:"",

	    	      listeners:{
	      select:function(){
		var v = this.getValue();
		var i = this.store.findExact(this.valueField || this.displayField, v);
				if(typeof(Ext.getCmp('MetadataInfoIsTopLevel')) != "undefined" && v != ""){
		    var isTopLevel = Ext.getCmp('MetadataInfoIsTopLevel');
		    isTopLevel.setValue("false");
		}
		  if(v != ""){   
		    var pId = Ext.getCmp('MetadataInfoLanguageId');
		    pId.setValue(this.store.getAt(i).get('Id'));
		  }
		  
	      }
	      	      , 
	      		      render: function(combo,options){
			this.store.sort('LanguageCode','ASC');
		      }
	      
	      		    ,expand : function(field, eOpts){
		      field.queryMode = "local";
		    },
          focus : function(combo){
              combo.forceSelection=true;
              combo.store.clearFilter(true);
                              combo.store.load();
                        },
		    keypress : function(combo, e, eOpts){
                if((e.getKey() >= 65 && e.getKey() <= 90) 
                  || (e.getKey() >= 97 && e.getKey() <= 122)
                  || (e.getKey() == Ext.EventObject.ENTER)
                  || (e.getKey() == Ext.EventObject.BACKSPACE)
                  ) {
                  combo.collapse();
                  if(Ext.isEmpty(combo.getValue())){
                combo.forceSelection=true;
                combo.store.clearFilter(true);
                combo.store.load();
                combo.expand();
                  }
                }
		    } 
	      },    
	    									vtype:"alphanumMid",
			    allowBlank:true
				
    },
                        	{
	name :"EventDate",
		  id:"MetadataInfoEventDate",
			  editable:false,
			      fieldLabel : "Event Date",
	      xtype : "datetimefield",
	      												    allowBlank:true
				
    },
                        	{
	name :"GoLiveDate",
		  id:"MetadataInfoGoLiveDate",
			  editable:false,
			      fieldLabel : "Go Live Date",
	      xtype : "datetimefield",
	      												    allowBlank:true
				
    },
                        	{
	name :"ExpiryDate",
		  id:"MetadataInfoExpiryDate",
			  editable:false,
			      fieldLabel : "Expiry Date",
	      xtype : "datetimefield",
	      												    allowBlank:true
				
    },
                        	{
	name :"SourceProperties",
		  id:"MetadataInfoSourceProperties",
				    	    	    maxLength :50,
	    	    enforceMaxLength:true,
	    	      xtype:"textfield",
	    	    fieldLabel : "Source Properties",
	    	      				  listeners:{
		    blur:function(){
		      var str = trim(this.getValue());
		      str = str.replace(/ +(?= )/g,'');
		      this.setValue(str);
		    }
		    		    		},
			      	    	      		  	      	    											vtype:"alphanumMid",
			  	  	    	      allowBlank :true
	    				
    }];



/**
 * Dependent Metadatainfo form declaration 
 */


/*var DependentMetadataInfoForm = [

{
    name: "Identifier",
    id: "MetadataInfoIdentifier",
    maxLength: 250,
    enforceMaxLength: true,
    xtype: "textfield",
    fieldLabel: "Identifier <span style='color: rgb(255, 0, 0); padding-left: 2px;'>*</span>",
    listeners: {
        blur: function () {
            var str = trim(this.getValue());
            str = str.replace(/ +(?= )/g, '');
            this.setValue(str);
        }
    },
    vtype: "url",
    allowBlank: false

}, {
    name: "IdentifierAlternate",
    id: "MetadataInfoIdentifierAlternate",
    maxLength: 50,
    enforceMaxLength: true,
    xtype: "textfield",
    fieldLabel: "Identifier Alternate",
    listeners: {
        blur: function () {
            var str = trim(this.getValue());
            str = str.replace(/ +(?= )/g, '');
            this.setValue(str);
        }
    },
    vtype: "url",
    allowBlank: true

},

{
    name: "TitleMain",
    id: "MetadataInfoTitleMain",
    maxLength: 50,
    enforceMaxLength: true,
    xtype: "textfield",
    fieldLabel: "Title Main <span style='color: rgb(255, 0, 0); padding-left: 2px;'>*</span>",
    listeners: {
        blur: function () {
            var str = trim(this.getValue());
            str = str.replace(/ +(?= )/g, '');
            this.setValue(str);
        }
    },
    vtype: "alphanumMid",
    allowBlank: false

},

{
    name: "TitleAlternate",
    id: "MetadataInfoTitleAlternate",
    maxLength: 50,
    enforceMaxLength: true,
    xtype: "textfield",
    fieldLabel: "Title Alternate",
    listeners: {
        blur: function () {
            var str = trim(this.getValue());
            str = str.replace(/ +(?= )/g, '');
            this.setValue(str);
        }
    },
    vtype: "alphanumMid",
    allowBlank: true

},

{
    name: "MetadataDescription",
    id: "MetadataInfoMetadataDescription",
    xtype: "htmleditor",
    maxLength: 4000,
    fieldLabel: "Description <span style='color: rgb(255, 0, 0); padding-left: 2px;'>*</span>",
    height: 200,
    value: "",
    defaultValue: "",
    anchor: '100%',
    listeners: {
        blur: function () {
            var str = trim(this.getValue());
            str = str.replace(/ +(?= )/g, '');
            this.setValue(str);
        }
    },
    allowBlank: false

},

{
    name: "SubjectKeyword",
    id: "SubjectKeywordsSubjectKeyword",
    maxLength: 50,
    enforceMaxLength: true,
    xtype: "textfield",
    fieldLabel: "Subject Keyword <span style='color: rgb(255, 0, 0); padding-left: 2px;'>*</span>",
    listeners: {
        blur: function () {
            var str = trim(this.getValue());
            str = str.replace(/ +(?= )/g, '');
            this.setValue(str);
        }
    },
    vtype: "alphanumMid",
    allowBlank: false

},

{
    name: "Sector",
    id: "SubjectClassificationSector",
    fieldLabel: "Subject Classification <span style='color: rgb(255, 0, 0); padding-left: 2px;'>*</span>",
    xtype: "combobox",
    typeAhead : true,
    minChars:1,
  //  forceSelection: true,
    triggerAction: 'all',
    multiSelect: true,
    store: createStore('Sector', ''),
    queryMode: "local",
    displayField: "SectorName",
    valueField: "SectorName",
    emptyText: "",
    listeners: {
        beforerender: function (combo) {
            this.store.load();
        },
        render: function (combo) {
            this.store.sort('SectorName', 'ASC');
        },
	expand : function(field, eOpts){
	  field.queryMode = "local";
	},
	keypress : function(combo, e, eOpts){
	  if((e.getKey() >= 65 && e.getKey() <= 90) 
	    || (e.getKey() >= 97 && e.getKey() <= 122)
	    || (e.getKey() == Ext.EventObject.ENTER)
	    || (e.getKey() == Ext.EventObject.BACKSPACE)
	    ) {
	    combo.collapse();
	    if(Ext.isEmpty(combo.getValue())){
	      combo.forceSelection=true;
	      combo.store.clearFilter(true);
	      combo.store.load();
	      combo.expand();
	    }
	  }
	},
	focus : function(combo){
	    combo.forceSelection=true;
	    combo.store.clearFilter(true);
	    combo.store.load();
	}
    },
    allowBlank: false

},

{
    name: "PublisherOrgName",
    id: "PublisherOrgNamesPublisherOrgName",
    fieldLabel: "PublisherOrg",
    xtype: "combobox",
    typeAhead : true,
    minChars:1,
  //  forceSelection: true,
    triggerAction: 'all',
    multiSelect: false,
    store: createQueryStore('GoiDirItem', 'Category="Organisations"'),
    width: 500,
    pageSize: 100,
    typeAhead: true,
    triggerAction: 'all',
    queryMode: "remote",
    displayField: "GoiDirItemName",
    valueField: "GoiDirItemName",
    emptyText: "",
    listeners: {
        beforerender: function (combo) {
            this.store.load();
        },
        render: function (combo) {
            this.store.sort('GoiDirItemName', 'ASC');
        },
	expand : function(field, eOpts){
		    field.queryMode = "local";
	},
	keypress : function(combo, e, eOpts){
	  if((e.getKey() >= 65 && e.getKey() <= 90) 
	    || (e.getKey() >= 97 && e.getKey() <= 122)
	    || (e.getKey() == Ext.EventObject.ENTER)
	    || (e.getKey() == Ext.EventObject.BACKSPACE)
	    ) {
	    combo.collapse();
	    if(Ext.isEmpty(combo.getValue())){
	      combo.forceSelection=true;
	      combo.store.clearFilter(true);
	      combo.store.load();
	      combo.expand();
	    }
	  }
	},
	focus : function(combo){
	    combo.forceSelection=true;
	    combo.store.clearFilter(true);
	    combo.store.load();
	}
    },
    allowBlank: true

},

{
    name: "PublisherDepartment",
    id: "PublisherDeptNamePublisherDepartment",
    fieldLabel: "PublisherDept <span style='color: rgb(255, 0, 0); padding-left: 2px;'>*</span>",
    xtype: "combobox",
    typeAhead : true,
    minChars:1,
  //  forceSelection: true,
    triggerAction: 'all',
    multiSelect: false,
    store: createQueryStore('GoiDirItem', 'Category="Departments"'),
    width: 500,
    pageSize: 100,
    queryMode: "remote",
    displayField: "GoiDirItemName",
    valueField: "GoiDirItemName",
    emptyText: "",
    listeners: {
        beforerender: function (combo) {
            this.store.load();
        },
        render: function (combo) {
            this.store.sort('GoiDirItemName', 'ASC');
        },
	expand : function(field, eOpts){
		    field.queryMode = "local";
	},
	keypress : function(combo, e, eOpts){
	  if((e.getKey() >= 65 && e.getKey() <= 90) 
	    || (e.getKey() >= 97 && e.getKey() <= 122)
	    || (e.getKey() == Ext.EventObject.ENTER)
	    || (e.getKey() == Ext.EventObject.BACKSPACE)
	    ) {
	    combo.collapse();
	    if(Ext.isEmpty(combo.getValue())){
	      combo.forceSelection=true;
	      combo.store.clearFilter(true);
	      combo.store.load();
	      combo.expand();
	    }
	  }
	},
	focus : function(combo){
	    combo.forceSelection=true;
	    combo.store.clearFilter(true);
	    combo.store.load();
	}
    },
    allowBlank: false

},

{
    name: "PublisherAddress",
    id: "MetadataInfoPublisherAddress",
    maxLength: 1000,
    enforceMaxLength: true,
    height: 100,
    anchor: '60%',
    xtype: "textarea",
    fieldLabel: "Publisher Address",
    listeners: {
        blur: function () {
            var str = trim(this.getValue());
            str = str.replace(/ +(?= )/g, '');
            this.setValue(str);
        }
    },
    allowBlank: true

},


{
    name: "SameAsPublisher",
    id: "MetadataInfoSameAsPublisher",
    xtype: "checkboxfield",
    isFormField: false,
    fieldLabel: "Creator details same as Publisher?",
    listeners: {
        change: function (checkbox, newValue, oldValue) {
            var creatorOrgName = Ext.getCmp('CreatorOrgNamesCreatorOrgName');
            var creatorDepartment = Ext.getCmp('CreatorDeptNameCreatorDepartment');
            var creatorAddress = Ext.getCmp('MetadataInfoCreatorAddress');
            var publisherOrgName = Ext.getCmp('PublisherOrgNamesPublisherOrgName');
            var publisherDepartment = Ext.getCmp('PublisherDeptNamePublisherDepartment');
            var publisherAddress = Ext.getCmp('MetadataInfoPublisherAddress');
            if (this.getValue()) {
                creatorOrgName.setValue(publisherOrgName.getValue());
                creatorDepartment.setValue(publisherDepartment.getValue());
                creatorAddress.setValue(publisherAddress.getValue());
            } else {
                creatorOrgName.setValue('');
                creatorDepartment.setValue('');
                creatorAddress.setValue('');
            }
        }
    }
},


{
    name: "CreatorOrgName",
    id: "CreatorOrgNamesCreatorOrgName",
    fieldLabel: "CreatorOrg",
    xtype: "combobox",
    typeAhead : true,
    minChars:1,
   // forceSelection: true,
    triggerAction: 'all',
    multiSelect: false,
    store: createQueryStore('GoiDirItem', 'Category="Organisations"'),
    width: 500,
    pageSize: 100,
    queryMode: "remote",
    displayField: "GoiDirItemName",
    valueField: "GoiDirItemName",
    emptyText: "",
    listeners: {
        beforerender: function (combo) {
            this.store.load();
        },
        render: function (combo) {
            this.store.sort('GoiDirItemName', 'ASC');
        },
	expand : function(field, eOpts){
		    field.queryMode = "local";
	},
	keypress : function(combo, e, eOpts){
	  if((e.getKey() >= 65 && e.getKey() <= 90) 
	    || (e.getKey() >= 97 && e.getKey() <= 122)
	    || (e.getKey() == Ext.EventObject.ENTER)
	    || (e.getKey() == Ext.EventObject.BACKSPACE)
	    ) {
	    combo.collapse();
	    if(Ext.isEmpty(combo.getValue())){
	      combo.forceSelection=true;
	      combo.store.clearFilter(true);
	      combo.store.load();
	      combo.expand();
	    }
	  }
	},
	focus : function(combo){
	    combo.forceSelection=true;
	    combo.store.clearFilter(true);
	    combo.store.load();
	} 
    },
    allowBlank: true

},

{
    name: "CreatorDepartment",
    id: "CreatorDeptNameCreatorDepartment",
    typeAhead : true,
    minChars:1,
   // forceSelection: true,
    triggerAction: 'all',
    fieldLabel: "CreatorDept <span style='color: rgb(255, 0, 0); padding-left: 2px;'>*</span>",
    xtype: "combobox",
    multiSelect: false,
    store: createQueryStore('GoiDirItem', 'Category="Departments"'),
    width: 500,
    pageSize: 100,
    queryMode: "remote",
    displayField: "GoiDirItemName",
    valueField: "GoiDirItemName",
    emptyText: "",
    listeners: {
        beforerender: function (combo) {
            this.store.load();
        },
        render: function (combo) {
            this.store.sort('GoiDirItemName', 'ASC');
        },
	expand : function(field, eOpts){
		    field.queryMode = "local";
	},
	keypress : function(combo, e, eOpts){
	  if((e.getKey() >= 65 && e.getKey() <= 90) 
	    || (e.getKey() >= 97 && e.getKey() <= 122)
	    || (e.getKey() == Ext.EventObject.ENTER)
	    || (e.getKey() == Ext.EventObject.BACKSPACE)
	    ) {
	    combo.collapse();
	    if(Ext.isEmpty(combo.getValue())){
	      combo.forceSelection=true;
	      combo.store.clearFilter(true);
	      combo.store.load();
	      combo.expand();
	    }
	  }
	},
	focus : function(combo){
	    combo.forceSelection=true;
	    combo.store.clearFilter(true);
	    combo.store.load();
	}
    },
    allowBlank: false

},

{
    name: "CreatorAddress",
    id: "MetadataInfoCreatorAddress",
    maxLength: 1000,
    anchor: '60%',
    enforceMaxLength: true,
    height: 100,
    xtype: "textarea",
    fieldLabel: "Creator address",
    listeners: {
        blur: function () {
            var str = trim(this.getValue());
            str = str.replace(/ +(?= )/g, '');
            this.setValue(str);
        }
    },
    allowBlank: true

},

{
    name: "Format",
    id: "MetadataInfoFormat",
    fieldLabel: "Format  <span style='color: rgb(255, 0, 0); padding-left: 2px;'>*</span>",
    xtype: "combobox",
    typeAhead : true,
    minChars:1,
  //  forceSelection: true,
    triggerAction: 'all',
    store: createStore('Format', ''),
    queryMode: "remote",
    displayField: "FormatName",
    valueField: "FormatName",
    emptyText: "",
    listeners: {
        render: function (combo, options) {
            this.store.sort('FormatName', 'ASC');
        },
	expand : function(field, eOpts){
		    field.queryMode = "local";
	},
	keypress : function(combo, e, eOpts){
	  if((e.getKey() >= 65 && e.getKey() <= 90) 
	    || (e.getKey() >= 97 && e.getKey() <= 122)
	    || (e.getKey() == Ext.EventObject.ENTER)
	    || (e.getKey() == Ext.EventObject.BACKSPACE)
	    ) {
	    combo.collapse();
	    if(Ext.isEmpty(combo.getValue())){
	      combo.forceSelection=true;
	      combo.store.clearFilter(true);
	      combo.store.load();
	      combo.expand();
	    }
	  }
	},
	focus : function(combo){
	    combo.forceSelection=true;
	    combo.store.clearFilter(true);
	    combo.store.load();
	}
    },
    allowBlank: false

}, {
    name: "LanguageId",
    id: "MetadataInfoLanguageId",
    readOnly: true,
    enforceMaxLength: true,
    xtype: "textfield",
    fieldLabel: "Language Id",
    listeners: {
        blur: function () {
            var str = trim(this.getValue());
            str = str.replace(/ +(?= )/g, '');
            this.setValue(str);
        }
    },
    hidden: true,
    allowBlank: true

},

{
    name: "Language",
    id: "MetadataInfoLanguage",
    fieldLabel: "Language <span style='color: rgb(255, 0, 0); padding-left: 2px;'>*</span>",
    xtype: "combobox",
    typeAhead : true,
    minChars:1,
   // forceSelection: true,
    triggerAction: 'all',
    store: createStore('Language', '', 'LanguageName'),
    queryMode: "remote",
    displayField: "LanguageName",
    valueField: "LanguageName",
    emptyText: "",
    listeners: {
        select: function () {
            var v = this.getValue();
            var i = this.store.findExact(this.valueField || this.displayField, v);
            if (typeof (Ext.getCmp('MetadataInfoIsTopLevel')) != "undefined" && v != "") {
                var isTopLevel = Ext.getCmp('MetadataInfoIsTopLevel');
                isTopLevel.setValue("false");
            }
            if (v != "") {
                var pId = Ext.getCmp('MetadataInfoLanguageId');
                pId.setValue(this.store.getAt(i).get('Id'));
            }
        },
        render: function (combo, options) {
            this.store.sort('LanguageName', 'ASC');
        },
	expand : function(field, eOpts){
		    field.queryMode = "local";
	},
	keypress : function(combo, e, eOpts){
	  if((e.getKey() >= 65 && e.getKey() <= 90) 
	    || (e.getKey() >= 97 && e.getKey() <= 122)
	    || (e.getKey() == Ext.EventObject.ENTER)
	    || (e.getKey() == Ext.EventObject.BACKSPACE)
	    ) {
	    combo.collapse();
	    if(Ext.isEmpty(combo.getValue())){
	      combo.forceSelection=true;
	      combo.store.clearFilter(true);
	      combo.store.load();
	      combo.expand();
	    }
	  }
	},
	focus : function(combo){
	    combo.forceSelection=true;
	    combo.store.clearFilter(true);
	    combo.store.load();
	}
    },
    allowBlank: false

},

{
    name: "MetaDataCreatedDate",
    id: "MetadataInfoMetaDataCreatedDate",
    fieldLabel: "MetaData Created Date",
    xtype: "datetimefield",
    allowBlank: true,
    editable: false

},

{
    name: "PublishedDate",
    id: "MetadataInfoPublishedDate",
    fieldLabel: "Published Date",
    xtype: "datetimefield",
    allowBlank: true,
    editable: false

},

{
    name: "ValidDate",
    id: "MetadataInfoValidDate",
    fieldLabel: "Valid Date",
    xtype: "datetimefield",
    allowBlank: true,
    editable: false

},

{
    name: "JurisdictionName",
    id: "JurisdictionJurisdictionName",
    fieldLabel: "Jurisdiction <span style='color: rgb(255, 0, 0); padding-left: 2px;'>*</span>",
    xtype: "combobox",
    typeAhead : true,
    minChars:1,
  //  forceSelection: true,
    triggerAction: 'all',
    store: createStore('JurisdictionType', ''),
    queryMode: "remote",
    displayField: "JurisdictionTypeName",
    valueField: "JurisdictionTypeName",
    emptyText: "",
    allowBlank: false,
    listeners:{
	expand : function(field, eOpts){
	  field.queryMode = "local";
	},
        keypress : function(combo, e, eOpts){
	  if((e.getKey() >= 65 && e.getKey() <= 90) 
	    || (e.getKey() >= 97 && e.getKey() <= 122)
	    || (e.getKey() == Ext.EventObject.ENTER)
	    || (e.getKey() == Ext.EventObject.BACKSPACE)
	    ) {
	    combo.collapse();
	    if(Ext.isEmpty(combo.getValue())){
	      combo.forceSelection=true;
	      combo.store.clearFilter(true);
	      combo.store.load();
	      combo.expand();
	    }
	  }
	},
	focus : function(combo){
	    combo.forceSelection=true;
	    combo.store.clearFilter(true);
	    combo.store.load();
	},
	change :function(combo){
		var juriState = Ext.getCmp("JurisdictionJurisdictionStateName");
		var juriDis   = Ext.getCmp("JurisdictionJurisdictionDistrictName");
		    if(combo.value.toLowerCase() == "allindia"){
			    juriState.setVisible(false);
			    juriDis.setVisible(false);
			    juriState.forceSelection=true;
			    juriDis.forceSelection=true;
			    juriState.setValue('');
			    juriDis.setValue('');
			    juriState.allowBlank = true;
			    juriDis.allowBlank = true;
		    }
		    else if(combo.value.toLowerCase() == "state"){
			    juriState.setVisible(true);
			    juriState.setValue('');
			    juriState.forceSelection=false;
			    juriState.allowBlank = false;
		    }
	    } 
	}
},
{
    name: "JurisdictionStateId",
    id: "JurisdictionJurisdictionStateId",
    readOnly: true,
    enforceMaxLength: true,
    xtype: "textfield",
    fieldLabel: "JurisdictionStateId",
    listeners: {
        blur: function () {
            var str = trim(this.getValue());
            str = str.replace(/ +(?= )/g, '');
            this.setValue(str);
        }
    },
    hidden: true,
    allowBlank: true

},

{
    name: "JurisdictionStateName",
    id: "JurisdictionJurisdictionStateName",
    fieldLabel: "Jurisdiction State <span style='color: rgb(255, 0, 0); padding-left: 2px;'>*</span>",
    xtype: "combobox",
    typeAhead : true,
    minChars:1,
  //  forceSelection: true,
    triggerAction: 'all',
    store: createQueryStore('GoiDirItem', 'category="State"', 'GoiDirItemName'),
    width: 500,
    pageSize: 40,
    queryMode: "remote",
    hidden: true,
    displayField: "GoiDirItemName",
    valueField: "GoiDirItemName",
    emptyText: "",
    listeners: {
        select: function () {
	    var juriDis = Ext.getCmp("JurisdictionJurisdictionDistrictName");
	    juriDis.setVisible(true);
	    juriDis.allowBlank = false;
            var sname = this.getValue();
            var i = this.store.findExact(this.valueField || this.displayField, sname);
            if (typeof (Ext.getCmp('JurisdictionIsTopLevel')) != "undefined" && sname != "") {
                var isTopLevel = Ext.getCmp('JurisdictionIsTopLevel');
                isTopLevel.setValue("false");
            }
            if (sname != "") {
                var pId = Ext.getCmp('JurisdictionJurisdictionStateId');
                pId.setValue(this.store.getAt(i).get('Id'));
            }
            var dname = Ext.getCmp('JurisdictionJurisdictionDistrictName');
            if (!Ext.isEmpty(sname)) {
                dname.setValue('');
                dname.queryMode = "local";
		dname.allowBlank = false;
                dname.store.load({
                    params: {
                        "ParentGoiDirItemName": '"' + sname + '"'
                    }
                });
		dname.store.on('load', function(store, records, successful, operation, eOpts){
		   if(store.getCount()>0){
		     dname.setVisible(true);  
		   }
		   else{
		     dname.setVisible(false);
		     dname.allowBlank = true;
		   }
		});
            }
        },
        focus: function (combo) {
            var sname = combo.getValue();
            var dname = Ext.getCmp('JurisdictionJurisdictionDistrictName');
            if (!Ext.isEmpty(sname)) {
                dname.setValue('');
                dname.queryMode = "local";
		dname.allowBlank = false;
                dname.store.load({
                    params: {
                        "ParentGoiDirItemName": '"' + sname + '"'
                    }
                });
            }
            combo.forceSelection=true;
	    combo.store.clearFilter(true);
	    combo.store.load();
        },
        render: function (combo, options) {
            this.store.sort('GoiDirItemName', 'ASC');
        },
	expand : function(field, eOpts){
	    field.queryMode = "local";
	},
        keypress : function(combo, e, eOpts){
	  if((e.getKey() >= 65 && e.getKey() <= 90) 
	    || (e.getKey() >= 97 && e.getKey() <= 122)
	    || (e.getKey() == Ext.EventObject.ENTER)
	    || (e.getKey() == Ext.EventObject.BACKSPACE)
	    ) {
	    combo.collapse();
	    if(Ext.isEmpty(combo.getValue())){
	      combo.forceSelection=true;
	      combo.store.clearFilter(true);
	      combo.store.load();
	      combo.expand();
	    }
	  }
	}
    },
    allowBlank: true
},
{
    name: "JurisdictionDistrictId",
    id: "JurisdictionJurisdictionDistrictId",
    readOnly: true,
    enforceMaxLength: true,
    xtype: "textfield",
    fieldLabel: "JurisidictionDistrictId",
    listeners: {
        blur: function () {
            var str = trim(this.getValue());
            str = str.replace(/ +(?= )/g, '');
            this.setValue(str);
        }
    },
    hidden: true,
    allowBlank: true

},
{
    name: "JurisdictionDistrictName",
    id: "JurisdictionJurisdictionDistrictName",
    fieldLabel: "Jurisdiction District <span style='color: rgb(255, 0, 0); padding-left: 2px;'>*</span>",
    xtype: "combobox",
    store: createQueryStore('GoiDirItem', 'category="State District"', 'GoiDirItemName'),
    width: 500,
    typeAhead : true,
    minChars:1,
  //  forceSelection: true,
    triggerAction: 'all',
    queryMode: "local",
    hidden: true,
    displayField: "GoiDirItemName",
    valueField: "GoiDirItemName",
    emptyText: "",
    listeners: {
        select: function () {
            var v = this.getValue();
            var i = this.store.findExact(this.valueField || this.displayField, v);
            if (typeof (Ext.getCmp('JurisdictionIsTopLevel')) != "undefined" && v != "") {
                var isTopLevel = Ext.getCmp('JurisdictionIsTopLevel');
                isTopLevel.setValue("false");
            }
            if (v != "") {
                var pId = Ext.getCmp('JurisdictionJurisdictionDistrictId');
                pId.setValue(this.store.getAt(i).get('Id'));
            }
        },
        render: function (combo, options) {
            this.store.removeAll(); // added
            this.store.sort('GoiDirItemName', 'ASC');
        },
	expand : function(field, eOpts){
	  field.queryMode = "local";
	},
        keypress : function(combo, e, eOpts){
	  if((e.getKey() >= 65 && e.getKey() <= 90) 
	    || (e.getKey() >= 97 && e.getKey() <= 122)
	    || (e.getKey() == Ext.EventObject.ENTER)
	    || (e.getKey() == Ext.EventObject.BACKSPACE)
	    ) {
	    combo.collapse();
	    if(Ext.isEmpty(combo.getValue())){
	      combo.forceSelection=true;
	      combo.store.clearFilter(true);
	      combo.store.load();
	      combo.expand();
	    }
	  }
	},
	focus : function(combo){
	    combo.forceSelection=true;
	    combo.store.clearFilter(true);
	    //combo.store.load();
	}
    },
    allowBlank: true

},

{
    name: "SpatialStateId",
    id: "SpatialSpatialStateId",
    readOnly: true,
    enforceMaxLength: true,
    xtype: "textfield",
    fieldLabel: "Spatial State Id",
    listeners: {
        blur: function () {
            var str = trim(this.getValue());
            str = str.replace(/ +(?= )/g, '');
            this.setValue(str);
        }
    },
    hidden: true,
    allowBlank: true

},

{
    name: "SpatialStateName",
    id: "SpatialSpatialStateName",
    fieldLabel: "Spatial State <span style='color: rgb(255, 0, 0); padding-left: 2px;'>*</span>",
    xtype: "combobox",
    typeAhead : true,
    minChars:1,
  //  forceSelection: true,
    triggerAction: 'all',
    store: createQueryStore('GoiDirItem', 'category="State"', 'GoiDirItemName'),
    width: 500,
    pageSize: 40,
    typeAhead: true,
    queryMode: "remote",
    displayField: "GoiDirItemName",
    valueField: "GoiDirItemName",
    emptyText: "",
    listeners: {
        select: function () {
            var sname = this.getValue();
            var i = this.store.findExact(this.valueField || this.displayField, sname);
            if (typeof (Ext.getCmp('SpatialIsTopLevel')) != "undefined" && sname != "") {
                var isTopLevel = Ext.getCmp('SpatialIsTopLevel');
                isTopLevel.setValue("false");
            }
            if (sname != "") {
                var pId = Ext.getCmp('SpatialSpatialStateId');
                pId.setValue(this.store.getAt(i).get('Id'));
            }
            var dname = Ext.getCmp('SpatialSpatialDistrictName');
            if (!Ext.isEmpty(sname) && sname.toLowerCase() !== 'allindia') {
                dname.setValue('');
                dname.queryMode = "local";
		dname.allowBlank = false;
                dname.store.load({
                    params: {
                        "ParentGoiDirItemName": '"' + sname + '"'
                    }
                });
            } else {
                //dname.store.load();
                dname.setValue('');
                dname.queryMode = "local";
		dname.allowBlank = true;
                dname.store.load({
                    params: {
                        "ParentGoiDirItemName": '"' + sname + '"'
                    }
                });
            }
        },
        focus: function (combo) {
            var sname = combo.getValue();
            var dname = Ext.getCmp('SpatialSpatialDistrictName');
            if (!Ext.isEmpty(sname) && sname.toLowerCase() !== 'allindia') {
                dname.setValue('');
                dname.queryMode = "local";
		dname.allowBlank = false;
                dname.store.load({
                    params: {
                        "ParentGoiDirItemName": '"' + sname + '"'
                    }
                });
            } else {
                //dname.store.load();
                dname.setValue('');
                dname.queryMode = "local";
		dname.allowBlank = true;
                dname.store.load({
                    params: {
                        "ParentGoiDirItemName": '"' + sname + '"'
                    }
                });
            }
            combo.forceSelection=true;
	    combo.store.clearFilter(true);
	    combo.store.load();
        },
        render: function (combo, options) {
            this.store.sort('GoiDirItemName', 'ASC');
        },
	expand : function(field, eOpts){
	  field.queryMode = "local";
	},
        keypress : function(combo, e, eOpts){
	  if((e.getKey() >= 65 && e.getKey() <= 90) 
	    || (e.getKey() >= 97 && e.getKey() <= 122)
	    || (e.getKey() == Ext.EventObject.ENTER)
	    || (e.getKey() == Ext.EventObject.BACKSPACE)
	    ) {
	    combo.collapse();
	    if(Ext.isEmpty(combo.getValue())){
	      combo.forceSelection=true;
	      combo.store.clearFilter(true);
	      combo.store.load();
	      combo.expand();
	    }
	  }
	}
    },
    allowBlank: false

},

{
    name: "SpatialDistrictId",
    id: "SpatialSpatialDistrictId",
    readOnly: true,
    enforceMaxLength: true,
    xtype: "textfield",
    fieldLabel: "Spatial District Id",
    listeners: {
        blur: function () {
            var str = trim(this.getValue());
            str = str.replace(/ +(?= )/g, '');
            this.setValue(str);
        }
    },
    hidden: true,
    allowBlank: true

},

{
    name: "SpatialDistrictName",
    id: "SpatialSpatialDistrictName",
    fieldLabel: "Spatial District",
    xtype: "combobox",
    store: createQueryStore('GoiDirItem', 'category="State District"', 'GoiDirItemName'),
    width: 500,
    typeAhead : true,
    minChars:1,
  //  forceSelection: true,
    triggerAction: 'all',
    queryMode: "local",
    displayField: "GoiDirItemName",
    valueField: "GoiDirItemName",
    emptyText: "",
    listeners: {
        select: function () {
            var v = this.getValue();
            var i = this.store.findExact(this.valueField || this.displayField, v);
            if (typeof (Ext.getCmp('SpatialIsTopLevel')) != "undefined" && v != "") {
                var isTopLevel = Ext.getCmp('SpatialIsTopLevel');
                isTopLevel.setValue("false");
            }
            if (v != "") {
                var pId = Ext.getCmp('SpatialSpatialDistrictId');
                pId.setValue(this.store.getAt(i).get('Id'));
            }
        },
        render: function (combo, options) {
            this.store.removeAll(); // added 
            this.store.sort('GoiDirItemName', 'ASC');
        },
	expand : function(field, eOpts){
	  field.queryMode = "local";
	},
	keypress : function(combo, e, eOpts){
	  if((e.getKey() >= 65 && e.getKey() <= 90) 
	    || (e.getKey() >= 97 && e.getKey() <= 122)
	    || (e.getKey() == Ext.EventObject.ENTER)
	    || (e.getKey() == Ext.EventObject.BACKSPACE)
	    ) {
	    combo.collapse();
	    if(Ext.isEmpty(combo.getValue())){
	      combo.forceSelection=true;
	      combo.store.clearFilter(true);
	      combo.store.load();
	      combo.expand();
	    }
	  }
	},
	focus : function(combo){
	    combo.forceSelection=true;
	    combo.store.clearFilter(true);
	    //combo.store.load();
	} 
    },
    allowBlank: true

},

{
    name: "CoverageTemporal",
    id: "MetadataInfoCoverageTemporal",
    maxLength: 50,
    enforceMaxLength: true,
    xtype: "textfield",
    fieldLabel: "Coverage Temporal",
    listeners: {
        blur: function () {
            var str = trim(this.getValue());
            str = str.replace(/ +(?= )/g, '');
            this.setValue(str);
        }
    },
    vtype: "alphanumMid",
    allowBlank: true

},

{
    name: "AudienceCategory",
    id: "MetadataInfoAudienceAudienceCategory",
    typeAhead : true,
    minChars:1,
   // forceSelection: true,
    triggerAction: 'all',
    fieldLabel: "Audience <span style='color: rgb(255, 0, 0); padding-left: 2px;'>*</span>",
    xtype: "combobox",
    multiSelect: true,
    store: createStore('AudienceCategory', ''),
    queryMode: "local",
    displayField: "AudienceCategoryName",
    valueField: "AudienceCategoryName",
    emptyText: "",
    listeners: {
        beforerender: function (combo) {
            this.store.load();
        },
        render: function (combo) {
            this.store.sort('AudienceCategoryName', 'ASC');
        },
	expand : function(field, eOpts){
	  field.queryMode = "local";
	},
	keypress : function(combo, e, eOpts){
	  if((e.getKey() >= 65 && e.getKey() <= 90) 
	    || (e.getKey() >= 97 && e.getKey() <= 122)
	    || (e.getKey() == Ext.EventObject.ENTER)
	    || (e.getKey() == Ext.EventObject.BACKSPACE)
	    ) {
	    combo.collapse();
	    if(Ext.isEmpty(combo.getValue())){
	      combo.forceSelection=true;
	      combo.store.clearFilter(true);
	      combo.store.load();
	      combo.expand();
	    }
	  }
	},
	focus : function(combo){
	    combo.forceSelection=true;
	    combo.store.clearFilter(true);
	    combo.store.load();
	} 
    },
    allowBlank: false

},

{
    name: "CategoryType",
    id: "MetadataInfoCategoryTypesCategoryType",
    fieldLabel: "Type Category <span style='color: rgb(255, 0, 0); padding-left: 2px;'>*</span>",
    xtype: "combobox",
    typeAhead : true,
    minChars:1,
  //  forceSelection: true,
    triggerAction: 'all',
    multiSelect: true,
    store: createStore('Category', ''),
    queryMode: "local",
    displayField: "CategoryName",
    valueField: "CategoryName",
    emptyText: "",
    listeners: {
        beforerender: function (combo) {
            this.store.load();
        },
        render: function (combo) {
            this.store.sort('CategoryName', 'ASC');
        },
	expand : function(field, eOpts){
	  field.queryMode = "local";
	},
	keypress : function(combo, e, eOpts){
	  if((e.getKey() >= 65 && e.getKey() <= 90) 
	    || (e.getKey() >= 97 && e.getKey() <= 122)
	    || (e.getKey() == Ext.EventObject.ENTER)
	    || (e.getKey() == Ext.EventObject.BACKSPACE)
	    ) {
	    combo.collapse();
	    if(Ext.isEmpty(combo.getValue())){
	      combo.forceSelection=true;
	      combo.store.clearFilter(true);
	      combo.store.load();
	      combo.expand();
	    }
	  }
	},
	focus : function(combo){
	    combo.forceSelection=true;
	    combo.store.clearFilter(true);
	    combo.store.load();
	}
    },
    allowBlank: false

},

{
    name: "ConformsTo",
    id: "MetadataInfoConformsTo",
    maxLength: 50,
    enforceMaxLength: true,
    xtype: "textfield",
    fieldLabel: "Relation ConformsTo",
    listeners: {
        blur: function () {
            var str = trim(this.getValue());
            str = str.replace(/ +(?= )/g, '');
            this.setValue(str);
        }
    },
    vtype: "alphanumMid",
    allowBlank: true

},

{
    name: "HasPart",
    id: "MetadataInfoHasPartsHasPart",
    maxLength: 50,
    enforceMaxLength: true,
    xtype: "textfield",
    fieldLabel: "Relation HasPart",
    listeners: {
        blur: function () {
            var str = trim(this.getValue());
            str = str.replace(/ +(?= )/g, '');
            this.setValue(str);
        }
    },
    vtype: "alphanumMid",
    allowBlank: true

},

{
    name: "IsPartOf",
    id: "MetadataInfoIsPartOf",
    maxLength: 50,
    enforceMaxLength: true,
    xtype: "textfield",
    fieldLabel: "Relation IsPartOf",
    listeners: {
        blur: function () {
            var str = trim(this.getValue());
            str = str.replace(/ +(?= )/g, '');
            this.setValue(str);
        }
    },
    vtype: "alphanumMid",
    allowBlank: true

},

{
    name: "HasVersion",
    id: "MetadataInfoHasVersion",
    maxLength: 50,
    enforceMaxLength: true,
    xtype: "textfield",
    fieldLabel: "Relation HasVersion",
    listeners: {
        blur: function () {
            var str = trim(this.getValue());
            str = str.replace(/ +(?= )/g, '');
            this.setValue(str);
        }
    },
    vtype: "alphanumMid",
    allowBlank: true

},

{
    name: "IsVersionOf",
    id: "MetadataInfoIsVersionOf",
    maxLength: 50,
    enforceMaxLength: true,
    xtype: "textfield",
    fieldLabel: "Relation IsVersionof",
    listeners: {
        blur: function () {
            var str = trim(this.getValue());
            str = str.replace(/ +(?= )/g, '');
            this.setValue(str);
        }
    },
    vtype: "alphanumMid",
    allowBlank: true

}, {
    name: "Source",
    id: "MetadataInfoSource",
    maxLength: 50,
    enforceMaxLength: true,
    xtype: "textfield",
    fieldLabel: "Source <span style='color: rgb(255, 0, 0); padding-left: 2px;'>*</span>",
    listeners: {
        blur: function () {
            var str = trim(this.getValue());
            str = str.replace(/ +(?= )/g, '');
            this.setValue(str);
        }
    },
    vtype: "alphanumMid",
    allowBlank: false

}]; */

/**
 * Dependent contact number form declaration 
 */

var DependentContactNumberForm = [{
    name: "ContactType",
    id: "ContactNumberContactType",
    fieldLabel: "Contact Type <span style='color: rgb(255, 0, 0); padding-left: 2px;'>*</span>",
    xtype: "combobox",
    typeAhead : true,
    minChars:1,
   // forceSelection: true,
    triggerAction: 'all',
    store: createStore('ContactType', '', 'ContactTypeName'),
    queryMode: "remote",
    displayField: "ContactTypeName",
    valueField: "ContactTypeName",
    emptyText: "",
    listeners:{
	expand : function(field, eOpts){
	  field.queryMode = "local";
	},
	keypress : function(combo, e, eOpts){
	  if((e.getKey() >= 65 && e.getKey() <= 90) 
	    || (e.getKey() >= 97 && e.getKey() <= 122)
	    || (e.getKey() == Ext.EventObject.ENTER)
	    || (e.getKey() == Ext.EventObject.BACKSPACE)
	    ) {
	    combo.collapse();
	    if(Ext.isEmpty(combo.getValue())){
	      combo.forceSelection=true;
	      combo.store.clearFilter(true);
	      combo.store.load();
	      combo.expand();
	    }
	  }
	},
	focus : function(combo){
	    combo.forceSelection=true;
	    combo.store.clearFilter(true);
	    combo.store.load();
	} 
      },
    allowBlank: false

},

{
    name: "CountryCode",
    id: "ContactNumberCountryCode",
    maxLength: 50,
    enforceMaxLength: true,
    xtype: "textfield",
    fieldLabel: "Country Code <span style='color: rgb(255, 0, 0); padding-left: 2px;'>*</span>",
    listeners: {
        blur: function () {
            var str = trim(this.getValue());
            str = str.replace(/ +(?= )/g, '');
            this.setValue(str);
        }
    },
    vtype: "alphanumeric",
    allowBlank: false

},

{
    name: "CityCode",
    id: "ContactNumberCityCode",
    maxLength: 50,
    enforceMaxLength: true,
    xtype: "textfield",
    fieldLabel: "City Code <span style='color: rgb(255, 0, 0); padding-left: 2px;'>*</span>",
    listeners: {
        blur: function () {
            var str = trim(this.getValue());
            str = str.replace(/ +(?= )/g, '');
            this.setValue(str);
        }
    },
    vtype: "alphanumeric",
    allowBlank: false

},

{
    name: "OfficePhone",
    id: "ContactNumberOfficePhone",
    maxLength: 50,
    enforceMaxLength: true,
    xtype: "textfield",
    fieldLabel: "Office Phone <span style='color: rgb(255, 0, 0); padding-left: 2px;'>*</span>",
    listeners: {
        blur: function () {
            var str = trim(this.getValue());
            str = str.replace(/ +(?= )/g, '');
            this.setValue(str);
        }
    },
    vtype: "alphanumeric",
    allowBlank: false

},

{
    name: "Extension",
    id: "ContactNumberExtension",
    maxLength: 50,
    enforceMaxLength: true,
    xtype: "textfield",
    fieldLabel: "Extension",
    listeners: {
        blur: function () {
            var str = trim(this.getValue());
            str = str.replace(/ +(?= )/g, '');
            this.setValue(str);
        }
    },
    vtype: "numeric",
    allowBlank: true

},

{
    name: "BoardNo",
    id: "ContactNumberBoardNo",
    maxLength: 50,
    enforceMaxLength: true,
    xtype: "textfield",
    fieldLabel: "Board No",
    listeners: {
        blur: function () {
            var str = trim(this.getValue());
            str = str.replace(/ +(?= )/g, '');
            this.setValue(str);
        }
    },
    vtype: "alphanumeric",
    allowBlank: true

},

{
    name: "TollfreeNo",
    id: "ContactNumberTollfreeNo",
    maxLength: 50,
    enforceMaxLength: true,
    xtype: "textfield",
    fieldLabel: "Tollfree No",
    listeners: {
        blur: function () {
            var str = trim(this.getValue());
            str = str.replace(/ +(?= )/g, '');
            this.setValue(str);
        }
    },
    vtype: "alphanumeric",
    allowBlank: true

},

{
    name: "MobileNo",
    id: "ContactNumberMobileNo",
    maxLength: 50,
    enforceMaxLength: true,
    xtype: "textfield",
    fieldLabel: "Mobile No <span style='color: rgb(255, 0, 0); padding-left: 2px;'>*</span>",
    listeners: {
        blur: function () {
            var str = trim(this.getValue());
            str = str.replace(/ +(?= )/g, '');
            this.setValue(str);
        }
    },
    vtype: "alphanumeric",
    allowBlank: false

},

{
    name: "Fax",
    id: "ContactNumberFax",
    maxLength: 50,
    enforceMaxLength: true,
    xtype: "textfield",
    fieldLabel: "Fax",
    listeners: {
        blur: function () {
            var str = trim(this.getValue());
            str = str.replace(/ +(?= )/g, '');
            this.setValue(str);
        }
    },
    vtype: "alphanumeric",
    allowBlank: true

},

{
    name: "Email",
    id: "ContactNumberEmail",
    maxLength: 50,
    enforceMaxLength: true,
    xtype: "textfield",
    fieldLabel: "Email <span style='color: rgb(255, 0, 0); padding-left: 2px;'>*</span>",
    listeners: {
        blur: function () {
            var str = trim(this.getValue());
            str = str.replace(/ +(?= )/g, '');
            this.setValue(str);
        }
    },
    vtype: "email",
    allowBlank: false

}];

/**
 * Dependent NpiMetadata Form declaration 
 */

var NpiMetadataForm = [{
    title: 'NpiMetadata',
    xtype: 'form',
    id: 'NpiMetadataForm1',
    autoScroll: true,
    fieldDefaults: {
        labelWidth: 155
    },
    items: [DependentNpiMetadataForm]
}];

/**
 * Method to return current browser height
 * @returns Integer
 */

function getWindowHeight() {
    var windowHeight;
    if (typeof (window.innerHeight) == 'number') windowHeight = window.innerHeight; // the more
    // standards
    // compliant
    // browsers
    // (mozilla/netscape/opera/IE7)
    else if (document.documentElement && document.documentElement.clientHeight) windowHeight = document.documentElement.clientHeight; // IE 6+ in
    // 'standards
    // compliant
    // mode'
    else if (document.body && document.body.clientHeight) windowHeight = document.body.clientHeight; // IE 4
    // compatible
    windowHeight = (windowHeight - (windowHeight / 100) * 10);
    return windowHeight;
}

/** 
 * CmsUserprofileForm Declaration
 */

var CmsUserProfileForm = [{
    title: 'CmsUserProfile',
    xtype: 'form',
    id: 'CmsUserProfileForm1',
    autoScroll: true,
    fieldDefaults: {
        labelWidth: 155
    },
    items: [{
        name: "Id",
        id: "CmsUserProfileId",
        readOnly: true,
        fieldCls: 'readonly-background-class',
        enforceMaxLength: true,
        xtype: "textfield",
        fieldLabel: "CmsUserProfile Id",
        listeners: {
            blur: function () {
                var str = trim(this.getValue());
                str = str.replace(/ +(?= )/g, '');
                this.setValue(str);
            }
        },
        hidden: true,
        allowBlank: true

    },

    {
        name: "EntityType",
        id: "CmsUserProfileEntityType",
        readOnly: true,
        fieldCls: 'readonly-background-class',
        enforceMaxLength: true,
        xtype: "textfield",
        fieldLabel: "Entity Type",
        listeners: {
            blur: function () {
                var str = trim(this.getValue());
                str = str.replace(/ +(?= )/g, '');
                this.setValue(str);
            }
        },
        hidden: true,
        value: "CmsUserProfile",
        allowBlank: true

    },

    {
        name: "AliasId",
        id: "CmsUserProfileAliasId",
        readOnly: true,
        fieldCls: 'readonly-background-class',
        enforceMaxLength: true,
        xtype: "textfield",
        fieldLabel: "Alias ID",
        listeners: {
            blur: function () {
                var str = trim(this.getValue());
                str = str.replace(/ +(?= )/g, '');
                this.setValue(str);
            }
        },
        hidden: true,
        allowBlank: true

    },

    {
        name: "UserName",
        id: "CmsUserProfileUserName",
        maxLength: 30,
        enforceMaxLength: true,
        xtype: "textfield",
        fieldLabel: "User Name  <span style='color: rgb(255, 0, 0); padding-left: 2px;'>*</span>",
        listeners: {
            blur: function () {
                var str = trim(this.getValue());
                str = str.replace(/ +(?= )/g, '');
                this.setValue(str);
            }
        },
        vtype: "alphanumStrict",
        allowBlank: false

    },
    {
        name: "Password",
        id: "CmsUserProfilePassword",
        xtype: "textfield",
        maxLength: 32,
	isFormField: false,
        enforceMaxLength: true,
        inputType: "password",
        fieldLabel: "Password  <span style='color: rgb(255, 0, 0); padding-left: 2px;'>*</span>",
        listeners: {
            render: function () {
                this.setValue('');
            }
        },
        vtype: "passwordVType",
        allowBlank: false

    },
    {
        name: "UserRole",
        id: "CmsUserProfileUserRole",
        fieldLabel: "User Role  <span style='color: rgb(255, 0, 0); padding-left: 2px;'>*</span>",
        xtype: "combobox",
        typeAhead : true,
	minChars:1,
	//forceSelection: true,
	triggerAction: 'all',
        store: createStore('Role', '', 'RoleName'),
        queryMode: "remote",
        displayField: "RoleName",
        valueField: "RoleName",
        emptyText: "",
        listeners:{
		  expand : function(field, eOpts){
		    field.queryMode = "local";
		  },
		  keypress : function(combo, e, eOpts){
		    if((e.getKey() >= 65 && e.getKey() <= 90) 
		      || (e.getKey() >= 97 && e.getKey() <= 122)
		      || (e.getKey() == Ext.EventObject.ENTER)
		      || (e.getKey() == Ext.EventObject.BACKSPACE)
		      ) {
		      combo.collapse();
		      if(Ext.isEmpty(combo.getValue())){
			combo.forceSelection=true;
			combo.store.clearFilter(true);
			combo.store.load();
			combo.expand();
		      }
		    }
		  },
		  focus : function(combo){
		      combo.forceSelection=true;
		      combo.store.clearFilter(true);
		      combo.store.load();
		  }
	},
        allowBlank: false

    },
    {
        name: "Title",
        id: "CmsUserProfileTitle",
        maxLength: 200,
        enforceMaxLength: true,
        xtype: "textfield",
        fieldLabel: "Title",
        listeners: {
            blur: function () {
                var str = trim(this.getValue());
                str = str.replace(/ +(?= )/g, '');
                this.setValue(str);
            }
        },
        vtype: "alphanumLoose",
        allowBlank: true

    },

    {
        name: "FirstName",
        id: "CmsUserProfileFirstName",
        maxLength: 50,
        enforceMaxLength: true,
        xtype: "textfield",
        fieldLabel: "First Name  <span style='color: rgb(255, 0, 0); padding-left: 2px;'>*</span>",
        listeners: {
            blur: function () {
                var str = trim(this.getValue());
                str = str.replace(/ +(?= )/g, '');
                this.setValue(str);
            }
        },
        vtype: "alpha",
        allowBlank: false

    },

    {
        name: "MiddleName",
        id: "CmsUserProfileMiddleName",
        maxLength: 50,
        enforceMaxLength: true,
        xtype: "textfield",
        fieldLabel: "Middle Name",
        listeners: {
            blur: function () {
                var str = trim(this.getValue());
                str = str.replace(/ +(?= )/g, '');
                this.setValue(str);
            }
        },
        vtype: "alpha",
        allowBlank: true

    },

    {
        name: "LastName",
        id: "CmsUserProfileLastName",
        maxLength: 50,
        enforceMaxLength: true,
        xtype: "textfield",
        fieldLabel: "Last Name",
        listeners: {
            blur: function () {
                var str = trim(this.getValue());
                str = str.replace(/ +(?= )/g, '');
                this.setValue(str);
            }
        },
        vtype: "alpha",
        allowBlank: true

    },

    {
        name: "Email",
        id: "CmsUserProfileEmail",
        maxLength: 50,
        enforceMaxLength: true,
        xtype: "textfield",
        fieldLabel: "Email  <span style='color: rgb(255, 0, 0); padding-left: 2px;'>*</span>",
        listeners: {
            blur: function () {
                var str = trim(this.getValue());
                str = str.replace(/ +(?= )/g, '');
                this.setValue(str);
            }
        },
        vtype: "email",
        allowBlank: false

    },

    {
        name: "CityId",
        id: "CmsUserProfileCityId",
        readOnly: true,
        fieldCls: 'readonly-background-class',
        enforceMaxLength: true,
        xtype: "textfield",
        fieldLabel: "CityId",
        listeners: {
            blur: function () {
                var str = trim(this.getValue());
                str = str.replace(/ +(?= )/g, '');
                this.setValue(str);
            }
        },
        hidden: true,
        allowBlank: true

    },

    {
        name: "City",
        id: "CmsUserProfileCity",
        fieldLabel: "City",
        xtype: "combobox",
        store: createStore('City', '', 'CityName'),
        queryMode: "remote",
        displayField: "CityName",
        valueField: "CityName",
        emptyText: "",
	typeAhead : true,
	minChars:1,
	//forceSelection: true,
	triggerAction: 'all',
        listeners: {
            select: function () {
                var v = this.getValue();
                var i = this.store.findExact(this.valueField || this.displayField, v);
                if (typeof (Ext.getCmp('CmsUserProfileIsTopLevel')) != "undefined" && v != "") {
                    var isTopLevel = Ext.getCmp('CmsUserProfileIsTopLevel');
                    isTopLevel.setValue("false");
                }
                if (v != "") {
                    var pId = Ext.getCmp('CmsUserProfileCityId');
                    pId.setValue(this.store.getAt(i).get('Id'));
                }

            },
            render: function (combo, options) {
                this.store.sort('CityName', 'ASC');
            },
	    expand : function(field, eOpts){
		    field.queryMode = "local";
	    },
	    keypress : function(combo, e, eOpts){
	      if((e.getKey() >= 65 && e.getKey() <= 90) 
		|| (e.getKey() >= 97 && e.getKey() <= 122)
		|| (e.getKey() == Ext.EventObject.ENTER)
		|| (e.getKey() == Ext.EventObject.BACKSPACE)
		) {
		combo.collapse();
		if(Ext.isEmpty(combo.getValue())){
		  combo.forceSelection=true;
		  combo.store.clearFilter(true);
		  combo.store.load();
		  combo.expand();
		}
	      }
	    },
	    focus : function(combo){
		combo.forceSelection=true;
		combo.store.clearFilter(true);
		combo.store.load();
	    }
        },
        allowBlank: true

    },

    {
        name: "StateId",
        id: "CmsUserProfileStateId",
        enforceMaxLength: true,
        xtype: "textfield",
        fieldLabel: "State Id",
        listeners: {
            blur: function () {
                var str = trim(this.getValue());
                str = str.replace(/ +(?= )/g, '');
                this.setValue(str);
            }
        },
        hidden: true,
        allowBlank: true

    },

    {
        name: "State",
        id: "CmsUserProfileState",
        fieldLabel: "State",
        xtype: "combobox",
	typeAhead : true,
	minChars:1,
	//forceSelection: true,
        store: createQueryStore('GoiDirItem', 'category="State"', 'GoiDirItemName'),
        width: 500,
        pageSize: 100,
        triggerAction: 'all',
        queryMode: "remote",
        displayField: "GoiDirItemName",
        valueField: "GoiDirItemName",
        emptyText: "",
        listeners: {
            select: function () {
                var v = this.getValue();
                var i = this.store.findExact(this.valueField || this.displayField, v);
                if (typeof (Ext.getCmp('CmsUserProfileIsTopLevel')) != "undefined" && v != "") {
                    var isTopLevel = Ext.getCmp('CmsUserProfileIsTopLevel');
                    isTopLevel.setValue("false");
                }
                if (v != "") {
                    var pId = Ext.getCmp('CmsUserProfileStateId');
                    pId.setValue(this.store.getAt(i).get('Id'));
                }

            },
            render: function (combo, options) {
                this.store.sort('GoiDirItemName', 'ASC');
            },
	    expand : function(field, eOpts){
		    field.queryMode = "local";
	    },
	    keypress : function(combo, e, eOpts){
	      if((e.getKey() >= 65 && e.getKey() <= 90) 
		|| (e.getKey() >= 97 && e.getKey() <= 122)
		|| (e.getKey() == Ext.EventObject.ENTER)
		|| (e.getKey() == Ext.EventObject.BACKSPACE)
		) {
		combo.collapse();
		if(Ext.isEmpty(combo.getValue())){
		  combo.forceSelection=true;
		  combo.store.clearFilter(true);
		  combo.store.load();
		  combo.expand();
		}
	      }
	    },
	    focus : function(combo){
		combo.forceSelection=true;
		combo.store.clearFilter(true);
		combo.store.load();
	    }
        },
        allowBlank: true

    },

    {
        name: "Designation",
        id: "CmsUserProfileDesignation",
        fieldLabel: "Designation",
        xtype: "combobox",
	typeAhead : true,
	minChars:1,
	// forceSelection: true,
	triggerAction: 'all',
        store: createStore('Designation', '', 'DesignationName'),
        queryMode: "remote",
        displayField: "DesignationName",
        valueField: "DesignationName",
        emptyText: "",
        listeners:{
	    expand : function(field, eOpts){
	      field.queryMode = "local";
	    },
	    keypress : function(combo, e, eOpts){
	      if((e.getKey() >= 65 && e.getKey() <= 90) 
		|| (e.getKey() >= 97 && e.getKey() <= 122)
		|| (e.getKey() == Ext.EventObject.ENTER)
		|| (e.getKey() == Ext.EventObject.BACKSPACE)
		) {
		combo.collapse();
		if(Ext.isEmpty(combo.getValue())){
		  combo.forceSelection=true;
		  combo.store.clearFilter(true);
		  combo.store.load();
		  combo.expand();
		}
	      }
	    },
	    focus : function(combo){
		combo.forceSelection=true;
		combo.store.clearFilter(true);
		combo.store.load();
	    } 
	 },
        vtype: "alphanumMid",
        allowBlank: true

    },

    {
        name: "AssociatedMin",
        id: "CmsUserProfileAssociatedMin",
        fieldLabel: "AssociatedMin",
        xtype: "combobox",
        store: createQueryStore('GoiDirItem', 'category="Ministry"', 'GoiDirItemName'),
        width: 500,
        pageSize: 100,
	typeAhead : true,
	minChars:1,
	// forceSelection: true,
	triggerAction: 'all',
        queryMode: "remote",
        displayField: "GoiDirItemName",
        valueField: "GoiDirItemName",
        emptyText: "",
          listeners:{
	    expand : function(field, eOpts){
	      field.queryMode = "local";
	    },
	    keypress : function(combo, e, eOpts){
	      if((e.getKey() >= 65 && e.getKey() <= 90) 
		|| (e.getKey() >= 97 && e.getKey() <= 122)
		|| (e.getKey() == Ext.EventObject.ENTER)
		|| (e.getKey() == Ext.EventObject.BACKSPACE)
		) {
		combo.collapse();
		if(Ext.isEmpty(combo.getValue())){
		  combo.forceSelection=true;
		  combo.store.clearFilter(true);
		  combo.store.load();
		  combo.expand();
		}
	      }
	    },
	    focus : function(combo){
		combo.forceSelection=true;
		combo.store.clearFilter(true);
		combo.store.load();
	    }
	 }, 
        allowBlank: true

    },

    {
        name: "AssociatedDeptOrg",
        id: "CmsUserProfileAssociatedDeptOrg",
        fieldLabel: "AssociatedDeptOrg",
        xtype: "combobox",
	typeAhead : true,
	minChars:1,
	// forceSelection: true,
	triggerAction: 'all',
        store: createQueryStore('GoiDirItem', 'category=Departments%2COrganisations&cond=or', 'GoiDirItemName'),
        width: 500,
        pageSize: 100,
        queryMode: "remote",
        displayField: "GoiDirItemName",
        valueField: "GoiDirItemName",
        emptyText: "",
        listeners:{
	    expand : function(field, eOpts){
	      field.queryMode = "local";
	    },
	    keypress : function(combo, e, eOpts){
	      if((e.getKey() >= 65 && e.getKey() <= 90) 
		|| (e.getKey() >= 97 && e.getKey() <= 122)
		|| (e.getKey() == Ext.EventObject.ENTER)
		|| (e.getKey() == Ext.EventObject.BACKSPACE)
		) {
		combo.collapse();
		if(Ext.isEmpty(combo.getValue())){
		  combo.forceSelection=true;
		  combo.store.clearFilter(true);
		  combo.store.load();
		  combo.expand();
		}
	      }
	    },
	    focus : function(combo){
		combo.forceSelection=true;
		combo.store.clearFilter(true);
		combo.store.load();
	    }
	 },
        allowBlank: true
    },

    {
        name: "ContactNumber",
        id: "CmsUserProfileContactNumber",
        maxLength: 50,
        enforceMaxLength: true,
        xtype: "textfield",
        fieldLabel: "Contact Number",
        listeners: {
            blur: function () {
                var str = trim(this.getValue());
                str = str.replace(/ +(?= )/g, '');
                this.setValue(str);
            }
        },
        vtype: "numeric",
        allowBlank: true

    },

    {
        name: "IsActive",
        id: "CmsUserProfileIsActive",
        editable: false,
        fieldLabel: "IsActive  <span style='color: rgb(255, 0, 0); padding-left: 2px;'>*</span>",
        xtype: "combobox",
        editable: false,
        store: Ext.create('Ext.data.ArrayStore', {
            fields: ["isActive"],
            data: Ext.booleanType // pick boolean values from a store
        }),
        queryMode: "local",
        displayField: "isActive",
        emptyText: "",

        allowBlank: false

    },

    {
        name: "CreatedDate",
        id: "CmsUserProfileCreatedDate",
        editable: false,
        fieldLabel: "Created Date",
        xtype: "datetimefield",
        listeners: {
            render: function () {
                var date = new Date();
                if (this.getValue() == null || this.getValue() == "") {
                    this.setValue(date);
                }
            }
        },
        hidden: true,
        allowBlank: false

    },

    {
        name: "LastModifiedDate",
        id: "CmsUserProfileLastModifiedDate",
        editable: false,
        fieldLabel: "Last Modified Date",
        xtype: "datetimefield",
        listeners: {
            render: function () {
                var date = new Date();
                this.setValue(date);
            }
        },
        hidden: true,
        allowBlank: false

    },

    {
        name: "CreatedBy",
        id: "CmsUserProfileCreatedBy",
        readOnly: true,
        fieldCls: 'readonly-background-class',
        enforceMaxLength: true,
        xtype: "textfield",
        fieldLabel: "Created By",
        listeners: {
            blur: function () {
                var str = trim(this.getValue());
                str = str.replace(/ +(?= )/g, '');
                this.setValue(str);
            }
        },
        hidden: true,
        listeners: {
            render: function () {
                if (this.getValue() == "") {
                    this.setValue(cmsUserName);
                }
            }
        },
        allowBlank: true

    },

    {
        name: "LastModifiedBy",
        id: "CmsUserProfileLastModifiedBy",
        readOnly: true,
        fieldCls: 'readonly-background-class',
        enforceMaxLength: true,
        xtype: "textfield",
        fieldLabel: "Last Modified By",
        listeners: {
            blur: function () {
                var str = trim(this.getValue());
                str = str.replace(/ +(?= )/g, '');
                this.setValue(str);
            }
        },
        hidden: true,
        listeners: {
            render: function () {
                this.setValue(cmsUserName);
            }
        },
        allowBlank: true

    },

    {
        name: "Site",
        id: "CmsUserProfileSite",
        readOnly: true,
        fieldCls: 'readonly-background-class',
        enforceMaxLength: true,
        xtype: "textfield",
        fieldLabel: "Site",
        listeners: {
            blur: function () {
                var str = trim(this.getValue());
                str = str.replace(/ +(?= )/g, '');
                this.setValue(str);
            }
        },
        hidden: true,
        allowBlank: true

    },

    {
        name: "Version",
        id: "CmsUserProfileVersion",
        readOnly: true,
        fieldCls: 'readonly-background-class',
        enforceMaxLength: true,
        xtype: "textfield",
        fieldLabel: "Version",
        listeners: {
            blur: function () {
                var str = trim(this.getValue());
                str = str.replace(/ +(?= )/g, '');
                this.setValue(str);
            }
        },
        hidden: true,
        allowBlank: true

    },
    ]
}, {
    title: 'Change Password',
    xtype: 'form',
    id: 'CmsUserProfileForm8',
    disabled: true,
    autoScroll: true,
    fieldDefaults: {
        labelWidth: 155
    },
    items: [{
        name: "OldPassword",
        id: "CmsUserProfileOldPassword",
        xtype: "textfield",
        maxLength: 32,
	isFormField: false,
        enforceMaxLength: true,
        inputType: "password",
        fieldLabel: "Old Password  <span style='color: rgb(255, 0, 0); padding-left: 2px;'>*</span>",
        listeners: {
            render: function () {
                this.setValue('');
            }
        },
        vtype: "alphanumMid",
        allowBlank: false

    }, {
        name: "ChangePassword",
        id: "CmsUserProfileChangePassword",
        xtype: "textfield",
        maxLength: 32,
	isFormField: false,
        enforceMaxLength: true,
        inputType: "password",
        fieldLabel: "Password  <span style='color: rgb(255, 0, 0); padding-left: 2px;'>*</span>",
        listeners: {
            render: function () {
                this.setValue('');
            }
        },
        vtype: "passwordVType",
        allowBlank: false

    }, {
        name: "ReTypePassword",
        id: "CmsUserProfileRetypePassword",
        xtype: "textfield",
        isFormField: false,
        maxLength: 32,
        enforceMaxLength: true,
        inputType: "password",
        fieldLabel: "ReType Password  <span style='color: rgb(255, 0, 0); padding-left: 2px;'>*</span>",
        listeners: {
            render: function () {
                this.setValue('');
            }
        },
        vtype: "alphanumMid",
        allowBlank: false

    }]
},
  {
    title: 'Password Policy',
    xtype: 'form',
    id: 'CmsUserProfilePasswordPolicy',
    autoScroll: true,
    fieldDefaults: {
        labelWidth: 155
    },
    html:'Password should be 8-10 characters in length.<br/>Password should only contain letters, numbers and allowed special characters [.:;@#,()"\'/ _-]<br/>Password and ReType password Should match.<br/>Old password and password should not be same.<br/>Password should contain atleast one special character.<br/>Password should contain atleast one character.<br/>Password should contain atleast one number.<br/>Password should contain one character in upper-case.<br/>'
}];
